define(["require","exports","../has","../Logger","../promiseUtils","./Connection","./RemoteClient","./WorkerOwner"],function(o,a,e,n,c,t,r,i){function u(){if(g)return g;for(var e=f+s,t=[],n=0;n<e;n++)!function(n){var e=i.create(n).then(function(e){return w[n]=e});t.push(e)}(n);return g=c.all(t).then(function(){})}Object.defineProperty(a,"__esModule",{value:!0}),a.Connection=t,a.RemoteClient=r;var l=e("host-browser")?navigator.hardwareConcurrency:0;l||(l=e("safari")&&e("mac")||e("trident")?8:2);var f=e("esri-workers-debug")?1:Math.max(1,Math.ceil(l/2)),s=e("esri-workers-debug")?1:Math.max(1,Math.floor(l/2)),d=n.getLogger("esri.core.workers"),h=0,w=[];a.initialize=function(){u()},a.open=function(t,n,e){if(void 0===n&&(n={}),Array.isArray(t))return new a.Connection(t.map(function(e){return new a.RemoteClient(e,n.client)}));if("string"!=typeof t){d.warn("workers-open:signature-deprecated","DEPRECATED: workers.open() changed signature.");var r=t;t=n,n={client:r,strategy:e?"dedicated":"distributed"}}var i=n.strategy||"distributed";return"local"===i?c.create(function(n){o([t],function(e){n(a.RemoteClient.connect(e))})}).then(function(e){return new a.Connection([new a.RemoteClient(e,n.client)])}):u().then(function(){if("dedicated"!==i)return c.all(w.map(function(e){return e.open(t)})).then(function(e){return new a.Connection(e.map(function(e){return new a.RemoteClient(e,n.client)}))});var e=f+h++;return h%=s,w[e].open(t).then(function(e){return new a.Connection([new a.RemoteClient(e,n.client)])})})},a.terminate=function(){g&&(g.cancel(),g=null);for(var e=0;e<w.length;e++)w[e]&&w[e].terminate();w.length=0};var g=null});