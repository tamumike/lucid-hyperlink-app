(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/support/TilemapCache":1524,"esri/core/LRUCache":1541,"esri/layers/support/Tilemap":1542,"esri/layers/support/lazyLayerLoader":1544,"esri/layers/mixins/ArcGISCachedService":1616})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[22,21,28,69],{1524:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(10),i(2),i(1),i(98),i(36),i(5),i(9),i(14),i(7),i(1541),i(475),i(8),i(15),i(0),i(1542)],void 0===(r=function(e,t,i,n,r,a,l,o,c,u,p,s,h,f,v,y,d){var m=p.getLogger("esri.layers.support.TilemapCache");return function(e){function t(t){var i=e.call(this)||this;return i._handles=new u,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=l,i}var o;return n(t,e),o=t,t.prototype.initialize=function(){var e=this;this._tilemapCache=new s(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return e._initializeTilemapDefinition()}),v.init(this,"layer.tileInfo.lods",function(t){return e._initializeAvailableLevels(t)},!0)]),this._initializeTilemapDefinition()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.castLevels=function(e){return e<=2?(m.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),t.prototype.getTilemap=function(e,t,i){return this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition)},t.prototype.fetchTilemap=function(e,t,i,n){var r=this;if(!this._availableLevels[e])return f.reject(new c("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var a=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,i,a);if(l)return f.resolve(l);var o=d.tilemapDefinitionId(a),u=this._pendingTilemapRequests[o];return u||(u=d.Tilemap.fromDefinition(a,n).then(function(e){return r._tilemapCache.put(o,e,e.byteSize),delete r._pendingTilemapRequests[o],e}).catch(function(e){return delete r._pendingTilemapRequests[o],f.reject(e)}),this._pendingTilemapRequests[o]=u),f.create(function(e,t){u.then(e,t)})},t.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var n=this.getTilemap(e,t,i);return n?n.getAvailability(t,i):"unknown"},t.prototype.getAvailabilityUpsample=function(e,t,i,n){n.level=e,n.row=t,n.col=i;var r=this.layer.tileInfo;for(r.updateTileInfo(n);;){var a=this.getAvailability(n.level,n.row,n.col);if("unavailable"!==a)return a;if(!r.upsampleTile(n))return"unavailable"}},t.prototype.fetchAvailability=function(e,t,i,n){return this._availableLevels[e]?this.fetchTilemap(e,t,i,n).catch(function(e){return e}).then(function(n){if(n instanceof d.Tilemap){var r=n.getAvailability(t,i);return"unavailable"===r?f.reject(new c("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):r}return n&&"cancel"===n.dojoType?f.reject(n):"unknown"}):f.reject(new c("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},t.prototype.fetchAvailabilityUpsample=function(e,t,i,n,r){var a=this;n.level=e,n.row=t,n.col=i;var l=this.layer.tileInfo;l.updateTileInfo(n);for(var c=this.fetchAvailability(e,t,i,r).catch(function(e){return e&&"cancel"===e.dojoType?f.reject(e):l.upsampleTile(n)?a.fetchAvailabilityUpsample(n.level,n.row,n.col,n):f.reject(e)}),u={id:n.id,level:e,row:t,col:i},p=this,s=0;o._prefetches.length<o._maxPrefetch&&l.upsampleTile(u);++s)!function(e){var t=p.fetchAvailability(u.level,u.row,u.col,r);o._prefetches.push(t),c.then(function(){return t.cancel()},function(){return t.cancel()}),t.then(function(){return o._prefetches.removeUnordered(t)},function(){return o._prefetches.removeUnordered(t)})}();return c},t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;t&&t.token||!this.layer.token||(t=i({},t,{token:this.layer.token})),this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?a.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},t.prototype._tilemapFromCache=function(e,t,i,n){var r=this._getTilemapDefinition(e,t,i,n),a=d.tilemapDefinitionId(r);return this._tilemapCache.get(a)},t.prototype._getTilemapDefinition=function(e,t,i,n){return n.level=e,n.row=t-t%this.size,n.col=i-i%this.size,n},t.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach(function(e){return t._availableLevels[e.level]=!0})},t._maxPrefetch=4,t._prefetches=new h({initialSize:o._maxPrefetch}),r([y.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0),r([y.cast("levels")],t.prototype,"castLevels",null),r([y.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null),r([y.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0),r([y.property({constructOnly:!0})],t.prototype,"layer",void 0),r([y.property({constructOnly:!0})],t.prototype,"request",void 0),o=r([y.subclass("esri.layers.support.TilemapCache")],t)}(y.declared(o))}.apply(null,n))||(e.exports=r)},1541:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(480)],void 0===(r=function(e,t,i){return function(){function e(e,t){this._storage=new i.Storage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t,i){this._storage.put(e,t,i)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}.apply(null,n))||(e.exports=r)},1542:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(10),i(36),i(9),i(4),i(8)],void 0===(r=function(e,t,i,n,r,a,l){function o(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var n=e.service.query;return n&&(t=t+"?"+n),t}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){function e(){this.location={left:0,top:0,width:0,height:0},this.byteSize=40}return e.prototype.getAvailability=function(e,t){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";var i=(e-this.location.top)*this.location.width+(t-this.location.left),n=i%8,r=i>>3,a=this._tileAvailabilityBitSet;return r<0||r>a.length?"unknown":a[r]&1<<n?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,i=this.location.height,n=!0,r=!0,a=Math.ceil(t*i/8),l=new Uint8Array(a),o=0,c=0;c<e.length;c++){var u=c%8;e[c]?(r=!1,l[o]|=1<<u):n=!1,7===u&&++o}this._isAllUnvailable=r,this._isAllAvailable=n,this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=l,this.byteSize+=l.length)},e.fromDefinition=function(t,a){var c=t.service.request||n,u=t.row,p=t.col,s=t.width,h=t.height,f={query:{f:"json"}};return a=a?i({},f,a):f,c(o(t),a).then(function(e){return e.data}).catch(function(e){return e&&e.details&&422===e.details.httpStatus?{location:{top:u,left:p,width:s,height:h},valid:!0,data:function(){for(var e=[],t=0,i=s*h;t<i;t++)e[t]=0;return e}()}:l.reject(e)}).then(function(t){if(t.location&&(t.location.top!==u||t.location.left!==p||t.location.width!==s||t.location.height!==h))throw new r("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:u,left:p,width:s,height:h}});return e.fromJSON(t)})},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(a.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new r("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new r("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new r("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new r("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new r("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=c,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=o,t.default=c}.apply(null,n))||(e.exports=r)},1544:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(8)],void 0===(r=function(e,t,n){Object.defineProperty(t,"__esModule",{value:!0}),t.layerLookupMap={CSVLayer:function(){return n.create(function(e){return Promise.resolve().then(function(){var t=[i(247)];e.apply(null,t)}.bind(this)).catch(i.oe)})},ElevationLayer:function(){return n.create(function(e){return Promise.all([i.e(7),i.e(21)]).then(function(){var t=[i(1310)];e.apply(null,t)}.bind(this)).catch(i.oe)})},FeatureLayer:function(){return n.create(function(e){return Promise.resolve().then(function(){var t=[i(99)];e.apply(null,t)}.bind(this)).catch(i.oe)})},GroupLayer:function(){return n.create(function(e){return i.e(15).then(function(){var t=[i(1312)];e.apply(null,t)}.bind(this)).catch(i.oe)})},GeoRSSLayer:function(){return n.create(function(e){return i.e(24).then(function(){var t=[i(1319)];e.apply(null,t)}.bind(this)).catch(i.oe)})},ImageryLayer:function(){return n.create(function(e){return i.e(39).then(function(){var t=[i(1316)];e.apply(null,t)}.bind(this)).catch(i.oe)})},KMLLayer:function(){return n.create(function(e){return i.e(26).then(function(){var t=[i(1321)];e.apply(null,t)}.bind(this)).catch(i.oe)})},MapImageLayer:function(){return n.create(function(e){return i.e(17).then(function(){var t=[i(1314)];e.apply(null,t)}.bind(this)).catch(i.oe)})},MapNotesLayer:function(){return n.create(function(e){return i.e(68).then(function(){var t=[i(1656)];e.apply(null,t)}.bind(this)).catch(i.oe)})},OpenStreetMapLayer:function(){return n.create(function(e){return i.e(27).then(function(){var t=[i(1322)];e.apply(null,t)}.bind(this)).catch(i.oe)})},PointCloudLayer:function(){return n.create(function(e){return i.e(38).then(function(){var t=[i(1323)];e.apply(null,t)}.bind(this)).catch(i.oe)})},SceneLayer:function(){return n.create(function(e){return Promise.resolve().then(function(){var t=[i(248)];e.apply(null,t)}.bind(this)).catch(i.oe)})},BuildingSceneLayer:function(){return n.create(function(e){return i.e(23).then(function(){var t=[i(1318)];e.apply(null,t)}.bind(this)).catch(i.oe)})},IntegratedMeshLayer:function(){return n.create(function(e){return i.e(25).then(function(){var t=[i(1320)];e.apply(null,t)}.bind(this)).catch(i.oe)})},StreamLayer:function(){return n.create(function(e){return i.e(20).then(function(){var t=[i(1317)];e.apply(null,t)}.bind(this)).catch(i.oe)})},TileLayer:function(){return n.create(function(e){return Promise.all([i.e(6),i.e(69)]).then(function(){var t=[i(478)];e.apply(null,t)}.bind(this)).catch(i.oe)})},UnknownLayer:function(){return n.create(function(e){return i.e(70).then(function(){var t=[i(1657)];e.apply(null,t)}.bind(this)).catch(i.oe)})},UnsupportedLayer:function(){return n.create(function(e){return i.e(71).then(function(){var t=[i(1658)];e.apply(null,t)}.bind(this)).catch(i.oe)})},VectorTileLayer:function(){return n.create(function(e){return Promise.all([i.e(8),i.e(28)]).then(function(){var t=[i(1311)];e.apply(null,t)}.bind(this)).catch(i.oe)})},WebTileLayer:function(){return n.create(function(e){return i.e(29).then(function(){var t=[i(1313)];e.apply(null,t)}.bind(this)).catch(i.oe)})},WMSLayer:function(){return n.create(function(e){return i.e(30).then(function(){var t=[i(1324)];e.apply(null,t)}.bind(this)).catch(i.oe)})},WMTSLayer:function(){return n.create(function(e){return i.e(96).then(function(){var t=[i(1659)];e.apply(null,t)}.bind(this)).catch(i.oe)})},BingMapsLayer:function(){return n.create(function(e){return i.e(12).then(function(){var t=[i(245)];e.apply(null,t)}.bind(this)).catch(i.oe)})}}}.apply(null,n))||(e.exports=r)},1616:function(e,t,i){var n,r;n=[i.dj.c(e.i),t,i(10),i(2),i(1),i(32),i(0),i(244),i(237),i(1524)],void 0===(r=function(e,t,i,n,r,a,l,o,c,u){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return n(t,e),Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTileInfo=function(e,t){var i=function(e){return Math.round(1e4*e)/1e4},n=t.minScale?i(t.minScale):1/0,r=t.maxScale?i(t.maxScale):-1/0;return e?(e.lods=e.lods.filter(function(e){var t=i(e.scale);return t<=n&&t>=r}),c.fromJSON(e)):null},t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new u({layer:this}):null},r([l.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),r([l.property({json:{origins:{service:{read:!1}}}})],t.prototype,"minScale",void 0),r([l.property({json:{origins:{service:{read:!1}}}})],t.prototype,"maxScale",void 0),r([l.property({type:a.SpatialReference})],t.prototype,"spatialReference",void 0),r([l.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),r([l.property({type:c})],t.prototype,"tileInfo",void 0),r([l.reader("service","tileInfo",["tileInfo","minScale","maxScale"])],t.prototype,"readTileInfo",null),r([l.property()],t.prototype,"tilemapCache",void 0),r([l.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),r([l.property()],t.prototype,"version",void 0),r([l.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(l.declared(o))}.apply(null,n))||(e.exports=r)}}]);