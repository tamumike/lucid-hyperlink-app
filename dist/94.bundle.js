(function(){(this||window).webpackJsonp.registerAbsMids({"esri/views/3d/layers/PointCloudWorker":1327,"esri/views/3d/layers/i3s/I3SUtil":1418,"esri/views/3d/support/orientedBoundingBox":1427,"esri/views/3d/layers/support/layerViewUpdatingProperties":1428,"esri/views/3d/layers/i3s/I3SBinaryReader":1435,"esri/views/3d/layers/i3s/LEPCC":1543,"esri/views/3d/support/dito":1556,"esri/views/3d/layers/i3s/IdleQueue":1641,"esri/views/3d/layers/i3s/PointCloudRendererUtil":1777,"esri/views/3d/layers/PointCloudLayerView3D":2383,"esri/views/3d/layers/i3s/LoDUtil":2384,"esri/views/3d/layers/i3s/PagedNodeIndex":2385,"esri/views/3d/layers/i3s/PointRenderer":2386,"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":2387})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{1327:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(8),r(34),r(19),r(1435),r(1543),r(1777),r(80)],void 0===(i=function(e,t,r,n,i,o,a,s,u){var l=function(){function e(){}return e.prototype.transform=function(e,t){return this.thread?this.thread.invoke("_process",e,{transferList:t}):r.resolve(this._transform(e))},e.prototype._process=function(e){var t=this._transform(e);return r.resolve({result:t,transferList:[t.points.buffer,t.rgb.buffer]})},e.prototype._transform=function(e){var t=this.readGeometry(e.schema,e.geometryBuffer),r=t.length/3,n=s.evaluateRenderer(e.rendererInfo,e.primaryAttribute,e.modulationAttribute,t,r);e.filterInfo&&e.filterInfo.length>0&&(r=s.filterInPlace(t,n,e.filterInfo,e.filterAttributes)),3*r<n.length&&(n=new Uint8Array(n.buffer.slice(0,3*r))),this._applyElevationOffsetInPlace(t,r,e.elevationOffset);var o=this._transformCoordinates(t,r,e.obb,i.fromJSON(e.inSR),i.fromJSON(e.outSR));return{obb:e.obb,points:o,rgb:n}},e.prototype.readGeometry=function(e,t){if(null==e.encoding||""===e.encoding){for(var r=o.createGeometryDataIndex(t,e,!1),n=o.createTypedView(t,r.vertexAttributes.position),i=r.header.fields,s=[i.offsetX,i.offsetY,i.offsetZ],u=[i.scaleX,i.scaleY,i.scaleZ],l=n.length/3,c=new Float64Array(3*l),d=0;d<l;d++)c[3*d]=n[3*d]*u[0]+s[0],c[3*d+1]=n[3*d+1]*u[1]+s[1],c[3*d+2]=n[3*d+2]*u[2]+s[2];return c}if("lepcc-xyz"===e.encoding)return a.decodeXYZ(t).result},e.prototype._transformCoordinates=function(e,t,r,i,o){if(!u.bufferToBuffer(e,i,0,e,o,0,t))throw Error("Can't reproject");var a=n.vec3f32.fromValues(r.center[0],r.center[1],r.center[2]),s=n.vec3f32.create(),l=n.vec3f32.create();n.quat.conjugate(c,r.quaternion);for(var d=new Float32Array(3*t),f=0;f<t;f++)s[0]=e[3*f]-a[0],s[1]=e[3*f+1]-a[1],s[2]=e[3*f+2]-a[2],n.vec3.transformQuat(l,s,c),r.halfSize[0]=Math.max(r.halfSize[0],Math.abs(l[0])),r.halfSize[1]=Math.max(r.halfSize[1],Math.abs(l[1])),r.halfSize[2]=Math.max(r.halfSize[2],Math.abs(l[2])),d[3*f]=s[0],d[3*f+1]=s[1],d[3*f+2]=s[2];return d},e.prototype._applyElevationOffsetInPlace=function(e,t,r){if(0!==r)for(var n=0;n<t;n++)e[3*n+2]+=r},e}(),c=n.quatf32.create();return l}.apply(null,n))||(e.exports=i)},1418:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(36),r(69),r(9),r(8),r(22),r(34),r(19),r(28),r(481),r(97),r(1435),r(80),r(1378)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,f,h,p){function v(e){return e&&parseInt(e.substring(e.lastIndexOf("/")+1,e.length),10)}function g(e,t){var r,n=t[0],i=t[1],o=t[2],a=t[3],s=0;n<e[0]&&(s+=(r=e[0]-n)*r);i<e[1]&&(s+=(r=e[1]-i)*r);o<e[2]&&(s+=(r=e[2]-o)*r);n>e[3]&&(s+=(r=n-e[3])*r);i>e[4]&&(s+=(r=i-e[4])*r);o>e[5]&&(s+=(r=o-e[5])*r);if(s>a*a)return 0;if(s>0)return 1;var u=1/0;return n-e[0]<u&&(u=n-e[0]),i-e[1]<u&&(u=i-e[1]),o-e[2]<u&&(u=o-e[2]),e[3]-n<u&&(u=e[3]-n),e[4]-i<u&&(u=e[4]-i),e[5]-o<u&&(u=e[5]-o),u>a?2:1}function y(e,t,r){for(var n=[],i=r&&r.missingFields,o=r&&r.originalFields,a=0,s=e;a<s.length;a++){for(var u=s[a],l=u.toLowerCase(),c=!1,d=0,f=t;d<f.length;d++){var h=f[d];if(l===h.name.toLowerCase()){n.push(h.name),c=!0,o&&o.push(u);break}}!c&&i&&i.push(u)}return n}function m(e,t,r){if(null!=e.maxRecordCount&&t.length>e.maxRecordCount){var n=function(e,t){for(var r=e.length,n=Math.ceil(r/t),i=[],o=0;o<n;o++){var a=Math.floor(r*o/n),s=Math.floor(r*(o+1)/n);i.push(e.slice(a,s))}return i}(t,e.maxRecordCount);return o.all(n.map(function(t){return m(e,t,r)})).then(w)}var a=new d({objectIds:t,outFields:r,orderByFields:[e.objectIdField]});return new c(e.parsedUrl.path).execute(a).then(function(e){return e&&e.features&&e.features.length===t.length?e.features.map(function(e){return e.attributes}):o.reject(new i("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function b(e,t,n,s,u){for(var l=[],c=0;c<t.attributeData.length;c++){var d=t.attributeData[c],h=e[c];if(h&&-1!==s.indexOf(h.name)){var p=a.makeAbsolute(d.href,t.baseUrl);l.push({url:p,storageInfo:h})}}return o.eachAlways(l.map(function(e){return r(e.url,{responseType:"array-buffer"}).then(function(t){return f.readBinaryAttribute(e.storageInfo,t.data)})})).then(function(e){var t=[];if(!u.ignoreUnavailableFields&&e.some(function(e){return null==e.value})){for(var r=[],a=0;a<e.length;a++)null==e[a].value&&r.push({name:l[a].storageInfo.name,error:e[a].error});return o.reject(new i("scenelayer:attribute-request-failed","Request for scene layer attributes failed",{failedAttributes:r}))}for(var s=0,c=n;s<c.length;s++){var d=c[s],f={};for(a=0;a<e.length;a++)null!=e[a].value&&(f[l[a].storageInfo.name]=_(e[a].value,d));t.push(f)}return t})}function _(e,t){var r=e[t];return p.isInt16Array(e)?r===M?null:r:p.isInt32Array(e)?r===N?null:r:r!=r?null:r}function w(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r];t=t.concat(i)}return t}function x(e){var t=new u(v(e.store.indexCRS||e.store.geographicCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function S(e){var t=new u(v(e.store.vertexCRS||e.store.projectedCRS));return t.equals(e.spatialReference)?e.spatialReference:t}function P(e,t,r){if(!l.canProject(e,t))throw new i("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===r&&e.isGeographic)throw new i("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",{})}function I(e,t,r){var n=x(e),i=S(e);P(n,t,r),P(i,t,r)}function z(e){return"mesh-3d"===e.type}Object.defineProperty(t,"__esModule",{value:!0}),t.DDS_ENCODING_STRING="image/vnd-ms.dds",t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"],t.extractWkid=v,t.getAppropriateTextureEncoding=function(e,r){if(Array.isArray(e)){if(r){var n=e.indexOf(t.DDS_ENCODING_STRING);if(n>-1)return n}for(var i=0;i<e.length;i++)if(t.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(e[i])>-1)return i;throw new Error("Could not find appropriate texture encoding (among "+e.toString()+")")}return-1},t.findIntersectingNodes=function e(t,r,n,i,o,a){if(null!=n){var s=n.mbs;if(r!==i&&(s=C,h.mbsToMbs(n.mbs,i,s,r)),0!==g(t,s)&&(a(n),n.children))for(var u=0;u<n.children.length;++u)e(t,r,o[n.children[u].id],i,o,a)}},t.buildTopNodeMap=function(e,t,r,n){if(void 0===n&&(n=Number.POSITIVE_INFINITY),t<=0)e.clear();else{var i=new Map,o=Number.POSITIVE_INFINITY;e.forEach(function(a,s){var u=r(a);if(s<t)return o=Math.min(o,u),void i.set(a.id,u);if(!(u<=o||u>=n)){i.set(a.id,u);for(var l=o=i.get(e.front().id),c=0,d=1;d<t;++d){var f=e.data[d],h=i.get(f.id);h<o&&(c=d,l=o,o=h)}e.data[c]=a,o=l}}),e.length=Math.min(e.length,t),e.sort(function(e,t){return i.get(t.id)-i.get(e.id)})}};var C=s.vec4f64.create();t.intersectBoundingBoxWithMbs=g,t.findFieldsCaseInsensitive=y,t.whenGraphicAttributes=function(e,t,r,a,s,u){var l=!0===(u&&u.populateObjectId),c=u.ignoreUnavailableFields?void 0:[],d=1===a.length&&"*"===a[0];!d&&l&&(a=function(e,t){return e.filter(function(e){return e.toLowerCase()!==t.toLowerCase()}).concat([t])}(a,r));var f=d?a:y(a,e.fields,{missingFields:c});if(c&&0!==c.length)return o.reject(new i("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:c}));if(0===t.length)return o.resolve(t);var h=e.associatedLayer,p=e.attributeStorageInfo,v=d?e.fields.map(function(e){return e.name}):f;if(h)return function(e,t,r,n){t.sort(function(e,t){return e.attributes[r]-t.attributes[r]});var i=t.map(function(e){return e.attributes[r]}),o=[],a=y(n,e.fields,{originalFields:o});return m(e,i,a).then(function(e){for(var r=0;r<t.length;r++){var n=t[r],i=e[r];n.attributes={};for(var s=0;s<o.length;s++)n.attributes[o[s]]=i[a[s]]}return t})}(h,t,r,v);var g=function(e,t){for(var r=[],n=0,i=e;n<i.length;n++){var o=i[n];o in t.attributes||r.push(o)}return r}(v,t[0]);if(0===g.length)return o.resolve(t);if(p){var _=s(t);return _?o.all(_.map(function(e){return b(p,e.node,e.indices,g,u).then(function(t){for(var r=0;r<e.graphics.length;r++){for(var n=0,i=v;n<i.length;n++){var o=i[n];o in t[r]||(t[r][o]=e.graphics[r].attributes[o])}e.graphics[r].attributes=t[r]}return e.graphics})})).then(n.concatAll):o.reject(new i("scenelayer:features-not-loaded","Tried to query attributes for unloaded features"))}return o.reject(new i("scenelayer:no-attribute-source","This scene layer does not have a source for attributes available"))};var M=-Math.pow(2,15),N=-Math.pow(2,31);t.getCachedAttributeValue=_,t.convertFlatRangesToOffsets=function(e,t,r){void 0===r&&(r=2);for(var n=null!=t?t:e.length/r,o=new Uint32Array(n+1),a=0;a<n;a++){var s=e[a*r],u=3*s;o[a]=u;var l=(a-1)*r+1;if(l>=0&&s-1!==e[l])throw new i("Face ranges are not continuous")}var c=3*(e[(n-1)*r+1]+1);return o[o.length-1]=c,o},t.getIndexCrs=x,t.getVertexCrs=S,t.getCacheKeySuffix=function(e,t){return t===h.SphericalECEFSpatialReference?"@ECEF":e.equals(t)?"":null!=t.wkid?"@"+t.wkid:null},t.checkSpatialReference=P,t.checkSpatialReferences=I,t.checkSceneLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null!=e.geometryType&&"triangles"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new i("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{})},t.checkSceneLayerCompatibleWithView=function(e,t){I(e,t.spatialReference,t.viewingMode)},t.checkPointCloudLayerValid=function(e){if(null==e.store||null==e.store.defaultGeometrySchema||!function(e){return!(null==e.geometryType||"points"!==e.geometryType||null!=e.topology&&"PerAttributeArray"!==e.topology||null!=e.encoding&&""!==e.encoding&&"lepcc-xyz"!==e.encoding||null==e.vertexAttributes||null==e.vertexAttributes.position)}(e.store.defaultGeometrySchema))throw new i("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{})},t.checkPointCloudLayerCompatibleWithView=function(e,t){P(e.spatialReference,t.spatialReference,t.viewingMode)},t.rendererNeedsTextures=function(e){if(null==e||!function(e){return"simple"===e.type||"class-breaks"===e.type||"unique-value"===e.type}(e))return!0;if(("unique-value"===e.type||"class-breaks"===e.type)&&null==e.defaultSymbol)return!0;var t=e.getSymbols();if(0===t.length)return!0;for(var r=0,n=t;r<n.length;r++){var i=n[r];if(!z(i)||0===i.symbolLayers.length)return!0;for(var o=0,a=i.symbolLayers.items;o<a.length;o++){var s=a[o];if("fill"!==s.type||null==s.material||"replace"!==s.material.colorMixMode)return!0}}return!1};var R=function(){return function(){this.edges=null,this.material=null}}();t.SymbolInfo=R,t.getSymbolInfo=function(e){for(var t=new R,r=!1,n=!1,i=0,o=e.symbolLayers.items;i<o.length;i++){var a=o[i];if("fill"===a.type&&a.enabled){var s=a.material,u=a.edges;if(s&&!r){var l=s.color;t.material={color:l?[l.r/255,l.g/255,l.b/255]:null,alpha:l?l.a:null,colorMixMode:s.colorMixMode},r=!0}u&&!n&&(t.edges=a.edges,n=!0)}}return t}}.apply(null,n))||(e.exports=i)},1427:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34),r(1359),r(1556),r(1368)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){return{center:r.vec3f64.clone(e),halfSize:r.vec3f32.clone(t),quaternion:r.quatf32.clone(n)}}function s(e,t){var r=o.plane.signedDistance(t,e.center),n=u(e,t);return r>n?1:r<-n?-1:0}function u(e,t){r.quat.conjugate(l,e.quaternion),r.vec3.transformQuat(c,t,l);var n=e.halfSize;return Math.abs(c[0]*n[0])+Math.abs(c[1]*n[1])+Math.abs(c[2]*n[2])}Object.defineProperty(t,"__esModule",{value:!0});var l=r.quatf32.create(),c=r.vec3f32.create(),d=r.vec3f32.create(),f=r.mat3f32.create(),h=function(){return function(e){var t=56*e;this.buffer=new ArrayBuffer(t),this.obbs=new Array(e);for(var n=0;n<e;n++)this.obbs[n]={center:r.vec3f64.createView(this.buffer,56*n+0),halfSize:r.vec3f32.createView(this.buffer,56*n+24),quaternion:r.quatf32.createView(this.buffer,56*n+36)}}}();t.ObbArray=h,t.create=a,t.clone=function(e){return a(e.center,e.halfSize,e.quaternion)},t.set=function(e,t){r.vec3.copy(t.center,e.center),r.vec3.copy(t.halfSize,e.halfSize),r.quat.copy(t.quaternion,e.quaternion)},t.compute=function(e,t){return t||(t=a([0,0,0],[-1,-1,-1],[0,0,0,1])),i.computeOBB(e,t),t},t.intersectPlane=s,t.toAaBoundingBox=function(e,t){t||(t=n.create());var i=r.mat3.fromQuat(f,e.quaternion),o=e.halfSize[0]*Math.abs(i[0])+e.halfSize[1]*Math.abs(i[3])+e.halfSize[2]*Math.abs(i[6]),a=e.halfSize[0]*Math.abs(i[1])+e.halfSize[1]*Math.abs(i[4])+e.halfSize[2]*Math.abs(i[7]),s=e.halfSize[0]*Math.abs(i[2])+e.halfSize[1]*Math.abs(i[5])+e.halfSize[2]*Math.abs(i[8]);return t[0]=e.center[0]-o,t[1]=e.center[1]-a,t[2]=e.center[2]-s,t[3]=e.center[0]+o,t[4]=e.center[1]+a,t[5]=e.center[2]+s,t},t.minimumDistancePlane=function(e,t){return o.plane.signedDistance(t,e.center)-u(e,t)},t.maximumDistancePlane=function(e,t){return o.plane.signedDistance(t,e.center)+u(e,t)},t.isVisible=function(e,t){return s(e,t.planes[0])<=0&&s(e,t.planes[1])<=0&&s(e,t.planes[2])<=0&&s(e,t.planes[3])<=0&&s(e,t.planes[4])<=0&&s(e,t.planes[5])<=0},t.intersectLine=function(e,t,n,i){void 0===i&&(i=0),r.quat.conjugate(l,e.quaternion),r.vec3.subtract(c,t,e.center);for(var o=r.vec3.transformQuat(c,c,l),a=r.vec3.transformQuat(d,n,l),s=-1/0,u=1/0,f=0;f<3;f++)if(Math.abs(a[f])>1e-6){var h=(i+e.halfSize[f]-o[f])/a[f],p=(-i-e.halfSize[f]-o[f])/a[f];s=Math.max(s,Math.min(h,p)),u=Math.min(u,Math.max(h,p))}else if(o[f]>e.halfSize[f]+i||o[f]<-e.halfSize[f]-i)return!1;return s<=u}}.apply(null,n))||(e.exports=i)},1428:function(e,t,r){var n,i;n=[r.dj.c(e.i),t],void 0===(i=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,n))||(e.exports=i)},1435:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9),r(4),r(7),r(1543)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n){for(var i="",o=0;o<n;){var a=e[t+o];if(a<128)i+=String.fromCharCode(a),o++;else if(a>=192&&a<224){if(o+1>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");var s=(31&a)<<6|63&e[t+o+1];i+=String.fromCharCode(s),o+=2}else if(a>=224&&a<240){if(o+2>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");s=(15&a)<<12|(63&e[t+o+1])<<6|63&e[t+o+2];i+=String.fromCharCode(s),o+=3}else{if(!(a>=240&&a<248))throw new r("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");if(o+3>=n)throw new r("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");if((s=(7&a)<<18|(63&e[t+o+1])<<12|(63&e[t+o+2])<<6|63&e[t+o+3])>=65536){var u=55296+(s-65536>>10),l=56320+(1023&s);i+=String.fromCharCode(u,l)}else i+=String.fromCharCode(s);o+=4}}return i}function s(e,r){for(var n={byteOffset:0,byteCount:0,fields:Object.create(null)},i=0,o=0;o<r.length;o++){var a=r[o],s=a.valueType||a.type,u=t.valueType2ArrayBufferReader[s];n.fields[a.property]=u(e,i),i+=t.valueType2TypedArrayClassMap[s].BYTES_PER_ELEMENT}return n.byteCount=i,n}function u(e,t,n){var i,o,s=[],u=0;for(o=0;o<e;o+=1){if((i=t[o])>0){if(s.push(a(n,u,i-1)),0!==n[u+i-1])throw new r("string-array-error","Invalid string array: missing null termination.")}else s.push(null);u+=i}return s}function l(e,r){return new(0,t.valueType2TypedArrayClassMap[r.valueType])(e,r.byteOffset,r.count*r.valuesPerElement)}function c(e,t){return new Uint8Array(e,t.byteOffset,t.byteCount)}function d(e,t,i){for(var o=null!=t.header?s(e,t.header):{byteOffset:0,byteCount:0,fields:{count:i}},a={header:o,byteOffset:o.byteCount,byteCount:0,entries:Object.create(null)},u=o.byteCount,l=0;l<t.ordering.length;l++){var c=t.ordering[l],d=n.clone(t[c]);if(d.count=o.fields.count,"String"===d.valueType){if(d.byteOffset=u,d.byteCount=o.fields[c+"ByteCount"],"UTF-8"!==d.encoding)throw new r("unsupported-encoding","Unsupported String encoding.",{encoding:d.encoding})}else{if(!h(d.valueType))throw new r("unsupported-value-type","Unsupported binary valueType",{valueType:d.valueType});var f=p(d.valueType);u+=u%f!=0?f-u%f:0,d.byteOffset=u,d.byteCount=f*d.valuesPerElement*d.count}u+=d.byteCount,a.entries[c]=d}return a.byteCount=u-a.byteOffset,a}function f(e,t,n){if(t!==e&&v.error("Invalid "+n+" buffer size\n expected: "+e+", actual: "+t+")"),t<e)throw new r("buffer-too-small","Binary buffer is too small",{expectedSize:e,actualSize:t})}function h(e){return t.valueType2TypedArrayClassMap.hasOwnProperty(e)}function p(e){return h(e)&&t.valueType2TypedArrayClassMap[e].BYTES_PER_ELEMENT}Object.defineProperty(t,"__esModule",{value:!0});var v=i.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");t.readHeader=s,t.readStringArray=u,t.createTypedView=l,t.createRawView=c,t.createAttributeDataIndex=d,t.createGeometryDataIndex=function(e,t,r){var i=s(e,t&&t.header),o=i.byteCount,a={header:i,byteOffset:i.byteCount,byteCount:0,vertexAttributes:n.clone(t.vertexAttributes)},u=a.vertexAttributes;r||null==u.region||delete u.region;for(var l=i.fields,c=null!=l.vertexCount?l.vertexCount:l.count,d=0;d<t.ordering.length;d++){var h=t.ordering[d];null!=u[h]&&(u[h].byteOffset=o,u[h].count=c,o+=p(u[h].valueType)*u[h].valuesPerElement*c)}var v=l.faceCount;if(t.faces&&v){a.faces=n.clone(t.faces);var g=a.faces;for(d=0;d<t.ordering.length;d++){var y=t.ordering[d];null!=g[y]&&(g[y].byteOffset=o,g[y].count=v,o+=p(g[y].valueType)*g[y].valuesPerElement*v)}}var m=l.featureCount;if(t.featureAttributes&&t.featureAttributeOrder&&m){a.featureAttributes=n.clone(t.featureAttributes);var b=a.featureAttributes;for(d=0;d<t.featureAttributeOrder.length;d++){var _=t.featureAttributeOrder[d];b[_].byteOffset=o,b[_].count=m;var w=p(b[_].valueType);"UInt64"===b[_].valueType&&(w=8),o+=w*b[_].valuesPerElement*m}}return f(o,e.byteLength,"geometry"),a.byteCount=o-a.byteOffset,a},t.readBinaryAttribute=function(e,t,n){if("lepcc-rgb"===e.encoding)return o.decodeRGB(t);if("lepcc-intensity"===e.encoding)return o.decodeIntensity(t);if(null!=e.encoding&&""!==e.encoding)throw new r("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");e["attributeByteCounts "]&&!e.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),e.attributeByteCounts=e["attributeByteCounts "]),"ObjectIds"===e.ordering[0]&&e.hasOwnProperty("objectIds")&&(v.warn("Warning: Case error in objectIds"),e.ordering[0]="objectIds");var i=d(t,e,n);f(i.byteOffset+i.byteCount,t.byteLength,"attribute");var a=i.entries.attributeValues||i.entries.objectIds;if(a){if("String"===a.valueType){var s=i.entries.attributeByteCounts,h=l(t,s),p=c(t,a);return u(s.count,h,p)}return l(t,a)}throw new r("bad-attribute-storage-info","Bad attributeStorageInfo specification.")},t.valueType2TypedArrayClassMap={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},t.valueType2ArrayBufferReader={Float32:function(e,t){return new DataView(e,0).getFloat32(t,!0)},Float64:function(e,t){return new DataView(e,0).getFloat64(t,!0)},UInt8:function(e,t){return new DataView(e,0).getUint8(t)},Int8:function(e,t){return new DataView(e,0).getInt8(t)},UInt16:function(e,t){return new DataView(e,0).getUint16(t,!0)},Int16:function(e,t){return new DataView(e,0).getInt16(t,!0)},UInt32:function(e,t){return new DataView(e,0).getUint32(t,!0)},Int32:function(e,t){return new DataView(e,0).getInt32(t,!0)}},t.isValueType=h,t.getBytesPerValue=p}.apply(null,n))||(e.exports=i)},1543:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(9)],void 0===(i=function(e,t,r){function n(e,t,r){return{identifier:String.fromCharCode.apply(null,new Uint8Array(e,r+c.identifierOffset,c.identifierLength)),version:t.getUint16(r+c.versionOffset,l),checksum:t.getUint32(r+c.checksumOffset,l)}}function i(e,t){return{sizeLo:e.getUint32(t+d.sizeLo,l),sizeHi:e.getUint32(t+d.sizeHi,l),minX:e.getFloat64(t+d.minX,l),minY:e.getFloat64(t+d.minY,l),minZ:e.getFloat64(t+d.minZ,l),maxX:e.getFloat64(t+d.maxX,l),maxY:e.getFloat64(t+d.maxY,l),maxZ:e.getFloat64(t+d.maxZ,l),errorX:e.getFloat64(t+d.errorX,l),errorY:e.getFloat64(t+d.errorY,l),errorZ:e.getFloat64(t+d.errorZ,l),count:e.getUint32(t+d.count,l),reserved:e.getUint32(t+d.reserved,l)}}function o(e,t,r){var n=[];t=a(e,t,n);for(var i=[],o=0;o<n.length;o++){i.length=0,t=a(e,t,i);for(var s=0;s<i.length;s++)r.push(i[s]+n[o])}return t}function a(e,t,n){var i=new DataView(e,t),o=i.getUint8(0),a=31&o,s=!!(32&o),u=(192&o)>>6,c=0;if(0===u)c=i.getUint32(1,l),t+=5;else if(1===u)c=i.getUint16(1,l),t+=3;else{if(2!==u)throw new r("lepcc-decode-error","Bad count type");c=i.getUint8(1),t+=2}if(s)throw new r("lepcc-decode-error","LUT not implemented");for(var d=Math.ceil(c*a/8),f=new Uint8Array(e,t,d),h=0,p=0,v=0,g=-1>>>32-a,y=0;y<c;y++){for(;p<a;)h|=f[v]<<p,p+=8,v+=1;n[y]=h&g,h>>>=a,(p-=a)+a>32&&(h|=f[v-1]>>8-p)}return t+v}function s(e,t){return{sizeLo:e.getUint32(t+f.sizeLo,l),sizeHi:e.getUint32(t+f.sizeHi,l),count:e.getUint32(t+f.count,l),colorMapCount:e.getUint16(t+f.colorMapCount,l),lookupMethod:e.getUint8(t+f.lookupMethod),compressionMethod:e.getUint8(t+f.compressionMethod)}}function u(e,t){return{sizeLo:e.getUint32(t+h.sizeLo,l),sizeHi:e.getUint32(t+h.sizeHi,l),count:e.getUint32(t+h.count,l),scaleFactor:e.getUint16(t+h.scaleFactor,l),bitsPerPoint:e.getUint8(t+h.bitsPerPoint),reserved:e.getUint8(t+h.reserved)}}Object.defineProperty(t,"__esModule",{value:!0});var l=!0,c={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16},d={sizeLo:0,sizeHi:4,minX:8,minY:16,minZ:24,maxX:32,maxY:40,maxZ:48,errorX:56,errorY:64,errorZ:72,count:80,reserved:84,byteCount:88};t.decodeXYZ=function(e){var t=new DataView(e,0),a=0,s=n(e,t,a),u=s.identifier,l=s.version;if(a+=c.byteCount,"LEPCC     "!==u)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var f=i(t,a);if(a+=d.byteCount,f.sizeHi*Math.pow(2,32)+f.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var h=new Float64Array(3*f.count),p=[],v=[],g=[],y=[];if((a=o(e,a=o(e,a=o(e,a=o(e,a,p),v),g),y))!==e.byteLength)throw new r("lepcc-decode-error","Bad length");for(var m=0,b=0,_=0;_<p.length;_++){b+=p[_];for(var w=0,x=0;x<v[_];x++){w+=g[m];var S=y[m];h[3*m]=Math.min(f.maxX,f.minX+2*f.errorX*w),h[3*m+1]=Math.min(f.maxY,f.minY+2*f.errorY*b),h[3*m+2]=Math.min(f.maxZ,f.minZ+2*f.errorZ*S),m++}}return{errorX:f.errorX,errorY:f.errorY,errorZ:f.errorZ,result:h}};var f={sizeLo:0,sizeHi:4,count:8,colorMapCount:12,lookupMethod:14,compressionMethod:15,byteCount:16};t.decodeRGB=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),a=o.identifier,u=o.version;if(i+=c.byteCount,"ClusterRGB"!==a)throw new r("lepcc-decode-error","Bad identifier");if(u>1)throw new r("lepcc-decode-error","Unknown version");var l=s(t,i);if(i+=f.byteCount,l.sizeHi*Math.pow(2,32)+l.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");if(2!==l.lookupMethod&&1!==l.lookupMethod||0!==l.compressionMethod){if(0===l.lookupMethod&&0===l.compressionMethod){if(3*l.count+i!==e.byteLength||0!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");return new Uint8Array(e,i).slice()}if(l.lookupMethod<=2&&1===l.compressionMethod){if(i+3!==e.byteLength||1!==l.colorMapCount)throw new r("lepcc-decode-error","Bad count");for(var d=t.getUint8(i),h=t.getUint8(i+1),p=t.getUint8(i+2),v=new Uint8Array(3*l.count),g=0;g<l.count;g++)v[3*g]=d,v[3*g+1]=h,v[3*g+2]=p;return v}throw new r("lepcc-decode-error","Bad method "+l.lookupMethod+","+l.compressionMethod)}if(3*l.colorMapCount+l.count+i!==e.byteLength||l.colorMapCount>256)throw new r("lepcc-decode-error","Bad count");var y=new Uint8Array(e,i,3*l.colorMapCount),m=new Uint8Array(e,i+3*l.colorMapCount,l.count);for(v=new Uint8Array(3*l.count),g=0;g<l.count;g++){var b=m[g];v[3*g]=y[3*b],v[3*g+1]=y[3*b+1],v[3*g+2]=y[3*b+2]}return v};var h={sizeLo:0,sizeHi:4,count:8,scaleFactor:12,bitsPerPoint:14,reserved:15,byteCount:16};t.decodeIntensity=function(e){var t=new DataView(e,0),i=0,o=n(e,t,i),s=o.identifier,l=o.version;if(i+=c.byteCount,"Intensity "!==s)throw new r("lepcc-decode-error","Bad identifier");if(l>1)throw new r("lepcc-decode-error","Unknown version");var d=u(t,i);if(i+=h.byteCount,d.sizeHi*Math.pow(2,32)+d.sizeLo!==e.byteLength)throw new r("lepcc-decode-error","Bad size");var f=new Uint16Array(d.count);if(8===d.bitsPerPoint){if(d.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(var p=new Uint8Array(e,i,d.count),v=0;v<d.count;v++)f[v]=p[v]*d.scaleFactor}else if(16===d.bitsPerPoint){if(2*d.count+i!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(p=new Uint16Array(e,i,d.count),v=0;v<d.count;v++)f[v]=p[v]*d.scaleFactor}else{if(a(e,i,p=[])!==e.byteLength)throw new r("lepcc-decode-error","Bad size");for(v=0;v<d.count;v++)f[v]=p[v]*d.scaleFactor}return f}}.apply(null,n))||(e.exports=i)},1556:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34)],void 0===(i=function(e,t,r){function n(e,t,n,i,o,s,u,l,c,d,f){return function(e,t,n){for(var i=r.vec3.squaredDistance(e.maxVert[0],e.minVert[0]),o=0,a=1;a<7;++a){var s=r.vec3.squaredDistance(e.maxVert[a],e.minVert[a]);s>i&&(i=s,o=a)}r.vec3.copy(t,e.minVert[o]),r.vec3.copy(n,e.maxVert[o])}(e,i,o),r.vec3.squaredDistance(i,o)<h?1:(r.vec3.subtract(u,i,o),r.vec3.normalize(u,u),function(e,t,n,i){for(var o=e.data,a=e.offsetIdx,s=e.strideIdx,u=Number.NEGATIVE_INFINITY,l=0,c=a;c<o.length;c+=s){r.vec3.set(P,o[c]-t[0],o[c+1]-t[1],o[c+2]-t[2]);var d=n[0]*P[0]+n[1]*P[1]+n[2]*P[2],f=n[0]*n[0]+n[1]*n[1]+n[2]*n[2],h=P[0]*P[0]+P[1]*P[1]+P[2]*P[2],p=h-d*d/f;p>u&&(u=p,l=c)}return r.vec3.set(i,o[l],o[l+1],o[l+2]),u}(t,i,u,s)<h?2:(r.vec3.subtract(l,o,s),r.vec3.normalize(l,l),r.vec3.subtract(c,s,i),r.vec3.normalize(c,c),r.vec3.cross(n,l,u),r.vec3.normalize(n,n),a(t,n,u,l,c,d),0))}function i(e,t,n,i,s,u,l,c,d,f){o(e,t,n,i,s,g,y),void 0!==g[0]&&(r.vec3.subtract(m,g,n),r.vec3.normalize(m,m),r.vec3.subtract(b,g,i),r.vec3.normalize(b,b),r.vec3.subtract(_,g,s),r.vec3.normalize(_,_),r.vec3.cross(w,b,u),r.vec3.normalize(w,w),r.vec3.cross(x,_,l),r.vec3.normalize(x,x),r.vec3.cross(S,m,c),r.vec3.normalize(S,S),a(e,w,u,b,m,d),a(e,x,l,_,b,d),a(e,S,c,m,_,d)),void 0!==y[0]&&(r.vec3.subtract(m,y,n),r.vec3.normalize(m,m),r.vec3.subtract(b,y,i),r.vec3.normalize(b,b),r.vec3.subtract(_,y,s),r.vec3.normalize(_,_),r.vec3.cross(w,b,u),r.vec3.normalize(w,w),r.vec3.cross(x,_,l),r.vec3.normalize(x,x),r.vec3.cross(S,m,c),r.vec3.normalize(S,S),a(e,w,u,b,m,d),a(e,x,l,_,b,d),a(e,S,c,m,_,d))}function o(e,t,n,i,o,a,s){!function(e,t,n,i,o){var a=e.data,s=e.offsetIdx,u=e.strideIdx;r.vec3.set(i,a[s],a[s+1],a[s+2]),r.vec3.copy(o,i),n[0]=r.vec3.dot(A,t),n[1]=n[0];for(var l=s+u;l<a.length;l+=u){var c=a[l]*t[0]+a[l+1]*t[1]+a[l+2]*t[2];c<n[0]&&(n[0]=c,r.vec3.set(i,a[l],a[l+1],a[l+2])),c>n[1]&&(n[1]=c,r.vec3.set(o,a[l],a[l+1],a[l+2]))}}(e,t,I,s,a);var u=r.vec3.dot(n,t);I[1]-h<=u&&(a[0]=void 0),I[0]+h>=u&&(s[0]=void 0)}function a(e,t,n,i,o,a){if(!(r.vec3.squaredLength(t)<h)){r.vec3.cross(z,n,t),r.vec3.cross(C,i,t),r.vec3.cross(M,o,t),s(e,t,I),R[1]=I[0],N[1]=I[1],O[1]=N[1]-R[1];for(var u=[n,i,o],l=[z,C,M],c=0;c<3;++c){s(e,u[c],I),R[0]=I[0],N[0]=I[1],s(e,l[c],I),R[2]=I[0],N[2]=I[1],O[0]=N[0]-R[0],O[2]=N[2]-R[2];var d=f(O);d<a.quality&&(r.vec3.copy(a.b0,u[c]),r.vec3.copy(a.b1,t),r.vec3.copy(a.b2,l[c]),a.quality=d)}}}function s(e,t,r){var n=e.data,i=e.offsetIdx,o=e.strideIdx;r[0]=Number.POSITIVE_INFINITY,r[1]=Number.NEGATIVE_INFINITY;for(var a=i;a<n.length;a+=o){var s=n[a]*t[0]+n[a+1]*t[1]+n[a+2]*t[2];r[0]=Math.min(r[0],s),r[1]=Math.max(r[1],s)}}function u(e,t,n){r.vec3.copy(n.center,e),r.vec3.scale(n.halfSize,t,.5),r.quat.identity(n.quaternion)}function l(e,t,n){r.vec3.copy(V,t),Math.abs(t[0])>Math.abs(t[1])&&Math.abs(t[0])>Math.abs(t[2])?V[0]=0:Math.abs(t[1])>Math.abs(t[2])?V[1]=0:V[2]=0,r.vec3.squaredLength(V)<h&&(V[0]=V[1]=V[2]=1),r.vec3.cross(U,t,V),r.vec3.normalize(U,U),r.vec3.cross(F,t,U),r.vec3.normalize(F,F),c(e,t,U,F,k,T),r.vec3.subtract(j,T,k),d(t,U,F,k,T,j,n)}function c(e,t,r,n,i,o){s(e,t,I),i[0]=I[0],o[0]=I[1],s(e,r,I),i[1]=I[0],o[1]=I[1],s(e,n,I),i[2]=I[0],o[2]=I[1]}function d(e,t,n,i,o,a,s){E[0]=e[0],E[1]=e[1],E[2]=e[2],E[3]=t[0],E[4]=t[1],E[5]=t[2],E[6]=n[0],E[7]=n[1],E[8]=n[2],r.quat.fromMat3(s.quaternion,E),r.vec3.add(L,i,o),r.vec3.scale(L,L,.5),r.vec3.scale(s.center,e,L[0]),r.vec3.scale(B,t,L[1]),r.vec3.add(s.center,s.center,B),r.vec3.scale(B,n,L[2]),r.vec3.add(s.center,s.center,B),r.vec3.scale(s.halfSize,a,.5)}function f(e){return e[0]*e[1]+e[0]*e[2]+e[1]*e[2]}Object.defineProperty(t,"__esModule",{value:!0});var h=1e-6,p=r.vec3f64.create(),v=r.vec3f64.create();t.computeOBB=function(e,t){var o=e.data,a=e.strideIdx,s=o.length/a;if(!(s<=0)){var h=new D(e);r.vec3.add(p,h.minProj,h.maxProj),r.vec3.scale(p,p,.5),r.vec3.subtract(v,h.maxProj,h.minProj);var g=f(v),y=new W;y.quality=g,s<14&&(e={data:new Float64Array(h.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var m=r.vec3f64.create(),b=r.vec3f64.create(),_=r.vec3f64.create(),w=r.vec3f64.create(),x=r.vec3f64.create(),S=r.vec3f64.create(),P=r.vec3f64.create();switch(n(h,e,P,m,b,_,w,x,S,y)){case 1:return void u(p,v,t);case 2:return void l(e,w,t)}i(e,P,m,b,_,w,x,S,y),c(e,y.b0,y.b1,y.b2,k,T);var I=r.vec3f64.create();r.vec3.subtract(I,T,k),y.quality=f(I),y.quality<g?d(y.b0,y.b1,y.b2,k,T,I,t):u(p,v,t)}};var g=r.vec3f64.create(),y=r.vec3f64.create(),m=r.vec3f64.create(),b=r.vec3f64.create(),_=r.vec3f64.create(),w=r.vec3f64.create(),x=r.vec3f64.create(),S=r.vec3f64.create(),P=r.vec3f64.create(),I=r.vec2f64.create(),z=r.vec3f64.create(),C=r.vec3f64.create(),M=r.vec3f64.create(),N=r.vec3f64.create(),R=r.vec3f64.create(),O=r.vec3f64.create(),A=r.vec3f64.create(),V=r.vec3f64.create(),U=r.vec3f64.create(),F=r.vec3f64.create(),k=r.vec3f64.create(),T=r.vec3f64.create(),j=r.vec3f64.create(),B=r.vec3f64.create(),E=r.mat3f32.create(),L=r.vec3f64.create(),q=7,D=function(){return function(e){this.minVert=new Array(q),this.maxVert=new Array(q);var t=64*q;this.buffer=new ArrayBuffer(t);var n=0;this.minProj=new Float64Array(this.buffer,n,q),n+=8*q,this.maxProj=new Float64Array(this.buffer,n,q),n+=8*q;for(var i=0;i<q;++i)this.minVert[i]=r.vec3f64.createView(this.buffer,n),n+=24;for(i=0;i<q;++i)this.maxVert[i]=r.vec3f64.createView(this.buffer,n),n+=24;for(i=0;i<q;++i)this.minProj[i]=Number.POSITIVE_INFINITY,this.maxProj[i]=Number.NEGATIVE_INFINITY;var o=new Array(q),a=new Array(q),s=e.data,u=e.offsetIdx,l=e.strideIdx;for(i=u;i<s.length;i+=l){var c=s[i];c<this.minProj[0]&&(this.minProj[0]=c,o[0]=i),c>this.maxProj[0]&&(this.maxProj[0]=c,a[0]=i),(c=s[i+1])<this.minProj[1]&&(this.minProj[1]=c,o[1]=i),c>this.maxProj[1]&&(this.maxProj[1]=c,a[1]=i),(c=s[i+2])<this.minProj[2]&&(this.minProj[2]=c,o[2]=i),c>this.maxProj[2]&&(this.maxProj[2]=c,a[2]=i),(c=s[i]+s[i+1]+s[i+2])<this.minProj[3]&&(this.minProj[3]=c,o[3]=i),c>this.maxProj[3]&&(this.maxProj[3]=c,a[3]=i),(c=s[i]+s[i+1]-s[i+2])<this.minProj[4]&&(this.minProj[4]=c,o[4]=i),c>this.maxProj[4]&&(this.maxProj[4]=c,a[4]=i),(c=s[i]-s[i+1]+s[i+2])<this.minProj[5]&&(this.minProj[5]=c,o[5]=i),c>this.maxProj[5]&&(this.maxProj[5]=c,a[5]=i),(c=s[i]-s[i+1]-s[i+2])<this.minProj[6]&&(this.minProj[6]=c,o[6]=i),c>this.maxProj[6]&&(this.maxProj[6]=c,a[6]=i)}for(i=0;i<q;++i){var d=o[i];r.vec3.set(this.minVert[i],s[d],s[d+1],s[d+2]),d=a[i],r.vec3.set(this.maxVert[i],s[d],s[d+1],s[d+2])}}}(),W=function(){return function(){this.b0=r.vec3f64.fromValues(1,0,0),this.b1=r.vec3f64.fromValues(0,1,0),this.b2=r.vec3f64.fromValues(0,0,1),this.quality=0}}()}.apply(null,n))||(e.exports=i)},1641:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(96),r(8)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this._deferreds=[],this._values=[]}return e.prototype.push=function(e){var t=this;return n.create(function(r,n){t._deferreds.push({resolve:r,reject:n}),t._values.push(e)})},e.prototype.unshift=function(e){var t=this;return n.create(function(r,n){t._deferreds.unshift({resolve:r,reject:n}),t._values.unshift(e)})},e.prototype.length=function(){return this._deferreds.length},e.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())},e.prototype.cancelAll=function(){for(var e=new r,t=0,n=this._deferreds;t<n.length;t++)n[t].reject(e);this._deferreds.length=0,this._values.length=0},e}();t.IdleQueue=i}.apply(null,n))||(e.exports=i)},1777:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1727),r(1730),r(1731),r(1435)],void 0===(i=function(e,t,r,n,i,o){function a(e){for(var t=0,r=0,n=e||[];r<n.length;r++)t|=1<<n[r];return t}function s(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t&&null!=i.attributeValues&&"UInt8"===i.attributeValues.valueType&&3===i.attributeValues.valuesPerElement)return{storageInfo:i,useElevation:!1}}return null}function u(e,t){for(var r=0,n=e;r<n.length;r++){var i=n[r];if(i.name===t){var o="embedded-elevation"===i.encoding;return{storageInfo:o?null:i,useElevation:o}}}return"elevation"===t.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function l(e,t,r,n){if(e&&e.useElevation){for(var i=new Float64Array(n),a=0;a<n;a++)i[a]=r[3*a+2];return i}return e&&t?o.readBinaryAttribute(e.storageInfo,t,n):null}function c(e){return null==e||"none"===e?null:"low-four-bit"===e?function(e){return 15&e}:"high-four-bit"===e?function(e){return(240&e)>>4}:"absolute-value"===e?function(e){return Math.abs(e)}:"modulo-ten"===e?function(e){return e%10}:null}Object.defineProperty(t,"__esModule",{value:!0}),t.getRendererInfo=function(e){var t=e.renderer,r=t&&t.type,n=t&&e.renderer.toJSON()||null,i=null,o=!1;"point-cloud-unique-value"===r?i=u(e.attributeStorageInfo,t.field):"point-cloud-stretch"===r?i=u(e.attributeStorageInfo,t.field):"point-cloud-class-breaks"===r?i=u(e.attributeStorageInfo,t.field):o="point-cloud-rgb"===r?null!=(i=s(e.attributeStorageInfo,t.field)):null!=(i=s(e.attributeStorageInfo,"RGB"));var a=null;return t&&t.colorModulation&&(a=u(e.attributeStorageInfo,t.colorModulation.field)),{rendererJSON:n,isRGBRenderer:o,primaryAttribute:i,modulationAttribute:a}},t.getFilterInfo=function(e){var t=e.filters;return t?t.map(function(t){return{filterJSON:t.toJSON(),attributeInfo:u(e.attributeStorageInfo,t.field)}}):[]},t.evaluateRenderer=function(e,t,o,a,s){var u=e.rendererJSON,d=e.isRGBRenderer,f=e.primaryAttribute,h=e.modulationAttribute,p=l(f,t,a,s),v=l(h,o,a,s),g=null,y=null;if(p&&d)g=p;else if(p&&"pointCloudUniqueValueRenderer"===u.type){var m=(y=i.fromJSON(u)).colorUniqueValueInfos;g=new Uint8Array(3*s);for(var b=c(y.fieldTransformType),_=0;_<s;_++)for(var w=(P=b?b(p[_]):p[_])+"",x=0;x<m.length;x++)if(m[x].values.indexOf(w)>=0){g[3*_]=m[x].color.r,g[3*_+1]=m[x].color.g,g[3*_+2]=m[x].color.b;break}}else if(p&&"pointCloudStretchRenderer"===u.type){var S=(y=n.fromJSON(u)).stops;for(g=new Uint8Array(3*s),b=c(y.fieldTransformType),_=0;_<s;_++){var P=b?b(p[_]):p[_],I=S.length-1;if(P<S[0].value)g[3*_]=S[0].color.r,g[3*_+1]=S[0].color.g,g[3*_+2]=S[0].color.b;else if(P>=S[I].value)g[3*_]=S[I].color.r,g[3*_+1]=S[I].color.g,g[3*_+2]=S[I].color.b;else for(x=1;x<S.length;x++)if(P<S[x].value){var z=(P-S[x-1].value)/(S[x].value-S[x-1].value);g[3*_]=S[x].color.r*z+S[x-1].color.r*(1-z),g[3*_+1]=S[x].color.g*z+S[x-1].color.g*(1-z),g[3*_+2]=S[x].color.b*z+S[x-1].color.b*(1-z);break}}}else if(p&&"pointCloudClassBreaksRenderer"===u.type){var C=(y=r.fromJSON(u)).colorClassBreakInfos;for(g=new Uint8Array(3*s),b=c(y.fieldTransformType),_=0;_<s;_++)for(P=b?b(p[_]):p[_],x=0;x<C.length;x++)if(P>=C[x].minValue&&P<=C[x].maxValue){g[3*_]=C[x].color.r,g[3*_+1]=C[x].color.g,g[3*_+2]=C[x].color.b;break}}else for(g=new Uint8Array(3*s),_=0;_<g.length;_++)g[_]=255;if(v&&y&&y.colorModulation){var M=y.colorModulation.minValue,N=y.colorModulation.maxValue;for(_=0;_<s;_++){var R=(P=v[_])>=N?1:P<=M?.3:.3+.7*(P-M)/(N-M);g[3*_]=R*g[3*_],g[3*_+1]=R*g[3*_+1],g[3*_+2]=R*g[3*_+2]}}return g},t.filterInPlace=function(e,t,r,n){for(var i=e.length/3,o=n.map(function(t,n){return l(r[n].attributeInfo,t,e,i)}),s=0,u=0;u<i;u++){for(var c=!0,d=0;d<r.length&&c;d++){var f=r[d].filterJSON,h=o[d][u];switch(f.type){case"pointCloudValueFilter":var p="exclude"===f.mode;-1!==f.values.indexOf(h)===p&&(c=!1);break;case"pointCloudBitfieldFilter":var v=a(f.requiredSetBits),g=a(f.requiredClearBits);(h&v)===v&&0==(h&g)||(c=!1);break;case"pointCloudReturnFilter":for(var y=15&h,m=h>>>4&15,b=m>1,_=1===y,w=y===m,x=!1,S=0,P=f.includedReturns;S<P.length;S++){var I=P[S];if("last"===I&&w||"firstOfMany"===I&&_&&b||"lastOfMany"===I&&w&&b||"single"===I&&!b){x=!0;break}}x||(c=!1)}}c&&(e[3*s]=e[3*u],e[3*s+1]=e[3*u+1],e[3*s+2]=e[3*u+2],t[3*s]=t[3*u],t[3*s+1]=t[3*u+1],t[3*s+2]=t[3*u+2],s++)}return s},t.getSplatSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"splat"===t.type?t:null},t.getFixedSizeAlgorithm=function(e){var t=e&&e.pointSizeAlgorithm;return t&&"fixed-size"===t.type?t:null},t.rendererUsesFixedSizes=function(e){var t=e&&e.pointSizeAlgorithm;return!(!t||!t.type)&&"fixed-size"===t.type}}.apply(null,n))||(e.exports=i)},2383:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(2),r(1),r(36),r(69),r(69),r(7),r(8),r(160),r(26),r(15),r(124),r(0),r(34),r(1359),r(70),r(489),r(1437),r(1327),r(1418),r(1641),r(2384),r(2385),r(1777),r(2386),r(1428),r(1368),r(1427),r(80),r.dj.m(e)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c,d,f,h,p,v,g,y,m,b,_,w,x,S,P,I,z,C,M,N,R){var O=s.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),A=C.plane.create();return function(t){function s(){var e=null!==t&&t.apply(this,arguments)||this;return e.maximumPointCount=4e6,e.slicePlaneEnabled=!1,e._renderer=null,e._rendererAdded=!1,e._renderedNodes=new Set,e._updateViewNeeded=!0,e._lodFactor=1,e._worker=new b,e._maxLoggedBoxWarnings=5,e._pageMultiplier=1,e._indexQueue=[],e._workQueue=[],e._idleQueue=new w.IdleQueue,e._indexPagesLoading=new Map,e._loadingNodes=new Map,e._layerIsVisible=!1,e._totalWork=0,e._index=null,e._loadingInitNodePage=!1,e._nodeIdArray=[],e}return r(s,t),Object.defineProperty(s.prototype,"pointScale",{get:function(){var e=P.getSplatSizeAlgorithm(this.layer.renderer);return e&&null!=e.scaleFactor?e.scaleFactor:1},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"useRealWorldSymbolSizes",{get:function(){var e=P.getFixedSizeAlgorithm(this.layer.renderer);return!(!e||null==e.useRealWorldSymbolSizes)&&e.useRealWorldSymbolSizes},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"pointSize",{get:function(){var e=P.getFixedSizeAlgorithm(this.layer.renderer);return e&&null!=e.size?e.size:0},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_clippingBox",{get:function(){var e=v.create(),t=this.view.renderSpatialReference;return N.extentToBoundingBox(this.view.clippingArea,e,t)?e:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"_elevationOffset",{get:function(){var e=this.layer.elevationInfo;if(e&&"absolute-height"===e.mode){var t=g.getMetersPerVerticalUnitForSR(this.layer.spatialReference),r=y.getMetersPerUnit(e.unit);return(e.offset||0)*r/t}return 0},enumerable:!0,configurable:!0}),s.prototype.initialize=function(){var t=this;_.checkPointCloudLayerValid(this.layer),_.checkPointCloudLayerCompatibleWithView(this.layer,this.view),this._initRenderer();var r=this._initNodePages(),n={idleBegin:function(){return t._idleBegin()},idleEnd:function(){return t._idleEnd()}};f.open(l.getAbsMid("./PointCloudWorker",e,R)).then(function(e){t.destroyed?e.close():t._worker.thread=e}),this._memCache=this.view.resourceController.getMemCache(this.layer.uid),this.handles.add(d.init(this,"_clippingBox",function(){return t._setUpdateViewNeeded()})),this.handles.add(d.init(this,"_elevationOffset",function(){return t._elevationOffsetChanged()})),this.handles.add(d.init(this.layer,"renderer",function(){return t._rendererChanged()})),this.handles.add(d.init(this.layer,"filters",function(){return t._filterChanged()})),this.handles.add(d.init(this,"clippingArea",function(){t._setUpdateViewNeeded()})),this.handles.add(this.view.state.watch("camera",function(){t._setUpdateViewNeeded()})),this.view.resourceController.memoryEvents.on("quality-changed",function(){return t._setUpdateViewNeeded()}),this.addResolvingPromise(r),this.when(function(){t.handles.add(t.view.resourceController.registerFrameWorker(function(e){return t._process(e)})),t.handles.add(t.view.resourceController.registerIdleFrameWorker(n)),t.handles.add(d.init(t,"suspended",function(e){e?t._clearNodeState():t._setUpdateViewNeeded()}))})},s.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0,this._updateLoading()},s.prototype.destroy=function(){this._cancelNodeLoading(),this._worker&&this._worker.thread&&(this._worker.thread.close(),this._worker.thread=null,this._worker=null),this._destroyRenderer(),this._memCache.destroy(),this._memCache=null},s.prototype._initRenderer=function(){var e=this;this._renderer=new I,this._renderer.layerUid=this.layer.uid,this.handles.add(d.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this.handles.add(d.init(this,"_clippingBox",function(t){e._renderer.clippingBox=t})),this.handles.add(d.init(this,"suspended",function(t){return e._setPointsVisible(!t)})),this.handles.add(d.init(this,"pointScale",function(t){e._renderer.scaleFactor=t})),this._renderer.minSizePx=Math.sqrt(2),this.handles.add(d.init(this,"useRealWorldSymbolSizes",function(t){e._renderer.useRealWorldSymbolSizes=t})),this.handles.add(d.init(this,"pointSize",function(t){var r=c.pt2px(t);e._renderer.size=t,e._renderer.sizePx=r})),this.handles.add(d.init(this,"slicePlaneEnabled",function(t){e._renderer.slicePlaneEnabled=t})),this.handles.add(d.init(this,["inverseDensity","maximumPointCount"],function(){e._setUpdateViewNeeded()})),this.handles.add(d.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(t){e._lodFactor=t,e._setUpdateViewNeeded()}))},s.prototype._destroyRenderer=function(){this._setPointsVisible(!1)},s.prototype._setPointsVisible=function(e){e&&!this._rendererAdded?(this.view._stage.addRenderPlugin([5],this._renderer),this._rendererAdded=!0):!e&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)},s.prototype._rendererChanged=function(){this._clearNodeState(),this._memCache.clear(),this._renderer.useFixedSizes=P.rendererUsesFixedSizes(this.layer.renderer),this._setUpdateViewNeeded()},s.prototype._filterChanged=function(){this._clearNodeState(),this._memCache.clear(),this._setUpdateViewNeeded()},s.prototype._elevationOffsetChanged=function(){this._clearNodeState(),this._memCache.clear(),this._initNodePages()},s.prototype.displayNodes=function(e){this._workQueue=x.nodeDiff(o.keysOfSet(this._renderedNodes),e,this._index),x.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index),x.splitWorkEntries(this._workQueue,8,this._index),this._updateQueues(),this._totalWork=this._computeWork(),this._updateLoading(),this._layerIsVisible=e.length>0||this._loadingInitNodePage,this.notifyChange("suspended")},s.prototype.cancelLoading=function(){this._cancelNodeLoading(),this._cancelIndexLoading()},s.prototype._cancelNodeLoading=function(){var e=[];this._loadingNodes.forEach(function(t){return e.push(t)}),this._loadingNodes.clear();for(var t=0,r=e;t<r.length;t++)r[t].cancel();this._workQueue=[],this._idleQueue.cancelAll(),this._totalWork=this._computeWork(),this._updateLoading()},s.prototype._updateQueues=function(){var e=this,t=new Set;this._workQueue.forEach(function(e){e.load.forEach(function(e){t.add(e)})});var r=[],n=new Map;this._loadingNodes.forEach(function(e,i){t.has(i)?n.set(i,e):r.push(e)}),this._loadingNodes=n;for(var i=0,o=r;i<o.length;i++)o[i].cancel();this._workQueue=this._workQueue.filter(function(t){for(var r=0,n=t.load;r<n.length;r++){var i=n[r];if(e._loadingNodes.has(i))return!1}return!0}),this._totalWork=this._computeWork(),this._updateLoading()},s.prototype._cancelIndexLoading=function(){this._indexQueue=[],this._indexPagesLoading.forEach(function(e){return e.cancel()}),this._indexPagesLoading.clear(),this._totalWork=this._computeWork(),this._updateLoading()},s.prototype._clearNodeState=function(){var e=this;this._renderedNodes.forEach(function(t){return e._removeFromRenderer(t)}),this._cancelNodeLoading()},s.prototype._idleBegin=function(){this._setUpdateViewNeeded()},s.prototype._idleEnd=function(){this._setUpdateViewNeeded()},s.prototype._process=function(e){var t=this;if(this.suspended){if(this._updateViewNeeded){this._updateViewNeeded=!1;var r=this._isRootNodeVisible();r!==this._layerIsVisible&&(this._layerIsVisible=r,this.notifyChange("suspended"))}}else{for(this._updateViewNeeded&&e.run(function(){return t._updateWorkQueues()});this._indexQueue.length>0&&e.run(function(){return t._processIndexQueue()}););for(this._processWorkQueue(e);this._idleQueue.length()>0&&e.run(function(){return t._idleQueue.process()}););}},s.prototype._processIndexQueue=function(){var e=this,t=this._indexQueue.shift();this._indexPagesLoading.set(t,this._loadNodePage(t)),this._indexPagesLoading.get(t).then(function(r){e._index.addPage(t,r,e._elevationOffset),e._setUpdateViewNeeded()}).then(function(){e._indexPagesLoading.delete(t)},function(){e._indexPagesLoading.delete(t)})},s.prototype._processWorkQueue=function(e){for(;!e.done();){var t=this._scheduleWorkEntry();if(!t)return;this._processWorkEntry(t)}},s.prototype._scheduleWorkEntry=function(){var e=this;if(this._loadingNodes.size>=8)return null;for(var t=0;t<this._workQueue.length;++t){var r=this._workQueue[t];if(!a.find(r.remove,function(t){return!e._renderedNodes.has(t)})){for(var n=t;n>0;--n)this._workQueue[n]=this._workQueue[n-1];return this._workQueue.shift(),r}}return null},s.prototype._processWorkEntry=function(e){var t=this;if(0!==e.load.length)u.all(e.load.map(function(e){var r=t._memCache.pop(e.toString());return r?t._loadingNodes.set(e,u.resolve(r)):t._loadingNodes.has(e)||t._loadingNodes.set(e,t.loadNode(e)),t._loadingNodes.get(e)})).then(function(r){for(var n=0;n<e.load.length;n++)if(r[n]){var i=t._setupRendererData(e.load[n],r[n]);t._addToRenderer(i)}for(n=0;n<e.remove.length;n++)t._removeFromRenderer(e.remove[n])}).catch(function(){}).then(function(){for(var r=0;r<e.load.length;r++)t._loadingNodes.delete(e.load[r]);t._updateLoading()}),this._updateLoading();else for(var r=0;r<e.remove.length;r++)this._removeFromRenderer(e.remove[r])},s.prototype._computeWork=function(){for(var e=0,t=0;t<this._workQueue.length;t++)e+=this._workQueue[t].load.length;return e+=this._loadingNodes.size,e+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize,(e+=this._loadingInitNodePage?100:0)+(this._updateViewNeeded?100:0)},Object.defineProperty(s.prototype,"updatingPercentageValue",{get:function(){var e=this._computeWork();return 100*Math.min(this._totalWork,e)/this._totalWork},enumerable:!0,configurable:!0}),s.prototype._updateLoading=function(){this.notifyChange("updating"),this.notifyChange("updatingPercentageValue")},s.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible},s.prototype.isUpdating=function(){return this._computeWork()>0},s.prototype._initNodePages=function(){var e=this,t=this.layer.store.index,r=t.nodesPerPage||t.nodePerIndexBlock;return this._index=new S(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,r),this._cancelIndexLoading(),this._traverseVisible=this._index.createVisibilityTraverse(),this._loadingInitNodePage=!0,this._layerIsVisible=!0,this.notifyChange("suspended"),this._updateLoading(),this._pageMultiplier=null!=t.nodesPerPage?1:t.nodePerIndexBlock,this._loadNodePage(0).then(function(t){e._index.addPage(0,t,e._elevationOffset),e._loadingInitNodePage=!1,e._setUpdateViewNeeded()})},s.prototype._loadNodePage=function(e){var t=this,r=this.baseUrl+"/nodepages/"+e*this._pageMultiplier;return this._requestJSON(r).then(function(r){return r.data.nodes.map(function(r,n){return{resourceId:null!=r.resourceId?r.resourceId:e*t._index.pageSize+n,obb:r.obb,firstChild:r.firstChild,childCount:r.childCount,vertexCount:null!=r.vertexCount?r.vertexCount:r.pointCount,lodThreshold:null!=r.lodThreshold?r.lodThreshold:r.effectiveArea}})})},s.prototype._updateWorkQueues=function(){for(var e=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),t=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor(),r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(n/(.75*t));n>t;)e*=i,r=this._computeNodesForMinimumDensity(e),n=this._computePointCount(r),i=Math.sqrt(2);this.displayNodes(r),this._updateViewNeeded=!1,this._updateLoading()},s.prototype._computePointCount=function(e){for(var t=0,r=0;r<e.length;r++){var n=this._index.getNode(e[r]);n&&(t+=n.vertexCount)}return t},s.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor},s.prototype._isRootNodeVisible=function(){var e=!1;return this._traverseVisible({frustumPlanes:this.view.state.camera.frustum.planes,clippingBox:this._clippingBox},{predicate:function(t,r,n){return e=n,!1},pageMiss:function(e,t){}}),e},s.prototype._computeNodesForMinimumDensity=function(e){var t=this,r=this.view.state.camera,n=r.frustum,i=this._clippingBox,o=r.viewForward,a=p.vec3.dot(o,r.eye),s=C.plane.fromNormalAndOffset(o,-a,A),u=r.perPixelRatio,l=e*e,c=this._nodeIdArray;return c.length=0,this._traverseVisible({frustumPlanes:n.planes,clippingBox:i},{predicate:function(e,r,n){if(!n)return!1;if(0===r.childCount)return c.push(e),!1;var i=t._index.getRenderObb(e);return!(t._computeAveragePixelArea(i,r.lodThreshold,r.vertexCount,s,u)<=l&&(c.push(e),1))},pageMiss:function(e,r){c.push(e),t._indexQueue.indexOf(r)<0&&t._indexQueue.push(r)}}),c},s.prototype._computeAveragePixelArea=function(e,t,r,n,i){var o=Math.max(1e-7,M.minimumDistancePlane(e,n));return t/(o*o)/(4*i*i)/r},s.prototype.loadNode=function(e){var t=this,r=this._index.getNode(e),n=P.getRendererInfo(this.layer),i=P.getFilterInfo(this.layer),o=r.resourceId,a=[],s=function(e){var r=t.loadAttribute(o,e);return a.push(r),r};return this._idleQueue.push().then(function(){var e=t.loadGeometry(o);a.push(e);var r=s(n.primaryAttribute),l=s(n.modulationAttribute),c=i.map(function(e){return s(e.attributeInfo)});return u.all([e,r,l,u.all(c)])}).then(function(r){var o=r[0],a=r[1],s=r[2],u=r[3],l=[o];a&&l.push(a),s&&l.push(s);for(var c=0,d=u;c<d.length;c++){var f=d[c];l.push(f)}var h={geometryBuffer:o,primaryAttribute:a,modulationAttribute:s,filterAttributes:u,schema:t.layer.store.defaultGeometrySchema,rendererInfo:n,filterInfo:i,obb:t._index.getRenderObb(e),elevationOffset:t._elevationOffset,inSR:t.layer.spatialReference.toJSON(),outSR:t.view.renderCoordsHelper.spatialReference.toJSON()};return t._worker.transform(h,l)}).catch(function(e){if(null==e||"CancelError"!==e.name&&"AbortError"!==e.name)O.error(e);else for(var t=0,r=a;t<r.length;t++){r[t].cancel()}return u.reject(e)})},s.prototype.loadGeometry=function(e){var t=this.baseUrl+"/nodes/"+e+"/geometries/0";return this._requestBinary(t).then(function(e){return e.data})},s.prototype.loadAttribute=function(e,t){if(!t||!t.storageInfo)return u.resolve(null);var r=t.storageInfo.key,n=this.baseUrl+"/nodes/"+e+"/attributes/"+r;return this._requestBinary(n).then(function(e){return e.data})},s.prototype._requestJSON=function(e){return i(e,{query:{f:"json"},responseType:"json"})},s.prototype._requestBinary=function(e){return i(e,{responseType:"array-buffer"})},s.prototype._removeFromRenderer=function(e){if(this._renderedNodes.has(e)){var t=this._renderer.removeNode(e);this._renderedNodes.delete(e),this._memCache.put(t.id.toString(),t,function(e){return 5*e.coordinates.length+128}(t))}},s.prototype._addToRenderer=function(e){this._renderedNodes.has(e.id)||(this._renderedNodes.add(e.id),this._renderer.addNode(e))},s.prototype._setupRendererData=function(e,t){var r=this._index.getNode(e),n=Math.sqrt(r.lodThreshold/r.vertexCount),i=this._index.getRenderObb(e);return I.isInstanceOfNode(t)?(t.splatSize=n,t.obb=i,t.origin=p.vec3f32.clone(t.obb.center),t):((t.obb.halfSize[0]>i.halfSize[0]||t.obb.halfSize[1]>i.halfSize[1]||t.obb.halfSize[2]>i.halfSize[2])&&(this._maxLoggedBoxWarnings>0&&(O.warn("Node",e,"reported bounding box too small, got",i,"but points cover",t.obb),0==--this._maxLoggedBoxWarnings&&O.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(e,t.obb)),{id:e,coordinates:t.points,origin:p.vec3f32.clone(i.center),rgb:t.rgb,splatSize:n,obb:i,isLeaf:0===r.childCount})},s.prototype.getUsedMemory=function(){var e=this;return o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+15*e._index.getNode(r).vertexCount+128},0)},s.prototype.getUnloadedMemory=function(){var e=this,t=this._renderedNodes.size;if(t<4)return 0;for(var r=o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount}),n=this._loadingNodes.size,i=0;i<this._workQueue.length;i++)n+=this._workQueue[i].load.length,n-=this._workQueue[i].remove.length;return n<0?0:n*r/t*15+128*n},s.prototype.ignoresMemoryFactor=function(){return!1},s.prototype.getStats=function(){var e=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":o.keysOfSet(this._renderedNodes).reduce(function(t,r){return t+e._index.getNode(r).vertexCount},0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}},n([h.property()],s.prototype,"layer",void 0),n([h.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],s.prototype,"baseUrl",void 0),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"pointScale",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"useRealWorldSymbolSizes",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"pointSize",null),n([h.property({readOnly:!0,dependsOn:["layer.renderer"]})],s.prototype,"inverseDensity",null),n([h.property()],s.prototype,"maximumPointCount",void 0),n([h.property({readOnly:!0,dependsOn:["view.clippingArea"]})],s.prototype,"_clippingBox",null),n([h.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],s.prototype,"_elevationOffset",null),n([h.property({type:Boolean})],s.prototype,"slicePlaneEnabled",void 0),n([h.property(z.updatingPercentage)],s.prototype,"updatingPercentage",void 0),n([h.property({readOnly:!0})],s.prototype,"updatingPercentageValue",null),n([h.subclass("esri.views.3d.layers.PointCloudLayerView3D")],s)}(h.declared(m))}.apply(null,n))||(e.exports=i)},2384:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34)],void 0===(i=function(e,t,r){function n(e,t,r){for(var n=e;n>0;){var i=t.indexOf(n);if(i>=0)return i;n=r.getParentId(n)}return t.indexOf(n)}function i(e,t){for(var r=[e.remove[0]],n=[];1===r.length;){var i=r.pop();n.length=0;for(var o=0;o<e.load.length;o++){for(var a=e.load[o],s=t.getParentId(a);s!==i;)a=s,s=t.getParentId(a);var u=r.indexOf(a);u<0&&(u=r.length,r.push(a),n.push([])),n[u].push(e.load[o])}}var l=[];l.push({remove:e.remove,load:r});for(o=0;o<r.length;o++)n[o].length>1?l.push({remove:[r[o]],load:n[o]}):r[o]=n[o][0];return l}Object.defineProperty(t,"__esModule",{value:!0}),t.nodeDiff=function(e,t,r){for(var i=0;i<t.length;i++)s[i]=!1,u[i]=null;for(i=0;i<e.length;i++)o[i]=!1,a[i]=null;for(i=0;i<t.length;i++)(l=n(t[i],e,r))>=0&&(s[i]=!0,null!=a[l]?a[l].push(t[i]):a[l]=[t[i]]);for(i=0;i<e.length;i++){var l;(l=n(e[i],t,r))>=0&&(o[i]=!0,null!=u[l]?u[l].push(e[i]):u[l]=[e[i]])}var c=[];for(i=0;i<e.length;i++)null!=a[i]||o[i]||c.push({load:[],remove:[e[i]]});for(i=0;i<t.length;i++)null!=u[i]||s[i]||c.push({load:[t[i]],remove:[]});for(i=0;i<t.length;i++)null!=u[i]&&(u[i].length>1||u[i][0]!==t[i])&&c.push({load:[t[i]],remove:u[i]});for(i=0;i<e.length;i++)null!=a[i]&&(a[i].length>1||a[i][0]!==e[i])&&c.push({load:a[i],remove:[e[i]]});return c};var o=[!1],a=[null],s=[!1],u=[null];t.sortFrontToBack=function(e,t,n){return e.sort(function(e,i){if(0===e.load.length&&0===i.load.length)return 0;if(0===e.load.length)return-1;if(0===i.load.length)return 1;if(0===e.remove.length&&0===i.remove.length){var o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]);return r.vec3.dot(o,t)-r.vec3.dot(a,t)}return 0===e.remove.length?-1:0===i.remove.length?1:1===e.load.length&&1===i.load.length?(o=n.getRenderCenter(e.load[0]),a=n.getRenderCenter(i.load[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t)):1===e.load.length?-1:1===i.load.length?1:(o=n.getRenderCenter(e.remove[0]),a=n.getRenderCenter(i.remove[0]),r.vec3.dot(o,t)-r.vec3.dot(a,t))})},t.splitWorkEntries=function(e,t,r){for(var n=0;n<e.length;++n){var o=e[n];if(o.load.length>t&&1===o.remove.length){var a=i(o,r);e[n]=a[0];for(var s=1;s<a.length;s++)e.push(a[s])}}},t.splitWorkEntry=i}.apply(null,n))||(e.exports=i)},2385:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34),r(1359),r(1427),r(80)],void 0===(i=function(e,t,r,n,i,o){function a(e,t,n,a){for(var s=new i.ObbArray(e.length),u=0;u<e.length;u++){var c=e[u].obb,h=s.obbs[u];if(i.set(c,h),r.vec3.set(l,c.center[0],c.center[1],c.center[2]+a),!t.isGeographic&&n===o.SphericalECEFSpatialReference){o.computeLinearTransformation(t,l,d,n);var p=2*Math.sqrt(1+d[0]+d[5]+d[10]);f[0]=(d[9]-d[6])/p,f[1]=(d[2]-d[8])/p,f[2]=(d[4]-d[1])/p,f[3]=.25*p,r.quat.conjugate(f,f),r.quat.multiply(h.quaternion,f,h.quaternion)}o.bufferToBuffer(l,t,0,h.center,n,0,1)}return s.obbs}function s(e,t){return e/t|0}function u(e,t){return e%t}var l=r.vec3f64.create(),c=function(){function e(e,t,r){this._pages=[],this.pageSize=0,this._nodeSR=null,this._renderSR=null,this._nodeSR=e,this._renderSR=t,this.pageSize=r}return e.prototype.addPage=function(e,t,r){for(void 0===r&&(r=0);this._pages.length<e;)this._pages.push(null);var n=a(t,this._nodeSR,this._renderSR,r);this._pages[e]={nodes:t,renderObbs:n,parents:new Uint32Array(this.pageSize)},function(e,t){for(var r=[0];r.length;)for(var n=r.pop(),i=e[s(n,t)].nodes[u(n,t)],o=0;o<i.childCount;o++){var a=i.firstChild+o;null!=e[s(a,t)]&&(e[s(a,t)].parents[u(a,t)]=n,r.push(a))}}(this._pages,this.pageSize)},e.prototype.hasPage=function(e){return!!this._pages[e]},e.prototype.getNode=function(e){var t=this.pageSize;return this._pages[s(e,t)].nodes[u(e,t)]},e.prototype.getRenderObb=function(e){var t=this.pageSize;return this._pages[s(e,t)].renderObbs[u(e,t)]},e.prototype.getRenderCenter=function(e){return this.getRenderObb(e).center},e.prototype.setRenderObb=function(e,t){var r=this.pageSize;i.set(t,this._pages[s(e,r)].renderObbs[u(e,r)])},e.prototype.getParentId=function(e){var t=this.pageSize;return this._pages[s(e,t)].parents[u(e,t)]},e.prototype.hasNodes=function(e,t){for(var r=s(e,this.pageSize),n=s(e+t-1,this.pageSize),i=r;i<=n;i++)if(null==this._pages[i])return!1;return!0},e.prototype.createVisibilityTraverse=function(){var e={index:this,queue:[],masks:[],tempAabb:n.create()};return function(t,r){return function(e,t,r){var o=e.index;if(o.hasNodes(0,1)){var a=e.queue;a.length=0,a.push(0);var u=e.masks;for(u.length=0,u.push(0);a.length>0;){var l=a.pop(),c=u.pop(),d=o.getNode(l),f=o.getRenderObb(l),h=!0;if(null!=t.clippingBox&&0==(c&(g=1<<t.frustumPlanes.length))){var p=i.toAaBoundingBox(f,e.tempAabb);n.contains(t.clippingBox,p)?c|=g:n.intersects(t.clippingBox,p)||(h=!1)}for(var v=0;v<t.frustumPlanes.length&&h;v++){var g;if(0==(c&(g=1<<v))){var y=i.intersectPlane(f,t.frustumPlanes[v]);y>0?h=!1:y<0&&(c|=g)}}if(r.predicate(l,d,h)){for(var m=d.firstChild,b=d.childCount,_=!1,w=s(m,o.pageSize),x=s(m+b-1,o.pageSize),S=w;S<=x;S++)if(!o.hasPage(S)){r.pageMiss(l,S),_=!0;break}if(!_)for(v=0;v<b;v++)a.push(m+v),u.push(c)}}}}(e,t,r)}},e}(),d=r.mat4f64.create(),f=r.quatf32.create();return c}.apply(null,n))||(e.exports=i)},2386:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(34),r(1359),r(1368),r(1427),r(1613),r(1364),r(2387),r(1360),r(1361)],void 0===(i=function(e,t,r,n,i,o,a,s,u,l,c){function d(e){return e?256:64}function f(e,t,r,n,i){if(r.drawScreenSpace)return r.fixedSize*t*n;var o=d(i)*t*n;return r.drawFixedSize?Math.min(r.fixedSize/2,o):r.screenMinSize>0?Math.min(Math.max(r.screenMinSize*t*n,e/2),o):Math.min(e/2,o)}function h(e,t,r,n,i){return r.drawScreenSpace?0:f(e,t,r,n,i)}function p(e,t,n){return null==n&&(n=r.vec3f64.create()),n[0]=e.origin[0]+e.coordinates[3*t],n[1]=e.origin[1]+e.coordinates[3*t+1],n[2]=e.origin[2]+e.coordinates[3*t+2],n}var v=r.mat4f64.create(),g={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]},y=function(){function e(){this.didRender=!1,this.needsRender=!0,this.layerUid="",this._useFixedSizes=!1,this._scaleFactor=1,this._minSizePx=0,this._useRealWorldSymbolSizes=!1,this._size=0,this._sizePx=0,this._slicePlaneEnabled=!1,this._clipBox=n.create(n.POSITIVE_INFINITY),this._programRep=null,this._needsPrograms=!0,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null,this.tempMatrix4=r.mat4f32.create(),this.tempVec3=r.vec3f32.create(),this.nodes=[]}return e.prototype.initializeRenderContext=function(e){var t=e.rctx;this._programRep=new a(t),this.needsRender=!0,this._needsPrograms=!0},e.prototype.uninitializeRenderContext=function(e){this._programRep.dispose(),this._programRep=null,this._programWorld=null,this._programScreen=null,this._programWorldDepth=null,this._programScreenDepth=null},e.prototype.intersect=function(e,t,a,s,u){var l=r.vec3f64.create(),c=r.vec3f64.create(),d=r.vec3f64.create(),g=r.vec3f64.create(),y=i.plane.create(),m=e.camera.perPixelRatio,b=e.camera.near,_=this._getSizeParams();r.vec3.subtract(c,s,a);var w=1/r.vec3.length(c);r.vec3.scale(c,c,w),r.vec3.negate(d,c),r.vec4.set(y,c[0],c[1],c[2],-r.vec3.dot(c,a));var x={},S={},P=n.create(),I=n.create(this._clipBox);n.offset(I,-a[0],-a[1],-a[2],I);for(var z=0,C=this.nodes;z<C.length;z++){var M=C[z],N=M.splatSize*this._scaleFactor,R=o.minimumDistancePlane(M.obb,y),O=o.maximumDistancePlane(M.obb,y);if(R-=h(N,R+b,_,m,M.isLeaf),!((O-=h(N,O+b,_,m,M.isLeaf))<0)&&!(null!=x.dist&&null!=S.dist&&x.dist<R*w&&S.dist>O*w)){var A=f(N,O+b,_,m,M.isLeaf);if(o.intersectLine(M.obb,a,c,A)){var V=A*A;o.toAaBoundingBox(M.obb,P),n.offset(P,-a[0],-a[1],-a[2],P);var U=!n.contains(I,P);r.vec3.subtract(g,M.origin,a);for(var F=M.coordinates.length/3,k=0;k<F;k++)if(l[0]=g[0]+M.coordinates[3*k],l[1]=g[1]+M.coordinates[3*k+1],l[2]=g[2]+M.coordinates[3*k+2],!U||n.containsPoint(I,l)){var T=r.vec3.dot(l,c),j=r.vec3.squaredLength(l)-T*T;if(!(j>V)){var B=T+b,E=h(N,B,_,m,M.isLeaf);if(!(T-E<0)){var L=f(N,B-=E,_,m,M.isLeaf);if(!(j>L*L)){var q=this.layerUid+"/"+M.id+"/"+k,D=(T-E)*w;if(null==x.dist||D<x.dist){var W=x;(null==t||t(a,s,D))&&(W.point=p(M,k,W.point),W.dist=D,W.normal=d,W.pointId=q,W.layerUid=this.layerUid)}if(null==S.dist||D>S.dist){W=S;(null==t||t(a,s,D))&&(W.point=p(M,k,W.point),W.dist=D,W.normal=d,W.pointId=q,W.layerUid=this.layerUid)}}}}}}}}if(null!=x.dist){var Q=e.minResult;if(null==Q.dist||x.dist<Q.dist){var G={type:"external",point:x.point,metadata:{pointId:x.pointId,layerUid:x.layerUid}};Q.set(G,x.pointId,x.dist,x.normal,v,void 0),Q.setIntersector("PointRenderer")}}if(null!=S.dist){var Y=e.maxResult;if(null==Y.dist||S.dist>Y.dist){G={type:"external",point:S.point,metadata:{pointId:S.pointId,layerUid:S.layerUid}};Y.set(G,S.pointId,S.dist,S.normal,v,void 0),Y.setIntersector("PointRenderer")}}},e.prototype.render=function(e){if(0!==e.pass&&1!==e.pass)return!1;for(var t=1===e.pass,i=e.rctx,o=0,a=this.nodes;o<a.length;o++){null==(g=a[o]).vao&&this._initNode(e,g)}this._selectPrograms();var u=this._getSizeParams(),l=t?u.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:u.drawScreenSpace?this._programScreen:this._programWorld;if(null==l||0===this.nodes.length)return!0;var c=this._clipBox,f=!n.equals(c,n.POSITIVE_INFINITY,function(e,t){return e===t});f||(r.vec3.set(this.tempVec3,-1/0,-1/0,-1/0),l.setUniform3fv("uClipMin",this.tempVec3),r.vec3.set(this.tempVec3,1/0,1/0,1/0),l.setUniform3fv("uClipMax",this.tempVec3)),i.setDepthTestEnabled(!0),i.bindProgram(l),l.setUniformMatrix4fv("uProjectionMatrix",e.camera.projectionMatrix),t&&l.setUniform2f("nearFar",e.camera.near,e.camera.far),u.drawFixedSize&&l.setUniform2f("uPointScale",u.fixedSize,e.camera.fullHeight);for(var h=this._slicePlaneEnabled?e.sliceHelper&&e.sliceHelper.plane:null,p=0,v=this.nodes;p<v.length;p++){var g=v[p];if(l.setUniform2f("uScreenMinMaxSize",u.screenMinSize,d(g.isLeaf)),!u.drawFixedSize){var y=g.splatSize*this._scaleFactor;l.setUniform2f("uPointScale",y,e.camera.fullHeight)}var m=g.origin;f&&(r.vec3.set(this.tempVec3,c[0]-m[0],c[1]-m[1],c[2]-m[2]),l.setUniform3fv("uClipMin",this.tempVec3),r.vec3.set(this.tempVec3,c[3]-m[0],c[4]-m[1],c[5]-m[2]),l.setUniform3fv("uClipMax",this.tempVec3)),r.mat4.identity(this.tempMatrix4),r.mat4.translate(this.tempMatrix4,this.tempMatrix4,m),r.mat4.multiply(this.tempMatrix4,e.camera.viewMatrix,this.tempMatrix4),l.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4),h&&s.bindSlicePlane(m,h,l),i.bindVAO(g.vao),i.drawArrays(0,0,g.coordinates.length/3)}return!0},Object.defineProperty(e.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(e){this._useFixedSizes!==e&&(this._useFixedSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(e){this._scaleFactor!==e&&(this._scaleFactor=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minSizePx",{get:function(){return this._minSizePx},set:function(e){this._minSizePx!==e&&(this._minSizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(e){this._useRealWorldSymbolSizes!==e&&(this._useRealWorldSymbolSizes=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this._size},set:function(e){this._size!==e&&(this._size=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sizePx",{get:function(){return this._sizePx},set:function(e){this._sizePx!==e&&(this._sizePx=e,this._requestRender())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clippingBox",{set:function(e){n.set(this._clipBox,e||n.POSITIVE_INFINITY)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"slicePlaneEnabled",{get:function(){return this._slicePlaneEnabled},set:function(e){this._slicePlaneEnabled!==e&&(this._slicePlaneEnabled=e,this._requestRender(),this._needsPrograms=!0)},enumerable:!0,configurable:!0}),e.prototype.addNode=function(e){this.nodes.push(e),this._requestRender()},e.prototype.removeNode=function(e){var t=null;return this.nodes=this.nodes.filter(function(r){return r.id!==e||(t=r,r.vao&&(r.vao.dispose(!0),r.vao=null),!1)}),this._requestRender(),t},e.prototype.removeAll=function(){this.nodes.forEach(function(e){e.vao&&(e.vao.dispose(!0),e.vao=null)}),this.nodes=[],this._requestRender()},e.prototype._initNode=function(e,t){var r=e.rctx;t.vao=new c(r,u.program.attributes,g,{positions:l.createVertex(r,35044,t.coordinates),colors:l.createVertex(r,35044,t.rgb)})},e.prototype._requestRender=function(){this.didRender=!1,this.needsRender=!0},e.prototype._getSizeParams=function(){var e=this._useFixedSizes,t=e&&!this._useRealWorldSymbolSizes,r=t?this._sizePx:this._size,n=this._minSizePx;return e&&(n=0),{drawScreenSpace:t,drawFixedSize:e,fixedSize:r,screenMinSize:n}},e.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=!1,this._programWorld=this._programRep.getProgram(u.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(u.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(u.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(u.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}))},e}();return function(e){(y||(y={})).isInstanceOfNode=function(e){return e.hasOwnProperty("splatSize")}}(),y}.apply(null,n))||(e.exports=i)},2387:function(e,t,r){var n,i;n=[r.dj.c(e.i),t,r(1362),r(1367)],void 0===(i=function(e,t,r,n){Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){return n.glslifyDefineMap({DEPTH_PASS:e.depthPass,DRAW_SCREEN_SIZE:e.drawScreenSize,SLICE:e.slicePlaneEnabled})};t.program={name:"point-renderer",shaders:function(e){return{vertexShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:i(e)+r.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}}.apply(null,n))||(e.exports=i)}}]);