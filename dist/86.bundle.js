(function(){(this||window).webpackJsonp.registerAbsMids({"esri/core/HandleOwner":1393,"esri/views/layers/RefreshableLayerView":1412,"esri/views/layers/LayerView":1413,"esri/views/3d/layers/support/layerViewUpdatingProperties":1428,"esri/views/3d/layers/LayerView3D":1437,"esri/layers/support/TilemapCache":1524,"esri/core/LRUCache":1541,"esri/layers/support/Tilemap":1542,"esri/views/3d/terrain/terrainUtils":1607,"esri/layers/mixins/ArcGISCachedService":1616,"esri/views/3d/layers/TiledLayerView3D":1643,"esri/views/3d/terrain/terrainUtilsPlanar":1644,"esri/views/3d/terrain/terrainUtilsSpherical":1645,"esri/views/3d/layers/WMTSLayerView3D":2397})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[86,21,28,69],{1393:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(5),i(14),i(0)],void 0===(n=function(e,t,i,r,n,a,l){return function(e){function t(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=e.call(this)||this;return r.handles=new a,r}return i(t,e),t.prototype.destroy=function(){this.handles.destroy()},r([l.property({readOnly:!0})],t.prototype,"handles",void 0),r([l.subclass("esri.core.HandleOwner")],t)}(l.declared(n))}.apply(null,r))||(e.exports=n)},1412:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(5),i(0)],void 0===(n=function(e,t,i,r,n,a){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.refreshTimestamp=null,t}return i(t,e),t.prototype.refresh=function(e){void 0===e&&(e=Date.now()),this._set("refreshTimestamp",e),this.doRefresh&&this.doRefresh()},r([a.property()],t.prototype,"layer",void 0),r([a.aliasOf("layer.refreshInterval")],t.prototype,"refreshInterval",void 0),r([a.property({readOnly:!0})],t.prototype,"refreshTimestamp",void 0),r([a.subclass("esri.layers.mixins.RefreshableLayerView")],t)}(a.declared(n))}.apply(null,r))||(e.exports=n)},1413:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(27),i(1393),i(121),i(7),i(159),i(8),i(0)],void 0===(n=function(e,t,i,r,n,a,l,o,s,p,c){return function(e){function t(t){var i=e.call(this)||this;return i.layer=null,i.parent=null,i.view=null,i}return i(t,e),t.prototype.initialize=function(){var e=this;this.addResolvingPromise(this.layer),this.when().catch(function(t){if("layerview:create-error"!==t.name){var i=e.layer&&e.layer.id||"no id",r=e.layer&&e.layer.title||"no title";return o.getLogger(e.declaredClass).error("#resolve()","Failed to resolve layer view (layer title: '"+r+"', id: '"+i+"')",t),p.reject(t)}})},t.prototype.destroy=function(){this.layer=this.view=this.parent=null},Object.defineProperty(t.prototype,"suspended",{get:function(){return!this.canResume()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"updating",{get:function(){return!this.suspended&&this.isUpdating()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"visible",{get:function(){return!0===this.get("layer.visible")},set:function(e){void 0!==e?this._override("visible",e):this._clearOverride("visible")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fullOpacity",{get:function(){var e=function(e){return null!=e?e:1};return e(this.get("layer.opacity"))*e(this.get("parent.fullOpacity"))},enumerable:!0,configurable:!0}),t.prototype.canResume=function(){return!this.get("parent.suspended")&&this.get("view.ready")&&this.get("layer.loaded")&&this.visible||!1},t.prototype.isUpdating=function(){return!1},r([c.property()],t.prototype,"layer",void 0),r([c.property()],t.prototype,"parent",void 0),r([c.property({readOnly:!0,dependsOn:["view","visible","layer.loaded","parent.suspended"]})],t.prototype,"suspended",null),r([c.property({type:Boolean,dependsOn:["suspended"],readOnly:!0})],t.prototype,"updating",null),r([c.property()],t.prototype,"view",void 0),r([c.property({dependsOn:["layer.visible"]})],t.prototype,"visible",null),r([c.property({dependsOn:["layer.opacity","parent.fullOpacity"]})],t.prototype,"fullOpacity",null),r([c.subclass("esri.views.layers.LayerView")],t)}(c.declared(a,n,l.Identifiable,s))}.apply(null,r))||(e.exports=n)},1428:function(e,t,i){var r,n;r=[i.dj.c(e.i),t],void 0===(n=function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.updatingPercentageValue={value:100,readOnly:!0},t.updatingPercentage={dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}}.apply(null,r))||(e.exports=n)},1437:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(8),i(15),i(0),i(501),i(1413)],void 0===(n=function(e,t,i,r,n,a,l,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.slicePlaneEnabled=!1,t.supportsHeightUnitConversion=!1,t}return i(t,e),t.prototype.postscript=function(e){this.inherited(arguments),o.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())},t.prototype._validateHeightModelInfo=function(){var e=this;return n.create(function(t,i){a.whenFalseOnce(e.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var r=o.rejectLayerError(e.layer,e.view.heightModelInfo,e.supportsHeightUnitConversion);r?i(r):t()})})},r([l.property()],t.prototype,"view",void 0),r([l.property()],t.prototype,"slicePlaneEnabled",void 0),r([l.subclass("esri.views.3d.layers.LayerView3D")],t)}(l.declared(s))}.apply(null,r))||(e.exports=n)},1524:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(10),i(2),i(1),i(98),i(36),i(5),i(9),i(14),i(7),i(1541),i(475),i(8),i(15),i(0),i(1542)],void 0===(n=function(e,t,i,r,n,a,l,o,s,p,c,u,h,f,d,y,v){var m=c.getLogger("esri.layers.support.TilemapCache");return function(e){function t(t){var i=e.call(this)||this;return i._handles=new p,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=l,i}var o;return r(t,e),o=t,t.prototype.initialize=function(){var e=this;this._tilemapCache=new u(this.cacheByteSize),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers?"],function(){return e._initializeTilemapDefinition()}),d.init(this,"layer.tileInfo.lods",function(t){return e._initializeAvailableLevels(t)},!0)]),this._initializeTilemapDefinition()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.castLevels=function(e){return e<=2?(m.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),t.prototype.getTilemap=function(e,t,i){return this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition)},t.prototype.fetchTilemap=function(e,t,i,r){var n=this;if(!this._availableLevels[e])return f.reject(new s("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var a=this._tmpTilemapDefinition,l=this._tilemapFromCache(e,t,i,a);if(l)return f.resolve(l);var o=v.tilemapDefinitionId(a),p=this._pendingTilemapRequests[o];return p||(p=v.Tilemap.fromDefinition(a,r).then(function(e){return n._tilemapCache.put(o,e,e.byteSize),delete n._pendingTilemapRequests[o],e}).catch(function(e){return delete n._pendingTilemapRequests[o],f.reject(e)}),this._pendingTilemapRequests[o]=p),f.create(function(e,t){p.then(e,t)})},t.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var r=this.getTilemap(e,t,i);return r?r.getAvailability(t,i):"unknown"},t.prototype.getAvailabilityUpsample=function(e,t,i,r){r.level=e,r.row=t,r.col=i;var n=this.layer.tileInfo;for(n.updateTileInfo(r);;){var a=this.getAvailability(r.level,r.row,r.col);if("unavailable"!==a)return a;if(!n.upsampleTile(r))return"unavailable"}},t.prototype.fetchAvailability=function(e,t,i,r){return this._availableLevels[e]?this.fetchTilemap(e,t,i,r).catch(function(e){return e}).then(function(r){if(r instanceof v.Tilemap){var n=r.getAvailability(t,i);return"unavailable"===n?f.reject(new s("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):n}return r&&"cancel"===r.dojoType?f.reject(r):"unknown"}):f.reject(new s("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},t.prototype.fetchAvailabilityUpsample=function(e,t,i,r,n){var a=this;r.level=e,r.row=t,r.col=i;var l=this.layer.tileInfo;l.updateTileInfo(r);for(var s=this.fetchAvailability(e,t,i,n).catch(function(e){return e&&"cancel"===e.dojoType?f.reject(e):l.upsampleTile(r)?a.fetchAvailabilityUpsample(r.level,r.row,r.col,r):f.reject(e)}),p={id:r.id,level:e,row:t,col:i},c=this,u=0;o._prefetches.length<o._maxPrefetch&&l.upsampleTile(p);++u)!function(e){var t=c.fetchAvailability(p.level,p.row,p.col,n);o._prefetches.push(t),s.then(function(){return t.cancel()},function(){return t.cancel()}),t.then(function(){return o._prefetches.removeUnordered(t)},function(){return o._prefetches.removeUnordered(t)})}();return s},t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;t&&t.token||!this.layer.token||(t=i({},t,{token:this.layer.token})),this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?a.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},t.prototype._tilemapFromCache=function(e,t,i,r){var n=this._getTilemapDefinition(e,t,i,r),a=v.tilemapDefinitionId(n);return this._tilemapCache.get(a)},t.prototype._getTilemapDefinition=function(e,t,i,r){return r.level=e,r.row=t-t%this.size,r.col=i-i%this.size,r},t.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach(function(e){return t._availableLevels[e.level]=!0})},t._maxPrefetch=4,t._prefetches=new h({initialSize:o._maxPrefetch}),n([y.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0),n([y.cast("levels")],t.prototype,"castLevels",null),n([y.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null),n([y.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0),n([y.property({constructOnly:!0})],t.prototype,"layer",void 0),n([y.property({constructOnly:!0})],t.prototype,"request",void 0),o=n([y.subclass("esri.layers.support.TilemapCache")],t)}(y.declared(o))}.apply(null,r))||(e.exports=n)},1541:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(480)],void 0===(n=function(e,t,i){return function(){function e(e,t){this._storage=new i.Storage,this._storage.maxSize=e,t&&this._storage.registerRemoveFunc("",t)}return e.prototype.put=function(e,t,i){this._storage.put(e,t,i)},e.prototype.pop=function(e){return this._storage.pop(e)},e.prototype.get=function(e){return this._storage.get(e)},e.prototype.clear=function(){this._storage.clearAll()},e.prototype.destroy=function(){this._storage.clearAll()},e}()}.apply(null,r))||(e.exports=n)},1542:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(10),i(36),i(9),i(4),i(8)],void 0===(n=function(e,t,i,r,n,a,l){function o(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var r=e.service.query;return r&&(t=t+"?"+r),t}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.location={left:0,top:0,width:0,height:0},this.byteSize=40}return e.prototype.getAvailability=function(e,t){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";var i=(e-this.location.top)*this.location.width+(t-this.location.left),r=i%8,n=i>>3,a=this._tileAvailabilityBitSet;return n<0||n>a.length?"unknown":a[n]&1<<r?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,i=this.location.height,r=!0,n=!0,a=Math.ceil(t*i/8),l=new Uint8Array(a),o=0,s=0;s<e.length;s++){var p=s%8;e[s]?(n=!1,l[o]|=1<<p):r=!1,7===p&&++o}this._isAllUnvailable=n,this._isAllAvailable=r,this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=l,this.byteSize+=l.length)},e.fromDefinition=function(t,a){var s=t.service.request||r,p=t.row,c=t.col,u=t.width,h=t.height,f={query:{f:"json"}};return a=a?i({},f,a):f,s(o(t),a).then(function(e){return e.data}).catch(function(e){return e&&e.details&&422===e.details.httpStatus?{location:{top:p,left:c,width:u,height:h},valid:!0,data:function(){for(var e=[],t=0,i=u*h;t<i;t++)e[t]=0;return e}()}:l.reject(e)}).then(function(t){if(t.location&&(t.location.top!==p||t.location.left!==c||t.location.width!==u||t.location.height!==h))throw new n("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:p,left:c,width:u,height:h}});return e.fromJSON(t)})},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(a.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new n("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new n("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new n("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new n("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new n("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=s,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=o,t.default=s}.apply(null,r))||(e.exports=n)},1607:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(1310),i(478),i(1311),i(1651),i(1644),i(1645)],void 0===(n=function(e,t,i,r,n,a,l,o){function s(e){return e&&"esri.views.3d.layers.TileLayerView3D"===e.declaredClass}function p(e){return e&&"esri.views.3d.layers.VectorTileLayerView3D"===e.declaredClass}function c(e){return e&&"esri.views.3d.layers.WMTSLayerView3D"===e.declaredClass}function u(e){return e&&"esri.views.3d.layers.ElevationLayerView3D"===e.declaredClass}function h(){for(var e in y={},a)a[e].baseMapLayers.forEach(function(e){y[e.url]=19});y["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=20}function f(e,t,i,r){return d["local"===r||"planar"===r?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(e,t,i)}Object.defineProperty(t,"__esModule",{value:!0});var d={planar:l,spherical:o};t.weakAssert=function(e,t){e||console.warn("Terrain: "+t)},t.autoUpdateSkirtsVisibility=function(e,t,i){var r,n=d[e.manifold],a=n.isInsideExtent(e,t);if(a)r=e.getElevation(t);else{var l=e.getElevationBounds();r=.5*(l[0]+l[1])}var o=t[2]-r,s=.9*Math.abs(o)<i?0:o<0?-1:1;if(!a)if(n.isInsideExtent(e,t,e.hideSkirtsDistanceFromExtentMargin)){var p=n.tiltToExtentEdge(e,t);p>e.hideSkirtsMinimumCameraTilt&&p<e.hideSkirtsMaximumCameraTilt&&(s=0)}else s=0;e.skirtScale=s},t.isTiledLayer=function(e){return e&&"base-tile"===e.type||"tile"===e.type||"elevation"===e.type||"base-elevation"===e.type||"open-street-map"===e.type||"web-tile"===e.type||"wmts"===e.type||"vector-tile"===e.type},t.isVectorTileLayer=function(e){return e&&e.isInstanceOf(n)},t.isTileLayerView=s,t.isVectorTileLayerView=p,t.isWMTSLayerView=c,t.isElevationLayerView=u,t.isTiledLayerView=function(e){return e&&(s(e)||u(e)||p(e)||c(e))},t.useFetchTileForLayer=function(e){return e.fetchTile&&!(e.fetchTile===r.prototype.fetchTile||e.fetchTile===i.prototype.fetchTile)};var y=null;t.getKnownTiledServiceLevelCap=function(e){y||h();var t=e&&e.replace(/https?:/,"");return t in y?y[t]:1/0},t.prepareKnownTiledServiceLevelCaps=h,t.checkIfTileInfoSupportedForView=f,t.getTiledLayerInfo=function(e,t,i){var r,n;if("wmts"===e.type){var a=e.activeLayer;if(a){var l=a.tileMatrixSet;if(l)r=l.tileInfo,n=l.fullExtent;else{var o=a.tileMatrixSets;if(o){var s=o.find(function(e){return null==f(e.tileInfo,e.fullExtent,t,i)});if(s)return{tileInfo:s.tileInfo,fullExtent:s.fullExtent}}}}}else r="vector-tile"===e.type?e.compatibleTileInfo256:e.tileInfo,n=e.fullExtent;return r&&n&&null==f(r,n,t,i)?{tileInfo:r,fullExtent:n}:{tileInfo:null,fullExtent:null}}}.apply(null,r))||(e.exports=n)},1616:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(10),i(2),i(1),i(32),i(0),i(244),i(237),i(1524)],void 0===(n=function(e,t,i,r,n,a,l,o,s,p){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return r(t,e),Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTileInfo=function(e,t){var i=function(e){return Math.round(1e4*e)/1e4},r=t.minScale?i(t.minScale):1/0,n=t.maxScale?i(t.maxScale):-1/0;return e?(e.lods=e.lods.filter(function(e){var t=i(e.scale);return t<=r&&t>=n}),s.fromJSON(e)):null},t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new p({layer:this}):null},n([l.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),n([l.property({json:{origins:{service:{read:!1}}}})],t.prototype,"minScale",void 0),n([l.property({json:{origins:{service:{read:!1}}}})],t.prototype,"maxScale",void 0),n([l.property({type:a.SpatialReference})],t.prototype,"spatialReference",void 0),n([l.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),n([l.property({type:s})],t.prototype,"tileInfo",void 0),n([l.reader("service","tileInfo",["tileInfo","minScale","maxScale"])],t.prototype,"readTileInfo",null),n([l.property()],t.prototype,"tilemapCache",void 0),n([l.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),n([l.property()],t.prototype,"version",void 0),n([l.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(l.declared(o))}.apply(null,r))||(e.exports=n)},1643:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(9),i(0),i(1437),i(1428),i(1607)],void 0===(n=function(e,t,i,r,n,a,l,o,s){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.minDataLevel=0,t.maxDataLevel=1/0,t._isUpdating=!1,t}return i(t,e),Object.defineProperty(t.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isOpaque",{get:function(){return this.fullOpacity>=1&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0}),t.prototype.getTileUrl=function(e,t,i){return this.layer.getTileUrl(e,t,i)},t.prototype.updatingChanged=function(e){this._isUpdating=e,this.notifyChange("updating")},t.prototype.isUpdating=function(){return this._isUpdating},t.prototype._getTileInfoSupportError=function(e,t){var i=s.checkIfTileInfoSupportedForView(e,t,this.view.spatialReference,this.view.basemapTerrain.manifold);if(i){var r={layer:this.layer,error:i},a=void 0;switch(i.name){case"tilingscheme:local-gcs-not-supported":a=new n("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",r);break;case"tilingscheme:spatial-reference-mismatch":case"tilingscheme:global-unsupported-spatial-reference":a=new n("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",r);break;default:a=new n("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",r)}return a}return null},t.prototype._getTileInfoCompatibilityError=function(e,t){return t.compatibleWith(e)?null:new n("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")},t.prototype._updateMinMaxDataLevel=function(){var e,t=1/0,i=0;this.tileInfo.lods.forEach(function(e){t=Math.min(e.level,t),i=Math.max(e.level,i)}),e=[t,i],this.minDataLevel=e[0],this.maxDataLevel=e[1]},r([a.property({readOnly:!0})],t.prototype,"imageFormatIsOpaque",null),r([a.property(o.updatingPercentage)],t.prototype,"updatingPercentage",void 0),r([a.property(o.updatingPercentageValue)],t.prototype,"updatingPercentageValue",void 0),r([a.property()],t.prototype,"fullExtent",void 0),r([a.property({readOnly:!0,dependsOn:["fullOpacity","imageFormatIsOpaque"]})],t.prototype,"isOpaque",null),r([a.property()],t.prototype,"layer",void 0),r([a.property()],t.prototype,"minDataLevel",void 0),r([a.property()],t.prototype,"maxDataLevel",void 0),r([a.property()],t.prototype,"tileInfo",void 0),r([a.subclass("esri.views.3d.layers.TiledLayerView3D")],t)}(a.declared(l))}.apply(null,r))||(e.exports=n)},1644:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(9),i(34),i(81),i(507),i(484)],void 0===(n=function(e,t,i,r,n,a,l){function o(e,t,i,n){r.vec3.copy(p,i),p[n]=t[n];var a,l=r.vec3.subtract(p,p,t),o=r.vec3.subtract(c,e,t),s=r.vec3.dot(o,l),u=r.vec3.dot(l,l);a=s<=0?t:u<=s?i:r.vec3.add(p,t,r.vec3.scale(l,l,s/u));var h=r.vec3.subtract(p,e,a);return Math.PI/2-Math.atan(h[2]/Math.sqrt(h[0]*h[0]+h[1]*h[1]))}function s(e,t){var r=e.lods,o=r[0].resolution*Math.pow(2,r[0].level),s=[o*e.size[0],o*e.size[1]],p=[e.origin.x,e.origin.y],c=n.fromExtent(t),u=n.create();l.computeRowColExtent(c,s,p,u);var h=(u[2]-u[0])*(u[3]-u[1]);if(h>a.MAX_ROOT_TILES){var f=r[0].scale*Math.pow(2,r[0].level),d=Math.max((c[3]-c[1])/e.size[1],(c[2]-c[0])/e.size[0])*f/o,y=Math.floor(Math.log(d)/Math.log(10));return d=Math.ceil(d/Math.pow(10,y))*Math.pow(10,y),new i("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+d.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:d,requiredNumRootTiles:h,allowedNumRootTiles:a.MAX_ROOT_TILES})}return null}Object.defineProperty(t,"__esModule",{value:!0});var p=r.vec3f64.create(),c=r.vec3f64.create(),u=r.vec3f64.create(),h=r.vec3f64.create();t.isInsideExtent=function(e,t,i){void 0===i&&(i=0);var r=e.extent;if(0===i)return n.containsPoint(r,t);var a=Math.min(r[2]-r[0],r[3]-r[1]);return n.containsPointWithMargin(r,t,i*a)},t.tiltOnEdge=o,t.tiltToExtentEdge=function(e,t){var i=e.getElevationBounds(),r=e.extent,n=.5*(i[0]+i[1]);u[0]=r[0],u[1]=r[1],u[2]=n,h[0]=r[2],h[1]=r[3],h[2]=n;var a=1/0,l=1/0;return t[0]<u[0]?a=o(t,u,h,0):t[0]>h[0]&&(a=o(t,h,u,0)),t[1]<u[1]?l=o(t,u,h,1):t[1]>h[1]&&(l=o(t,h,u,1)),Math.min(a,l)},t.checkIfTileInfoSupportedForViewSR=function(e,t,r){if(e.spatialReference.isGeographic)return new i("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var n=l.checkUnsupported(e);return n||s(e,t)||(r&&!e.spatialReference.equals(r)?new i("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null)}}.apply(null,r))||(e.exports=n)},1645:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(9),i(484)],void 0===(n=function(e,t,i,r){Object.defineProperty(t,"__esModule",{value:!0}),t.isInsideExtent=function(e,t,i){return void 0===i&&(i=0),!0},t.tiltToExtentEdge=function(e,t){return 0},t.checkIfTileInfoSupportedForViewSR=function(e,t,n){var a=e.lods.length-1;if(e.spatialReference.isWebMercator){if(!r.makeWebMercatorAuxiliarySphere(a).compatibleWith(e))return new i("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else{if(!e.spatialReference.isWGS84)return new i("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(!r.makeWGS84WithTileSize(e.size[1],a).compatibleWith(e))return new i("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}if(n&&!e.spatialReference.equals(n))return new i("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}}.apply(null,r))||(e.exports=n)},2397:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(2),i(1),i(9),i(14),i(7),i(8),i(15),i(0),i(1643),i(1412)],void 0===(n=function(e,t,i,r,n,a,l,o,s,p,c,u){var h=l.getLogger("esri.views.3d.layers.WMTSLayerView3d");return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._handles=new a,t}return i(t,e),t.prototype.initialize=function(){var e=this,t=s.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeDone").then(function(){var t=function(){return new n("layerview:no-compatible-tiling-scheme","None of the tiling schemes supported by the service are compatible with the scene.")};if(!e.view.basemapTerrain.tilingSchemeLocked)return o.reject(t());var i,r=e.view.basemapTerrain.tilingScheme,a=e.layer.activeLayer;if(a&&a.tileMatrixSet){var l=(i=a.tileMatrixSet).tileInfo,s=e._getTileInfoSupportError(l,i.fullExtent)||e._getTileInfoCompatibilityError(l,r);if(s)return o.reject(s)}else{if(!(i=e._getCompatibleTileMatrixSet()))return o.reject(t());a.tileMatrixSetId=i.id}e.tileInfo=i.tileInfo,e.fullExtent=i.fullExtent,e._updateMinMaxDataLevel()});this.addResolvingPromise(t),this.when(function(){return e._initialized()})},t.prototype.destroy=function(){this._handles.removeAll()},t.prototype.refresh=function(){this.emit("data-changed")},t.prototype.canResume=function(){if(!this.inherited(arguments))return!1;var e=this.layer.activeLayer.tileMatrixSet;return e&&!this._getTileInfoError(e.tileInfo,e.fullExtent)},t.prototype.doRefresh=function(){this.suspended||this.emit("data-changed")},t.prototype._initialized=function(){var e=this;this._handles.add(this.watch("layer.activeLayer.styleId, tileMatrixSet",function(){return e.refresh()})),this._handles.add(this.layer.watch("activeLayer",function(t){var i=t.tileMatrixSet;if(i){var r=e._getTileInfoError(i.tileInfo,i.fullExtent);r&&(h.error("The selected tile matrix set is not compatible with the view",r),i=null)}else(i=e._getCompatibleTileMatrixSet())?t.tileMatrixSetId=i.id:h.error("The layer does not provide a tiling scheme that is compatible with the view");e.notifyChange("suspended"),e.canResume()&&e.refresh()}))},t.prototype._getCompatibleTileMatrixSet=function(){var e=this;return this.layer.activeLayer.tileMatrixSets.find(function(t){var i=t.tileInfo;return!e._getTileInfoError(i,t.fullExtent)})},t.prototype._getTileInfoError=function(e,t){return this._getTileInfoSupportError(e,t)||this._getTileInfoCompatibilityError(e,this.view.basemapTerrain.tilingScheme)},r([p.property({aliasOf:"layer.fullExtent"})],t.prototype,"fullExtent",void 0),r([p.property()],t.prototype,"layer",void 0),r([p.property({dependsOn:["layer.activeLayer"]})],t.prototype,"suspended",void 0),r([p.property({aliasOf:"layer.tileInfo"})],t.prototype,"tileInfo",void 0),r([p.subclass("esri.views.3d.layers.WMTSLayerView3D")],t)}(p.declared(c,u))}.apply(null,r))||(e.exports=n)}}]);