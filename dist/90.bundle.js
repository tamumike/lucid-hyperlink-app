(function(){(this||window).webpackJsonp.registerAbsMids({"dojo/request":1710})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[90],{1331:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(10),r(36),r(1874),r(1786),r(1940),r(1877),r(1873),r(1648),r(8),r(99),r(108),r(1878),r(1880),r(1881),r(1883)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f,h,p){function d(e,t){if(u.applicationCache){var r=u.applicationCache.getLayerInfo(e);if(r)return r.then(function(r){return f.resolve(new s({url:e,outFields:t,resourceInfo:r}))});var n=new s({url:e,outFields:t}),a=f.create(function(t,r){u.applicationCache&&u.applicationCache.setLayerInfo(e,a),n.load().then(function(){t(n.resourceInfo)},function(t){u.applicationCache&&u.applicationCache.clearLayerInfo(e),r(t)})});return a.then(function(e){return f.resolve(n)})}return f.resolve(new s({url:e,outFields:t}))}function v(e,t,r,n,a){return void 0===t&&(t=null),void 0===r&&(r=null),void 0===n&&(n=!0),void 0===a&&(a=null),!0===e._hasMemorySource()?new l({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a}):new o({layer:e,spatialReference:t,outFields:r,includeGeometry:n,lrucache:a})}Object.defineProperty(t,"__esModule",{value:!0}),t.initialiseMetaDataCache=function(){null===u.applicationCache&&(u.applicationCache=new u)},t.constructFeatureSetFromUrl=function(e,t,r,n,a){return d(e,["*"]).then(function(e){return f.resolve(v(e,t,r,n,a))})},t.constructFeatureSet=v,c._polyfill.table=s;var m=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._map=t,a._overridespref=r,a.lrucache=n,a._instantLayers=[],a}return r(t,e),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype.featureSetByName=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=null),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return a.featureSetByName(e,t,r)}catch(e){return f.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var l=this._instantLayers[o];if(l.opitem.title===e&&l.includeGeometry===t&&l.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find(function(t){return t instanceof h&&t.title===e});if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var c=this._map.tables.find(function(t){return!!(t.title&&t.title===e||t.title&&t.title===e)});if(c){if(c._materializedTable);else{var p=c.outFields?c:n({},c,{outFields:["*"]});c._materializedTable=new s(p)}return c._materializedTable.load().then(function(){return a.resolvePromise(a.makeAndAddFeatureSet(c._materializedTable,t,r))})}}return this.resolvePromise(null)},t.prototype.featureSetById=function(e,t,r){var a=this;if(void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0!==this._map.loaded&&void 0!==this._map.load&&!1===this._map.loaded)return this._map.load().then(function(){try{return a.featureSetById(e,t,r)}catch(e){return f.reject(e)}});null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var i=JSON.stringify(r),o=0;o<this._instantLayers.length;o++){var l=this._instantLayers[o];if(l.opitem.id===e&&l.includeGeometry===t&&l.outFields===i)return this.resolvePromise(this._instantLayers[o].featureset)}var u=this._map.layers.find(function(t){return t instanceof h&&t.id===e});if(u)return this.resolvePromise(this.makeAndAddFeatureSet(u,t,r));if(this._map.tables){var c=this._map.tables.find(function(t){return t.id===e});if(c){if(c._materializedTable);else{var p=n({},c,{outFields:["*"]});c._materializedTable=new s(p)}return c._materializedTable.load().then(function(){return a.resolvePromise(a.makeAndAddFeatureSet(c._materializedTable,t,r))})}}return this.resolvePromise(null)},t}(i),g=function(e){function t(t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var a=e.call(this)||this;return a._url=t,a._overridespref=r,a.lrucache=n,a.metadata=null,a._instantLayers=[],a}return r(t,e),Object.defineProperty(t.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),t.prototype.makeAndAddFeatureSet=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=v(e,this._overridespref,null===r?["*"]:r,t,this.lrucache);return this._instantLayers.push({featureset:n,opitem:e,includeGeometry:t,outFields:JSON.stringify(r)}),n},t.prototype._loadMetaData=function(){var e=this;if(null!==u.applicationCache){var t=u.applicationCache.getLayerInfo(this._url);if(null!==t)return t.then(function(t){return e.metadata=t,f.resolve(e.metadata)})}var r=a(this._url,{responseType:"json",query:{f:"json"}}).then(function(t){return t.data?(e.metadata={layers:t.data.layers?t.data.layers:[],tables:t.data.tables?t.data.tables:[]},f.resolve(e.metadata)):(e.metadata={layers:[],tables:[]},f.resolve(e.metadata))},function(t){return u.applicationCache&&u.applicationCache.clearLayerInfo(e._url),f.reject(t)});return null!==u.applicationCache&&u.applicationCache.setLayerInfo(this._url,r),r},t.prototype.load=function(){return this._loadMetaData()},t.prototype.clone=function(){return new t(this._url,this._overridespref,this.lrucache)},t.prototype.featureSetByName=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=null),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();for(var a=JSON.stringify(r),i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.title===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then(function(a){for(var i=null,s=0,o=a.layers?a.layers:[];s<o.length;s++){(c=o[s]).name===e&&(i=c)}if(!i)for(var l=0,u=a.tables?a.tables:[];l<u.length;l++){var c;(c=u[l]).name===e&&(i=c)}return i?d(n._url+"/"+i.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t.prototype.featureSetById=function(e,t,r){var n=this;void 0===t&&(t=!0),void 0===r&&(r=["*"]),null===r&&(r=["*"]),r=(r=r.slice(0)).sort();var a=JSON.stringify(r);e=null!==e&&void 0!==e?e.toString():"";for(var i=0;i<this._instantLayers.length;i++){var s=this._instantLayers[i];if(s.opitem.id===e&&s.includeGeometry===t&&s.outFields===a)return this.resolvePromise(this._instantLayers[i].featureset)}return this._loadMetaData().then(function(a){for(var i=null,s=0,o=a.layers?a.layers:[];s<o.length;s++){null!==(c=o[s]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c)}if(!i)for(var l=0,u=a.tables?a.tables:[];l<u.length;l++){var c;null!==(c=u[l]).id&&void 0!==c.id&&c.id.toString()===e&&(i=c)}return i?d(n._url+"/"+i.id,["*"]).then(function(e){return n.makeAndAddFeatureSet(e,t,r)}):n.resolvePromise(null)})},t}(i);t.createFeatureSetCollectionFromMap=function(e,t,r){return void 0===r&&(r=null),new m(e,t,r)},t.createFeatureSetCollectionFromService=function(e,t,r){return void 0===r&&(r=null),new g(e,t,r)},t.constructFeatureSetFromPortalItem=function(e,t,r,n,a,i,o){if(u.applicationCache){var l=u.applicationCache.getLayerInfo(e+":"+i.url);if(l)return l.then(function(e){try{var i=new s({url:e.url+"/"+t,outFields:["*"]});return f.resolve(v(i,r,n,a,o))}catch(e){return f.reject(e)}},function(e){return f.reject(e)})}return f.create(function(l,c){var f=new p({id:e,portal:i}).load();u.applicationCache&&u.applicationCache.setLayerInfo(e+":"+i.url,f),f.then(function(e){try{var i=new s({url:e.url+"/"+t,outFields:["*"]});l(v(i,r,n,a,o))}catch(e){c(e)}},function(t){u.applicationCache&&u.applicationCache.clearLayerInfo(e+":"+i.url),c(t)})})}}.apply(null,n))||(e.exports=a)},1335:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(498),r(109),r(86),r(1874),r(506),r(47),r(1331),r(1883),r(1878),r(1880),r(1877),r(1879),r(1771)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f,h,p,d,v){function m(e,t,r){for(var n in void 0===r&&(r=null),e)if(n.toLowerCase()===t.toLowerCase())return e[n];return r}function g(e){if(null===e)return null;var t={type:m(e,"type",""),name:m(e,"name","")};if("range"===t.type)t.range=m(e,"range",[]);else{t.codedValues=[];for(var r=0,n=m(e,"codedValues",[]);r<n.length;r++){var a=n[r];t.codedValues.push({name:m(a,"name",""),code:m(a,"code",null)})}}return t}function y(e){if(null===e)return null;var t={},r=m(e,"wkt",null);null!==r&&(t.wkt=r);var n=m(e,"wkid",null);return null!==n&&(t.wkid=n),t}function _(e){if(null===e)return null;var t={hasZ:m(e,"hasz",!1),hasM:m(e,"hasm",!1)},r=m(e,"spatialreference",null);r&&(t.spatialReference=y(r));var n=m(e,"x",null);if(null!==n)return t.x=n,t.y=m(e,"y",null),t;var a=m(e,"rings",null);if(null!==a)return t.rings=a,t;var i=m(e,"paths",null);if(null!==i)return t.paths=i,t;var s=m(e,"points",null);if(null!==s)return t.points=s,t;for(var o=0,l=["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"];o<l.length;o++){var u=l[o],c=m(e,u,null);null!==c&&(t[u]=c)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.featuresetbyid=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(l.pcCheck(r,2,4),r[0]instanceof s){var n=l.toString(r[1]),a=l.defaultUndefined(r[2],null),i=l.toBoolean(l.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===l.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetById(n,i,a)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.featuresetbyportalitem=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){l.pcCheck(n,2,4);var a=l.toString(n[0]),i=l.toString(n[1]),s=l.defaultUndefined(n[2],null),o=l.toBoolean(l.defaultUndefined(n[3],!0));if(null===s&&(s=["*"]),!1===l.isArray(s))throw new Error("Invalid Parameter");if(t.services&&t.services.portal)return u.constructFeatureSetFromPortalItem(a,i,t.spatialReference,s,o,t.services.portal,t.lrucache);throw new Error("Portal is required")})},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"4"}),e.functions.featuresetbyname=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(l.pcCheck(r,2,4),r[0]instanceof s){var n=l.toString(r[1]),a=l.defaultUndefined(r[2],null),i=l.toBoolean(l.defaultUndefined(r[3],!0));if(null===a&&(a=["*"]),!1===l.isArray(a))throw new Error("Invalid Parameter");return r[0].featureSetByName(n,i,a)}throw new Error("Invalid Parameter")})},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(t,r){return e.standardFunction(t,r,function(e,r,n){l.pcCheck(n,1,1);var i=n[0],s={layerDefinition:{geometryType:"",objectIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(l.isString(i))void 0!==(i=JSON.parse(i)).layerDefinition?(s.layerDefinition=i.layerDefinition,s.featureSet=i.featureSet,i.layerDefinition.spatialReference&&(s.layerDefinition.spatialReference=i.layerDefinition.spatialReference)):(s.featureSet.features=i.features,s.featureSet.geometryType=i.geometryType,s.layerDefinition.geometryType=s.featureSet.geometryType,s.layerDefinition.objectIdField=i.objectIdFieldName,s.layerDefinition.typeIdField=i.typeIdFieldName,s.layerDefinition.fields=i.fields,i.spatialReference&&(s.layerDefinition.spatialReference=i.spatialReference));else{if(!(n[0]instanceof a))throw new Error("Invalid Parameter");var o=m(i=JSON.parse(n[0].castToText()),"layerdefinition");if(null!==o){s.layerDefinition.geometryType=m(o,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=m(o,"objectidfield",""),s.layerDefinition.typeIdField=m(o,"typeidfield",""),(D=m(o,"spatialreference",null))&&(s.layerDefinition.spatialReference=y(D));for(var u=0,c=m(o,"fields",[]);u<c.length;u++){var f={name:m(R=c[u],"name",""),alias:m(R,"alias",""),type:m(R,"type",""),nullable:m(R,"nullable",!0),editable:m(R,"editable",!0),length:m(R,"length",null),domain:g(m(R,"domain"))};s.layerDefinition.fields.push(f)}var h=m(i,"featureset",null);if(h){for(var d={},v=0,w=s.layerDefinition.fields;v<w.length;v++)d[(T=w[v]).name.toLowerCase()]=T.name;for(var b=0,S=m(h,"features",[]);b<S.length;b++){var k={},F=m(A=S[b],"attributes",{});for(var T in F)k[d[T.toLowerCase()]]=F[T];s.featureSet.features.push({attributes:k,geometry:_(m(A,"geometry",null))})}}}else{var D;s.layerDefinition.geometryType=m(i,"geometrytype",""),s.featureSet.geometryType=s.layerDefinition.geometryType,s.layerDefinition.objectIdField=m(i,"objectidfieldname",""),s.layerDefinition.typeIdField=m(i,"typeidfieldname",""),(D=m(i,"spatialreference",null))&&(s.layerDefinition.spatialReference=y(D));for(var x=0,I=m(i,"fields",[]);x<I.length;x++){var R;f={name:m(R=I[x],"name",""),alias:m(R,"alias",""),type:m(R,"type",""),nullable:m(R,"nullable",!0),editable:m(R,"editable",!0),length:m(R,"length",null),domain:g(m(R,"domain"))},s.layerDefinition.fields.push(f)}d={};for(var C=0,E=s.layerDefinition.fields;C<E.length;C++)d[(T=E[C]).name.toLowerCase()]=T.name;for(var P=0,N=m(i,"features",[]);P<N.length;P++){var A;for(var T in k={},F=m(A=N[P],"attributes",{}))k[d[T.toLowerCase()]]=F[T];s.featureSet.features.push({attributes:k,geometry:_(m(A,"geometry",null))})}}}if(!1===function(e){return!!e.layerDefinition&&!!e.featureSet&&!1!==function(e,t){for(var r=0,n=t;r<n.length;r++)if(n[r]===e)return!0;return!1}(e.layerDefinition.geometryType,["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&null!==e.layerDefinition.objectIdField&&""!==e.layerDefinition.objectIdField&&!1!==l.isArray(e.layerDefinition.fields)&&!1!==l.isArray(e.featureSet.features)&&void 0}(s))throw new Error("Invalid Parameter");return p.create(s,t.spatialReference)})},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(t,a){return e.standardFunctionAsync(t,a,function(a,i,s){if(l.pcCheck(s,2,2),l.isFeatureSet(s[0])){var u=v.create(s[1]),f=u.getVariables(),h=new r;if(f.length>0){for(var p=[],d=0;d<f.length;d++){var m={name:f[d]};p.push(e.evaluateIdentifier(t,m))}n(p).then(o.callback(function(e){for(var t={},r=0;r<f.length;r++)t[f[r]]=e[r];u.setVariablesDictionary(t),h.resolve(new c({parentfeatureset:s[0],whereclause:u}))},h),o.errback(h))}else h.resolve(new c({parentfeatureset:s[0],whereclause:u}));return h.promise}return e.failDefferred("Filter cannot accept this parameter type")})},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(t,n){return e.standardFunctionAsync(t,n,function(t,n,a){if(l.pcCheck(a,2,2),l.isFeatureSet(a[0])){var i=new r,s=new d(a[1]);return i.resolve(new f({parentfeatureset:a[0],orderbyclause:s})),i.promise}return e.failDefferred("Order cannot accept this parameter type")})},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(t,n){return e.standardFunctionAsync(t,n,function(t,n,a){if(l.pcCheck(a,2,2),l.isFeatureSet(a[0])){var i=new r;return i.resolve(new h({parentfeatureset:a[0],topnum:a[1]})),i.promise}return l.isArray(a[0])?l.toNumber(a[1])>=a[0].length?a[0].slice(0):a[0].slice(0,l.toNumber(a[1])):l.isImmutableArray(a[0])?l.toNumber(a[1])>=a[0].length()?a[0].slice(0):a[0].slice(0,l.toNumber(a[1])):e.failDefferred("Top cannot accept this parameter type")})},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(t,n){return e.standardFunctionAsync(t,n,function(e,t,n){var a=new r;if(l.pcCheck(n,1,1),l.isFeatureSet(n[0]))n[0].first().then(o.callback(function(e){if(null!==e){var t=i.createFromGraphicLikeObject(e.geometry,e.attributes,n[0]);t._underlyingGraphic=e,e=t}a.resolve(e)},a),o.errback(a));else if(l.isArray(n[0]))0===n[0].length?a.resolve(null):a.resolve(n[0][0]);else{if(!l.isImmutableArray(n[0]))return null;0===n[0].length()?a.resolve(null):a.resolve(n[0].get(0))}return a.promise})},e.signatures.push({name:"first",min:"1",max:"1"}))}}.apply(null,n))||(e.exports=a)},1336:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(506),r(47),r(1881),r(1882),r(30),r(1693)],void 0===(a=function(e,t,r,n,a,i,s,o,l){function u(e,t,u,c,f){return f(e,t,function(e,t,f){if(f.length<2)return c(new Error("Missing Parameters"));if(null===(f=a.autoCastFeatureToGeometry(f))[0]&&null===f[1]){var h=new r;return h.resolve(!1),h.promise}if(a.isFeatureSet(f[0]))return f[1]instanceof o?((v=new r).resolve(new i({parentfeatureset:f[0],relation:u,relationGeom:f[1]})),v.promise):null===f[1]?((v=new r).resolve(new s({parentfeatureset:f[0]})),v.promise):c("Spatial Relation cannot accept this parameter type");if(f[0]instanceof o){if(f[1]instanceof o){var p=new r,d=null;switch(u){case"esriSpatialRelEnvelopeIntersects":d=l.intersects(n.shapeExtent(f[0]),n.shapeExtent(f[1]));break;case"esriSpatialRelIntersects":d=l.intersects(f[0],f[1]);break;case"esriSpatialRelContains":d=l.contains(f[0],f[1]);break;case"esriSpatialRelOverlaps":d=l.overlaps(f[0],f[1]);break;case"esriSpatialRelWithin":d=l.within(f[0],f[1]);break;case"esriSpatialRelTouches":d=l.touches(f[0],f[1]);break;case"esriSpatialRelCrosses":d=l.crosses(f[0],f[1])}return null!==d?d.then(n.callback(function(e){p.resolve(e)},p),n.errback(p)):p.reject(new Error("Unrecognised Relationship")),p.promise}var v;return a.isFeatureSet(f[1])?((v=new r).resolve(new i({parentfeatureset:f[1],relation:u,relationGeom:f[0]})),v.promise):null===f[1]?((v=new r).resolve(!1),v.promise):c("Spatial Relation cannot accept this parameter type")}return null!==f[0]?c("Spatial Relation cannot accept this parameter type"):a.isFeatureSet(f[1])?((v=new r).resolve(new s({parentfeatureset:f[1]})),v.promise):f[1]instanceof o||null===f[1]?((v=new r).resolve(!1),v.promise):void 0})}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.intersects=function(t,r){return u(t,r,"esriSpatialRelIntersects",e.failDefferred,e.standardFunctionAsync)},e.functions.envelopeintersects=function(t,r){return u(t,r,"esriSpatialRelEnvelopeIntersects",e.failDefferred,e.standardFunctionAsync)},e.signatures.push({name:"envelopeintersects",min:"2",max:"2"}),e.functions.contains=function(t,r){return u(t,r,"esriSpatialRelContains",e.failDefferred,e.standardFunctionAsync)},e.functions.overlaps=function(t,r){return u(t,r,"esriSpatialRelOverlaps",e.failDefferred,e.standardFunctionAsync)},e.functions.within=function(t,r){return u(t,r,"esriSpatialRelWithin",e.failDefferred,e.standardFunctionAsync)},e.functions.touches=function(t,r){return u(t,r,"esriSpatialRelTouches",e.failDefferred,e.standardFunctionAsync)},e.functions.crosses=function(t,r){return u(t,r,"esriSpatialRelCrosses",e.failDefferred,e.standardFunctionAsync)},e.functions.relate=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(r=a.autoCastFeatureToGeometry(r),a.pcCheck(r,3,3),r[0]instanceof o&&r[1]instanceof o)return l.relate(r[0],r[1],a.toString(r[2]));if(r[0]instanceof o&&null===r[1])return!1;if(r[1]instanceof o&&null===r[0])return!1;if(a.isFeatureSet(r[0])&&null===r[1])return new s({parentfeatureset:r[0]});if(a.isFeatureSet(r[1])&&null===r[0])return new s({parentfeatureset:r[1]});if(a.isFeatureSet(r[0])&&r[1]instanceof o)return r[0].relate(r[1],a.toString(r[2]));if(a.isFeatureSet(r[1])&&r[0]instanceof o)return r[1].relate(r[0],a.toString(r[2]));if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")})})}}.apply(null,n))||(e.exports=a)},1337:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(498),r(47),r(1771),r(506),r(529)],void 0===(a=function(e,t,r,n,a,i,s,o){function l(e,t,n,l,c,f){if(1===l.length){if(a.isArray(l[0])){var h=new r;return h.resolve(o.calculateStat(e,l[0],a.defaultUndefined(l[1],-1))),h.promise}if(a.isImmutableArray(l[0])){var p=new r;return p.resolve(o.calculateStat(e,l[0].toArray(),a.defaultUndefined(l[1],-1))),p.promise}}else if(2===l.length){if(a.isArray(l[0])){var d=new r;return d.resolve(o.calculateStat(e,l[0],a.defaultUndefined(l[1],-1))),d.promise}if(a.isImmutableArray(l[0])){var v=new r;return v.resolve(o.calculateStat(e,l[0].toArray(),a.defaultUndefined(l[1],-1))),v.promise}if(a.isFeatureSet(l[0])){var m=new r;return u(i.create(l[1]),f,c).then(s.callback(function(r){l[0]._qStat(e,r,a.defaultUndefined(l[2],1e3),t.progressTracker).then(s.callback(function(e){m.resolve(e)},m),s.errback(m))},m),s.errback(m)),m.promise}}else if(3===l.length&&a.isFeatureSet(l[0])){var g=new r;return u(i.create(l[1]),f,c).then(s.callback(function(r){l[0]._qStat(e,r,a.defaultUndefined(l[2],1e3),t.progressTracker).then(s.callback(function(e){g.resolve(e)},g),s.errback(g))},g),s.errback(g)),g.promise}var y=new r;return y.resolve(o.calculateStat(e,l,-1)),y.promise}function u(e,t,a){var i=new r;try{var o=e.getVariables();if(o.length>0){for(var l=[],u=0;u<o.length;u++){var c={name:o[u]};l.push(t.evaluateIdentifier(a,c))}n(l).then(s.callback(function(t){for(var r={},n=0;n<o.length;n++)r[o[n]]=t[n];e.setVariablesDictionary(r),i.resolve(e)},i),s.errback(i))}else i.resolve(e)}catch(e){i.reject(e)}return i.promise}Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.stdev=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("stdev",r,0,a,t,e)})},e.functions.variance=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("variance",r,0,a,t,e)})},e.functions.average=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("mean",r,0,a,t,e)})},e.functions.mean=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("mean",r,0,a,t,e)})},e.functions.sum=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("sum",r,0,a,t,e)})},e.functions.min=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("min",r,0,a,t,e)})},e.functions.max=function(t,r){return e.standardFunctionAsync(t,r,function(r,n,a){return l("max",r,0,a,t,e)})},e.functions.count=function(t,r){return e.standardFunctionAsync(t,r,function(e,r,n){if(a.pcCheck(n,1,1),a.isFeatureSet(n[0])){var i=n[0].count();return t.progressTracker.then(function(){t.progressTracker.isCanceled()&&!1===i.isFulfilled()&&i.cancel(new Error("Operation has been cancelled."))},function(e){t.progressTracker.isCanceled()&&!1===i.isFulfilled()&&i.cancel(new Error("Operation has been cancelled."))}),i}if(a.isArray(n[0])||a.isString(n[0]))return n[0].length;if(a.isImmutableArray(n[0]))return n[0].length();throw new Error("Invalid Parameters for Count")})})}}.apply(null,n))||(e.exports=a)},1338:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(86),r(506),r(47)],void 0===(a=function(e,t,r,n,a,i){Object.defineProperty(t,"__esModule",{value:!0}),t.registerFunctions=function(e){"async"===e.mode&&(e.functions.domainname=function(t,s){return e.standardFunctionAsync(t,s,function(e,t,s){if(i.pcCheck(s,2,4),s[0]instanceof n)return s[0].domainValueLookup(i.toString(s[1]),s[2],void 0===s[3]?void 0:i.toNumber(s[3]));if(i.isFeatureSet(s[0])){var o=new r;return s[0]._ensureLoaded().then(a.callback(function(){var e=i.getDomain(i.toString(s[1]),s[0],null,void 0===s[3]?void 0:i.toNumber(s[3]));o.resolve(i.getDomainValue(e,s[2]))},o),a.errback(o)),o.promise}throw new Error("Invalid Parameter")})},e.signatures.push({name:"domainname",min:"2",max:"4"}),e.functions.domaincode=function(t,s){return e.standardFunctionAsync(t,s,function(e,t,s){if(i.pcCheck(s,2,4),s[0]instanceof n)return s[0].domainCodeLookup(i.toString(s[1]),s[2],void 0===s[3]?void 0:i.toNumber(s[3]));if(i.isFeatureSet(s[0])){var o=new r;return s[0]._ensureLoaded().then(a.callback(function(){var e=i.getDomain(i.toString(s[1]),s[0],null,void 0===s[3]?void 0:i.toNumber(s[3]));o.resolve(i.getDomainCode(e,s[2]))},o),a.errback(o)),o.promise}throw new Error("Invalid Parameter")})},e.signatures.push({name:"domaincode",min:"2",max:"4"})),e.functions.text=function(t,r){return e.standardFunctionAsync(t,r,function(e,t,r){if(i.pcCheck(r,1,2),!i.isFeatureSet(r[0]))return i.toStringExplicit(r[0],r[1]);var n=i.defaultUndefined(r[2],"");return""===n?r[0].castToText():"schema"===n.toLowerCase()?r[0].convertToText("schema"):"featureset"===n.toLowerCase()?r[0].convertToText("featureset"):void 0})}}}.apply(null,n))||(e.exports=a)},1648:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(111),r(1875),r(1649),r(479),r(1771),r(1942),r(1944),r(1873),r(1945),r(1876),r(1693),r(19)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f,h,p,d){var v=0;return function(){function e(e){this._bigdCacheId=f.raw(),this.recentlyUsedQueries=null,this._idstates=[],this._parent=null,this._wset=null,this._mainSetInUse=null,this._maxProcessing=200,this._maxQuery=500,this._totalCount=-1,this._databaseType=s.FeatureServiceDatabaseType.NotEvaluated,this._databaseTypeProbed=null,this.declaredRootClass="esri.arcade.featureset.support.FeatureSet",this._featureCache=[],this.types=null,this.fields=null,this.geometryType="",this.objectIdField="",this.spatialReference=null,this.hasM=!1,this.hasZ=!1,this._transparent=!1,this.loaded=!1,this._loadPromise=null,e&&e.lrucache&&(this.recentlyUsedQueries=e.lrucache)}return e.prototype.optimisePagingFeatureQueries=function(e){this._parent&&this._parent.optimisePagingFeatureQueries(e)},e.prototype._hasMemorySource=function(){return!0},e.prototype.prop=function(e,t){return void 0===t?this[e]:(void 0!==this[e]&&(this[e]=t),this)},e.prototype.end=function(){return null!==this._parent&&!0===this._parent._transparent?this._parent.end():this._parent},e.prototype._ensureLoaded=function(){return this.load()},e.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=new r),null!==this._parent&&(!0===this._parent.loaded?!1===this._loadPromise.isFulfilled()&&(this._initialiseFeatureSet(),this._loadPromise.resolve(this)):this._parent.load().then(function(){try{e._initialiseFeatureSet(),e._loadPromise.resolve(e)}catch(t){e._loadPromise.reject(t)}})),this._loadPromise.promise},e.prototype._initialiseFeatureSet=function(){null!==this._parent?(this.fields=this._parent.fields.slice(0),this.geometryType=this._parent.geometryType,this.objectIdField=this._parent.objectIdField,this.spatialReference=this._parent.spatialReference,this.hasM=this._parent.hasM,this.hasZ=this._parent.hasZ,this.typeIdField=this._parent.typeIdField,this.types=this._parent.types):(this.fields=[],this.typeIdField="",this.objectIdField="",this.spatialReference=new d({wkid:4326}),this.geometryType=s.layerGeometryEsriConstants.point)},e.prototype.getField=function(e,t){var r;return(t=t||this.fields)&&(e=e.toLowerCase(),t.some(function(t){return t&&t.name.toLowerCase()===e&&(r=t),!!r})),r},e.prototype._maxProcessingRate=function(){return null!==this._parent?Math.min(this._maxProcessing,this._parent._maxProcessingRate()):Math.min(this._maxProcessing,this._maxQueryRate())},e.prototype._maxQueryRate=function(){return null!==this._parent?Math.max(this._maxQuery,this._parent._maxQueryRate()):this._maxQuery},e.prototype._checkCancelled=function(e){if(null!==e&&e.isCanceled())throw new Error("Operation has been cancelled.")},e.prototype._canDoAggregates=function(e,t,n,a,i){var s=new r;return null!==this._parent?this._parent._canDoAggregates(e,t,n,a,i):(s.resolve(!1),s.promise)},e.prototype._getAggregatePagesDataSourceDefinition=function(e,t,n,a,i,s,o){var l=new r;return null!==this._parent?this._parent._getAggregatePagesDataSourceDefinition(e,t,n,a,i,s,o):(l.reject(new Error("Should never be called")),l.promise)},e.prototype._getAgregagtePhysicalPage=function(e,t,n){var a=new r;return null!==this._parent?this._parent._getAgregagtePhysicalPage(e,t,n):(a.reject(new Error("Should never be called")),a.promise)},e.prototype.databaseType=function(){var e=this,t=new r;if(this._databaseType===s.FeatureServiceDatabaseType.NotEvaluated){if(null!==c.applicationCache){var n=c.applicationCache.getDatabaseType(this._cacheableFeatureSetSourceKey());if(null!==n)return n}if(null!==this._databaseTypeProbed)return this._databaseTypeProbed.then(s.callback(function(e){t.resolve(e)},t),s.errback(t)),t.promise;var a=[{thetype:s.FeatureServiceDatabaseType.SqlServer,testwhere:"(CAST( '2015-01-01' as DATETIME) = CAST( '2015-01-01' as DATETIME)) AND OBJECTID<0"},{thetype:s.FeatureServiceDatabaseType.Oracle,testwhere:"(TO_DATE('2003-11-18','YYYY-MM-DD') = TO_DATE('2003-11-18','YYYY-MM-DD')) AND OBJECTID<0"},{thetype:s.FeatureServiceDatabaseType.Standardised,testwhere:"(date '2015-01-01 10:10:10' = date '2015-01-01 10:10:10') AND OBJECTID<0"}];this._databaseTypeProbed=t,null!==c.applicationCache&&c.applicationCache.setDatabaseType(this._cacheableFeatureSetSourceKey(),t.promise),this._getDatabaseTypeImpl(a,0).then(s.callback(function(r){e._databaseType=r,t.resolve(e._databaseType)},t),function(r){null!==c.applicationCache&&c.applicationCache.clearDatabaseType(e._cacheableFeatureSetSourceKey()),t.reject(r)})}else t.resolve(this._databaseType);return t.promise},e.prototype._cacheableFeatureSetSourceKey=function(){return"MUSTBESET"},e.prototype._getDatabaseTypeImpl=function(e,t){var n=this,a=new r;return t>=e.length?a.resolve(s.FeatureServiceDatabaseType.Standardised):this._runDatabaseProbe(e[t].testwhere).then(s.callback(function(r){!0===r?a.resolve(e[t].thetype):n._getDatabaseTypeImpl(e,t+1).then(s.callback(function(e){a.resolve(e)},a),s.errback(a))},a),s.errback(a)),a.promise},e.prototype._runDatabaseProbe=function(e){var t=new r;return t.reject(new Error("Not Implemented")),t.promise},e.prototype._featureFromCache=function(e){if(void 0!==this._featureCache[e])return this._featureCache[e]},e.prototype._isInFeatureSet=function(e){return s.IdState.Unknown},e.prototype._getSet=function(e){return(new r).promise},e.prototype._getFeature=function(e,t,n){var a=this,i=new r;try{this._checkCancelled(n),void 0!==this._featureFromCache(t)?i.resolve(this._featureFromCache(t)):this._getFeatures(e,t,this._maxProcessingRate(),n).then(s.callback(function(){a._checkCancelled(n),void 0!==a._featureFromCache(t)?i.resolve(a._featureFromCache(t)):i.reject(new Error("Feature Not Found"))},i),s.errback(i))}catch(e){i.reject(e)}return i.promise},e.prototype._getFeatures=function(e,t,n,a){var i=new r;return i.resolve("success"),i.promise},e.prototype._getFilteredSet=function(e,t,n,a,i){return(new r).promise},e.prototype._refineSetBlock=function(e,t,n){var a=this,i=new r;try{if(!0===this._checkIfNeedToExpandCandidatePage(e,this._maxQueryRate(),n))return this._expandPagedSet(e,this._maxQueryRate(),0,0,n).then(s.callback(function(){a._refineSetBlock(e,t,n).then(s.callback(function(e){i.resolve(e)},i),s.errback(i))},i),s.errback(i)),i.promise;this._checkCancelled(n);var o=e._candidates.length;this._refineKnowns(e,t);var l=o-e._candidates.length;0===e._candidates.length?i.resolve(e):l>=t?i.resolve(e):this._refineIfParentKnown(e,t-l,n).then(s.callback(function(){if(a._checkCancelled(n),a._refineKnowns(e,t-l),(l=o-e._candidates.length)<t&&e._candidates.length>0){var r=t-l,u=a._prepareFetchAndRefineSet(e._candidates,a._maxQueryRate());a._fetchAndRefineFeatures(u,u.length>r?r:e._candidates.length,n).then(s.callback(function(){a._checkCancelled(n),a._refineKnowns(e,t-l),i.resolve(e)},i),s.errback(i))}else i.resolve(e)},i),s.errback(i))}catch(e){i.reject(e)}return i.promise},e.prototype._fetchAndRefineFeatures=function(e,t,r){return null},e.prototype._prepareFetchAndRefineSet=function(e,t){for(var r=[],n=0;n<e.length;n++)this._isPhysicalFeature(e[n])&&r.push(e[n]);return r},e.prototype._isPhysicalFeature=function(e){return null===this._parent||this._parent._isPhysicalFeature(e)},e.prototype._refineKnowns=function(e,t){var r=0,n=null,a=[];t=this._maxQueryRate();for(var i=0;i<e._candidates.length&&"GETPAGES"!==e._candidates[i];i++){var o=!1,l=this._candidateIdTransform(e._candidates[i]);l!==e._candidates[i]&&(o=!0);var u=this._isInFeatureSet(l);if(u===s.IdState.InFeatureSet)!0===o?e._known.indexOf(l)<0&&(e._known.push(l),r+=1):(e._known.push(e._candidates[i]),r+=1),null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i});else if(u===s.IdState.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(u===s.IdState.Unknown&&(r+=1,!0===e._ordered))break;if(r>=t)break}null!==n&&a.push(n);for(var c=a.length-1;c>=0;c--)e._candidates.splice(a[c].start,a[c].end-a[c].start+1)},e.prototype._refineIfParentKnown=function(e,t,n){var a=this,o=new r,l=new i([],[],e._ordered,null);return l._candidates=e._candidates.slice(0),this._parent._refineSetBlock(l,t,n).then(s.callback(function(t){a._parent._transformSetWithIdChanges(e),o.resolve(t)},o),s.errback(o)),o.promise},e.prototype._candidateIdTransform=function(e){return this._parent._candidateIdTransform(e)},e.prototype._transformSetWithIdChanges=function(e){this._parent._transformSetWithIdChanges(e)},e.prototype._checkIfNeedToExpandKnownPage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=e._lastFetchedIndex;a<e._known.length;a++){if("GETPAGES"===e._known[a])return!0;if(void 0===this._featureCache[e._known[a]]&&(n+=1)>=t)break}return!1},e.prototype._checkIfNeedToExpandCandidatePage=function(e,t,r){if(null===e.pagesDefinition)return!1;for(var n=0,a=0;a<e._candidates.length;a++){if("GETPAGES"===e._candidates[a])return!0;if((n+=1)>=t)break}return!1},e.prototype._expandPagedSet=function(e,t,n,a,i){if(null===this._parent){var s=new r;return s.reject(new Error("Parent Paging not implemented")),s.promise}return this._parent._expandPagedSet(e,t,n,a,i)},e.prototype._expandPagedSetFeatureSet=function(e,t,n,a,i){var o=this,l=new r;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]&&(a=1),0===a&&e._candidates.length>0&&"GETPAGES"===e._candidates[e._candidates.length-1]&&(a=2),0===a?l.resolve("finished"):this._getPage(e,a,i).then(s.callback(function(r){n+r<t?o._expandPagedSet(e,t,n+r,0,i).then(s.callback(function(e){l.resolve(e)},l),s.errback(l)):l.resolve("success")},l),s.errback(l)),l.promise},e.prototype._getPage=function(e,t,n){var a=this,i=new r,o=1===t?e._known:e._candidates;if(e.pagesDefinition.internal.set.length>e.pagesDefinition.resultOffset||!0===e.pagesDefinition.internal.fullyResolved){o.length=o.length-1;for(var l=0,u=0;u<e.pagesDefinition.resultRecordCount&&!(e.pagesDefinition.resultOffset+u>=e.pagesDefinition.internal.set.length);u++)o[o.length]=e.pagesDefinition.internal.set[e.pagesDefinition.resultOffset+u],l++;e.pagesDefinition.resultOffset+=e.pagesDefinition.resultRecordCount;var c=!1;!0===e.pagesDefinition.internal.fullyResolved&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset&&(c=!0),!1===c&&o.push("GETPAGES"),i.resolve(l)}else this._getPhysicalPage(e,t,n).then(s.callback(function(){a._getPage(e,t,n).then(s.callback(function(e){i.resolve(e)},i),s.errback(i))},i),s.errback(i));return i.promise},e.prototype._getPhysicalPage=function(e,t,r){return null},e.prototype._clonePageDefinition=function(e){return null===this._parent?null:this._parent._clonePageDefinition(e)},e.prototype._first=function(e){var t=this,n=new r;return this.shouldBeResolvedAsBigData()?this.expressAsArcadeScript().then(function(e){try{e.script+="\n return first("+e.featuresetIdentifier+")";var r=t.sourceGeoAnalyticsProvider();null===r?n.reject(new Error("No Big Data Provider")):r.executeScript(e.script,e.globals,e.spatialReference).then(function(e){n.resolve(e)},function(e){n.reject(e)})}catch(e){n.reject(e)}},function(e){n.reject(e)}):this.iterator(e).next().then(function(e){n.resolve(e)},function(e){n.reject(e)}),n.promise},e.prototype.first=function(){var e=new r;return this._first(e.promise).then(function(t){e.resolve(t)},function(t){e.reject(t)}),e.promise},e.prototype._qStat=function(e,t,n,a){var i=this,o=new r;return this.shouldBeResolvedAsBigData()?this._qBigDataStat(e,t,n,a):(this._ensureLoaded().then(s.callback(function(){i._stat(e,t,"",null,null,n,a).then(s.callback(function(r){!1===r.calculated?i._manualStat(e,t,n,a).then(s.callback(function(e){o.resolve(e.result)},o),s.errback(o)):o.resolve(r.result)},o),s.errback(o))},o),s.errback(o)),o.promise)},e.prototype._manualStat=function(e,t,n,a){var i=new r;switch(e.toLowerCase()){case"count":h.count(this,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"distinct":h.distinct(this,t,n).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"avg":case"mean":h.mean(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"stdev":h.stdev(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"variance":h.variance(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"sum":h.sum(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"min":h.min(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;case"max":h.max(this,t,a).then(s.callback(function(e){i.resolve({calculated:!0,result:e})},i),s.errback(i));break;default:i.resolve({calculated:!0,result:0})}return i.promise},e.prototype._stat=function(e,t,n,a,i,o,l){var u=this,c=new r;return this._parent._stat(e,t,n,a,i,o,l).then(s.callback(function(r){!1===r.calculated?null===i&&""===n&&null===a?u._manualStat(e,t,o,l).then(s.callback(function(e){c.resolve(e)},c),s.errback(c)):c.resolve({calculated:!1}):c.resolve(r)},c),s.errback(c)),c.promise},e.prototype._unionAllGeomSelf=function(){var e=new r;if(this.shouldBeResolvedAsBigData())return this._qBigDataStat("geometryunion",null,-1,null);var t=this.iterator(e.promise);return this._unionShapeInBatches([],t,s.callback(function(t){e.resolve(t)},e),s.errback(e)),e.promise},e.prototype._unionAllGeom=function(e){var t=new r,n=this.iterator(e);return this._unionShapeInBatches([],n,s.callback(function(e){t.resolve(e)},t),s.errback(t)),t.promise},e.prototype._unionShapeInBatches=function(e,t,n,a){var i=this,s=new r;return t.next().then(function(r){try{null!==r&&null!==r.geometry&&e.push(r.geometry),e.length>30||null===r&&e.length>1?p.union(e).then(function(s){try{null===r?n(s):(e=[s],i._unionShapeInBatches(e,t,n,a))}catch(e){a(e)}},a):null===r?n(1===e.length?e[0]:null):i._unionShapeInBatches(e,t,n,a)}catch(e){a(e)}},a),s.promise},e.prototype.iterator=function(e){return this.shouldBeResolvedAsBigData()?new u(this,e):new a(this,e)},e.prototype.intersection=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.intersection.bind(this)(t,r)},e.prototype.difference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.difference.bind(this)(t,r,n)},e.prototype.symmetricDifference=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!0),e._featuresetFunctions.symmetricDifference.bind(this)(t,r,n)},e.prototype.morphShape=function(t,r,n,a){return void 0===n&&(n="unknown"),void 0===a&&(a=null),e._featuresetFunctions.morphShape.bind(this)(t,r,n,a)},e.prototype.morphShapeAndAttributes=function(t,r,n){return void 0===n&&(n="unknown"),e._featuresetFunctions.morphShapeAndAttributes.bind(this)(t,r,n)},e.prototype.union=function(t,r){return void 0===r&&(r=!1),e._featuresetFunctions.union.bind(this)(t,r)},e.prototype.intersects=function(t){return e._featuresetFunctions.intersects.bind(this)(t)},e.prototype.envelopeIntersects=function(t){return e._featuresetFunctions.envelopeIntersects.bind(this)(t)},e.prototype.contains=function(t){return e._featuresetFunctions.contains.bind(this)(t)},e.prototype.overlaps=function(t){return e._featuresetFunctions.overlaps.bind(this)(t)},e.prototype.relate=function(t,r){return e._featuresetFunctions.relate.bind(this)(t,r)},e.prototype.within=function(t){return e._featuresetFunctions.within.bind(this)(t)},e.prototype.touches=function(t){return e._featuresetFunctions.touches.bind(this)(t)},e.prototype.top=function(t){return e._featuresetFunctions.top.bind(this)(t)},e.prototype.crosses=function(t){return e._featuresetFunctions.crosses.bind(this)(t)},e.prototype.buffer=function(t,r,n,a){return void 0===a&&(a=!0),e._featuresetFunctions.buffer.bind(this)(t,r,n,a)},e.prototype.filter=function(t,r){return void 0===r&&(r=null),e._featuresetFunctions.filter.bind(this)(t,r)},e.prototype.orderBy=function(t){return e._featuresetFunctions.orderBy.bind(this)(t)},e.prototype.dissolve=function(t,r){return e._featuresetFunctions.dissolve.bind(this)(t,r)},e.prototype.summarize=function(t,r){return e._featuresetFunctions.summarize.bind(this)(t,r)},e.prototype.summarizeBins=function(t,r,n,a){return e._featuresetFunctions.summarizeBins.bind(this)(t,r,n,a)},e.prototype.aggregate=function(t,r){return e._featuresetFunctions.aggregate.bind(this)(t,r)},e.prototype.reduce=function(e,t){void 0===t&&(t=null);var n=new r;return this._reduceImpl(this.iterator(n.promise),e,t,0,s.callback(function(e){n.resolve(e)},n),s.errback(n),0),n.promise},e.prototype._reduceImpl=function(e,t,r,a,i,s,o){var l=this;try{if(++o>1e3)return void setTimeout(function(){o=0,l._reduceImpl(e,t,r,a,i,s,o)});e.next().then(function(u){try{if(null===u)i(r);else{var c=t(r,u,a,l);c instanceof n?c.then(function(r){l._reduceImpl(e,t,r,a+1,i,s,o)},s):l._reduceImpl(e,t,c,a+1,i,s,o)}}catch(e){s(e)}},s)}catch(e){s(e)}},e.prototype.removeField=function(t){return e._featuresetFunctions.removeField.bind(this)(t)},e.prototype.addField=function(t,r,n){return void 0===n&&(n=null),e._featuresetFunctions.addField.bind(this)(t,r,n)},e.prototype.sumArea=function(e,t){void 0===t&&(t=!1);var n=s.convertSquareUnitsToCode(e);return this.shouldBeResolvedAsBigData()?this._qBigDataStat(t?"sumareageodesic":"sumarea",null,n,null):this.reduce(function(e,a){if(null===a.geometry)return 0;var i=new r;return t?p.geodesicArea(a.geometry,n).then(s.callback(function(t){i.resolve(e+t)},i),s.errback(i)):p.planarArea(a.geometry,n).then(s.callback(function(t){i.resolve(e+t)},i),s.errback(i)),i.promise},0)},e.prototype.sumLength=function(e,t){void 0===t&&(t=!1);var n=s.convertLinearUnitsToCode(e);return this.shouldBeResolvedAsBigData()?this._qBigDataStat(t?"sumlengthgeodesic":"sumlength",null,n,null):this.reduce(function(e,a){if(null===a.geometry)return 0;var i=new r;return t?p.geodesicLength(a.geometry,n).then(s.callback(function(t){i.resolve(e+t)},i),s.errback(i)):p.planarLength(a.geometry,n).then(s.callback(function(t){i.resolve(e+t)},i),s.errback(i)),i.promise},0)},e.prototype._substituteVars=function(e,t){if(null!==t){var r={};for(var n in t)r[n.toLowerCase()]=t[n];e.setVariablesDictionary(r)}},e.prototype.distinct=function(e,t,n){void 0===t&&(t=1e3),void 0===n&&(n=null);var a=o.create(e);this._substituteVars(a,n);var i=new r;return this._qStat("distinct",a,t,i.promise).then(s.callback(function(e){i.resolve(e)},i),s.errback(i)),i.promise},e.prototype.min=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("min",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.max=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("max",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.avg=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("avg",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.sum=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("sum",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.stdev=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("stdev",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.variance=function(e,t){void 0===t&&(t=null);var n=o.create(e);this._substituteVars(n,t);var a=new r;return this._qStat("variance",n,-1,a.promise).then(s.callback(function(e){a.resolve(e)},a),s.errback(a)),a.promise},e.prototype.count=function(){var e=new r;return this._qStat("count",o.create("1"),-1,e.promise).then(s.callback(function(t){e.resolve(t)},e),s.errback(e)),e.promise},e.prototype.forEach=function(e){var t=new r;return this._forEachImpl(this.iterator(t.promise),e,this,s.callback(function(e){t.resolve(e)},t),s.errback(t),0),t.promise},e.prototype._forEachImpl=function(e,t,r,a,i,s){var o=this;try{if(++s>1e3)return void setTimeout(function(){s=0,o._forEachImpl(e,t,r,a,i,s)},0);e.next().then(function(l){try{if(null===l)a(r);else{var u=t(l);void 0===u||null===u?o._forEachImpl(e,t,r,a,i,s):u instanceof n?u.then(function(){try{o._forEachImpl(e,t,r,a,i,s)}catch(e){i(e)}},i):o._forEachImpl(e,t,r,a,i,s)}}catch(e){i(e)}},i)}catch(e){i(e)}},e.prototype.convertToJSON=function(){for(var e=new r,t={layerDefinition:{geometryType:this.geometryType,fields:[]},featureSet:{features:[],geometryType:this.geometryType}},n=0;n<this.fields.length;n++)t.layerDefinition.fields.push(s.esriFieldToJson(this.fields[n]));return this.reduce(function(e){var r={geometry:e.geometry&&e.geometry.toJSON(),attributes:{}};for(var n in e.attributes)r.attributes[n]=e.attributes[n];return t.featureSet.features.push(r),1},0).then(function(){e.resolve(t)},function(t){e.reject(t)}),e.promise},e.prototype.canBeBigDataFeatureSet=function(){return this._parent.canBeBigDataFeatureSet()},e.prototype.shouldBeResolvedAsBigData=function(){return this._parent.shouldBeResolvedAsBigData()},e.prototype.expressAsArcadeScript=function(){var e=this,t=new r;return this._ensureLoaded().then(function(){try{var r={featuresetIdentifier:"",script:"",spatialReference:e.spatialReference,globals:{},functions:{stack:[],lkp:{}},symbols:{syms:{},featuresetsyms:[],symc:0}};r.script=e.expressAsArcadeScriptImpl(r.functions,r.globals,r.symbols);for(var n="",a=0,i=r.functions.stack;a<i.length;a++)n+="\n"+i[a].script;r.script=n+r.script,r.featuresetIdentifier=r.symbols.featuresetsyms[r.symbols.featuresetsyms.length-1],t.resolve(r)}catch(e){t.reject(e)}},function(e){t.reject(e)}),t.promise},e.prototype.expressAsArcadeScriptImpl=function(e,t,r){return this._parent.expressAsArcadeScriptImpl(e,t,r)+"\n"+this.arcadeScriptStep(e,t,r)},e.prototype.arcadeScriptStep=function(e,t,r){return""},e.prototype.arcadeAssignNextGlobalIdentifier=function(e){for(var t=!1,r="";!1===t;)r="$g_"+(++v).toString(),void 0===e.syms[r]&&(t=!0);return r},e.prototype.arcadeAssignNextScriptStepIdentifiers=function(e){for(var t=0===e.featuresetsyms.length?"":e.featuresetsyms[e.featuresetsyms.length-1],r=!1,n="";!1===r;)e.symc++,n="$$c_"+e.symc.toString(),void 0===e.syms[n]&&(r=!0);return e.featuresetsyms.push(n),e.syms[n]=n,{currentFeatureSet:t,newFeatureSet:n}},e.prototype.exportArcadeFunctionAndDependencies=function(e,t,r,n){return l.exportFunctionAsArcade(e,t,r,n)},e.prototype.constructArcadeGeom=function(e,t,r){var n=this.arcadeAssignNextGlobalIdentifier(r);return t[n]={name:n,type:"geometry",params:{value:e}},n},e.prototype._qBigDataStat=function(e,t,n,a){var i=this;void 0===n&&(n=-1);var o=new r;return this.expressAsArcadeScript().then(function(r){try{switch(e.toLowerCase()){case"sumlength":r.script+="\n return length("+r.featuresetIdentifier+","+n.toString()+")";break;case"sumlengthgeodesic":r.script+="\n return lengthgeodetic("+r.featuresetIdentifier+","+n.toString()+")";break;case"sumarea":r.script+="\n return area("+r.featuresetIdentifier+","+n.toString()+")";break;case"sumareageodesic":r.script+="\n return areageodetic("+r.featuresetIdentifier+","+n.toString()+")";break;case"geometryunion":r.script+="\n return union("+r.featuresetIdentifier+")";break;case"count":r.script+="\n return Count("+r.featuresetIdentifier+")";break;case"distinct":r.script+="\n return Distinct("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"avg":case"mean":r.script+="\n return Average("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"stdev":r.script+="\n return Stdev("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"variance":r.script+="\n return Variance("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"sum":r.script+="\n return Sum("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"min":r.script+="\n return Min("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;case"max":r.script+="\n return Max("+r.featuresetIdentifier+',"'+t.toWhereClause(s.FeatureServiceDatabaseType.Standardised)+'");';break;default:r.script="BADSTAT"}var a=i.sourceGeoAnalyticsProvider();"BADSTAT"===r.script?o.reject(new Error("Stat not supported")):null===a?o.reject(new Error("No Big Data Provider")):a.executeScript(r.script,r.globals,r.spatialReference).then(function(e){o.resolve(e)},function(e){o.reject(e)})}catch(e){o.reject(e)}},function(e){o.reject(e)}),o.promise},e.prototype.sourceGeoAnalyticsProvider=function(){return this._parent.sourceGeoAnalyticsProvider()},e.prototype.bigDataCachePipeline=function(e){return"ga_pipeline("+e+",'"+this._bigdCacheId+"')"},e.prototype.castToText=function(){return"object, FeatureSet"},e.prototype.schema=function(){for(var e=[],t=0,r=this.fields;t<r.length;t++){var n=r[t];e.push(s.esriFieldToJson(n))}return{objectIdField:this.objectIdField,typeIdField:this.typeIdField,geometryType:void 0===s.layerGeometryEsriConstants[this.geometryType]?"":s.layerGeometryEsriConstants[this.geometryType],hasZ:this.hasZ,hasM:this.hasM,fields:e}},e.prototype.convertToText=function(e){var t=this,n=new r;return"schema"===e?this._ensureLoaded().then(function(){n.resolve(JSON.stringify(t.schema))},function(e){n.reject(e)}):"featureset"===e?this._ensureLoaded().then(function(){var e=[];t.reduce(function(t){var r=t.toJson();return null!==r.geometry&&r.geometry.spatialReference&&delete r.geometry.spatialReference,e.push(r),1},0).then(function(){var r=t.schema();r.features=e,r.spatialReference=t.spatialReference.toJSON(),n.resolve(JSON.stringify(t.schema))},function(e){n.reject(e)})},function(e){n.reject(e)}):n.resolve(this.castToText()),n.promise},e._featuresetFunctions={},e._polyfill={table:null},e}()}.apply(null,n))||(e.exports=a)},1649:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(){return function(e,t,r,n){this._candidates=null,this._known=null,this._lastFetchedIndex=0,this._ordered=!1,this.pagesDefinition=null,this._candidates=e,this._known=t,this._ordered=r,this.pagesDefinition=n}}()}.apply(null,n))||(e.exports=a)},1693:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(106),r.dj.m(e),r(30),r(40),r(42),r(20),r(17),r(54),r(1785),r(58)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f){function h(e,t){var r;if(null==e||void 0===e)return e;if("number"==typeof e)return e;var n=e.toString();if(""===n)return null;if(2==t){if(void 0!==(r=S[n]))return r}else if(0==t){if(void 0!==(r=b[n]))return r;if(void 0!==(r=k[e]))return r}else if(3==t&&void 0!==(r=b[n]))return r;if(1==t&&void 0!==(r=k[e]))return r;if(!0===/^\d+$/.test(n))return parseInt(n);throw Error("Unrecognised Unit Type")}function p(e){if(void 0!==e&&null!==e)switch(e){case"loxodrome":return 1;case"great-elliptic":return 2;case"normal-section":return 3;case"shape-preserving":return 4}return 0}function d(e){if(null===e||void 0===e)return null;if(w)switch(e.type){case"point":return{x:e.x,y:e.y,z:e.z,m:e.m};case"multipoint":return{points:e.points,hasZ:e.hasZ,hasM:e.hasM};case"polyline":return{paths:e.paths,hasZ:e.hasZ,hasM:e.hasM};case"polygon":return{rings:e.rings,hasZ:e.hasZ,hasM:e.hasM};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax,zmin:e.zmin,zmax:e.zmax,mmin:e.mmin,mmax:e.mmax}}else switch(e.type){case"point":return{x:e.x,y:e.y};case"multipoint":return{points:e.points};case"polyline":return{paths:e.paths};case"polygon":return{rings:e.rings};case"extent":return{xmin:e.xmin,ymin:e.ymin,xmax:e.xmax,ymax:e.ymax}}return null}function v(e,t){if(null===e)return null;var r=function(e){if(void 0===o.fromJson){if(void 0!==e.x&&void 0!==e.y)return new o(e);if(void 0!==e.paths)return new s(e);if(void 0!==e.rings)return new i(e);if(void 0!==e.points)return new u(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return new l(e)}else{if(void 0!==e.x&&void 0!==e.y)return o.fromJson(e);if(void 0!==e.paths)return s.fromJson(e);if(void 0!==e.rings)return i.fromJson(e);if(void 0!==e.points)return u.fromJson(e);if(void 0!==e.xmin&&void 0!==e.ymin&&void 0!==e.xmax&&void 0!==e.ymax)return l.fromJson(e)}}(e);return w?r.set("spatialReference",t):r.setSpatialReference(t),r}function m(e){return null==e||void 0===e?null:-1!=e.wkid&&null!==e.wkid&&void 0!==e.wkid?{wkid:e.wkid}:""!==e.wkt&&void 0!==e.wkt&&null!==e.wkt?{wkt:e.wkt}:null}function g(e,t,r){var n=new f,a=t.spatialReference;return T.a({action:e,geoma:d(t),geomb:d(r),spatialReference:m(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(v(e.result,a))},function(e){n.reject(e)}),n.promise}function y(e,t,r){var n=new f;return T.a({action:e,geoma:d(t),geomb:d(r),spatialReference:m(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise}var _,w=0==r.version.indexOf("4.");!function(e){e[e.Linear=0]="Linear",e[e.Angular=1]="Angular",e[e.Area=2]="Area",e[e.LinearOrAngular=3]="LinearOrAngular"}(_||(_={}));var b={feet:9002,kilometers:9036,meters:9001,miles:9035,"nautical-miles":9030,yards:9096},S={acres:109402,ares:109463,hectares:109401,"square-feet":109405,"square-kilometers":109414,"square-meters":109404,"square-miles":109413,"square-yards":109442},k={degrees:9102,radians:9101},F=function(){function t(){this.c=!0,this.i=null}return t.prototype.A=function(e){var t=this;this.i=new c,this.i.setWorker(this.l(),function(){t.c=!1,e()})},t.prototype.l=function(){return e.B?e.B("./geometryenginewebworker"):n.id.replace(/\/[^\/]*$/gi,"/")+"./geometryenginewebworker"},t}(),T=function(){function e(){}return e.a=function(t){var r=new f;return e.h.push({task:t,d:r}),e.f(),r.promise},e.f=function(){if(0<e.h.length){for(var t=null,r=0;r<e.b.length;r++)if(!1===e.b[r].c){t=e.b[r];break}if(null===t&&e.b.length<e.g&&(r=new F,e.b.push(r),r.A(function(){e.f()})),null!==t){var n=this.h.shift();t.c=!0,t.i.postMessage(n.task).then(function(r){t.c=!1;try{n.d.resolve(r)}catch(e){}e.f()},function(r){t.c=!1;try{n.d.reject(r)}catch(e){}e.f()})}}},e.b=[],e.h=[],e.g=4,e}();return function(){function e(){}return e._removeAllWorkers=function(){T.b=[]},e._setMaxWorkers=function(t){e._removeAllWorkers(),T.g=t},e._getMaxWorkers=function(){return T.g},e._getNumWorkers=function(){return T.b.length},e.extendedSpatialReferenceInfo=function(e){var t=new f;return T.a({action:"extendedspatialreferenceinfo",spatialReference:m(e)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(e.result)},function(e){t.reject(e)}),t.promise},e.equals=function(e,t){return!(null===e&&null!==t||null===t&&null!==e)&&y("equals",e,t)},e.intersects=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("intersects",e,t)},e.touches=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("touches",e,t)},e.within=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("within",e,t)},e.disjoint=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("disjoint",e,t)},e.overlaps=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("overlaps",e,t)},e.crosses=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("crosses",e,t)},e.contains=function(e,t){if(null===e||null===t)throw Error("Illegal Argument Exception");return y("contains",e,t)},e.isSimple=function(e){return y("issimple",e,null)},e.clip=function(e,t){return g("clip",e,t)},e.simplify=function(e){var t=new f,r=e.spatialReference;return T.a({action:"simplify",geoma:d(e),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?t.reject(Error(e.error.message)):t.resolve(v(e.result,r))},function(e){t.reject(e)}),t.promise},e.rotate=function(e,t,r){var n=new f,a=e.spatialReference;if(void 0===r||null===r)switch(e.type){case"point":r=e;break;case"extent":r=w?e.get("center"):e.getCenter();break;default:r=w?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"rotate",geoma:d(e),spatialReference:m(e.spatialReference),angle:t,rotpt:d(r)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(v(e.result,a))},function(e){n.reject(e)}),n.promise},e.flipHorizontal=function(e,t){var r=new f,n=e.spatialReference;if(void 0===t||null===t)switch(e.type){case"point":t=e;break;case"extent":t=w?e.get("center"):e.getCenter();break;default:t=w?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"fliph",geoma:d(e),spatialReference:m(e.spatialReference),flippt:d(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(v(e.result,n))},function(e){r.reject(e)}),r.promise},e.flipVertical=function(e,t){var r=new f,n=e.spatialReference;if(void 0===t||null===t)switch(e.type){case"point":t=e;break;case"extent":t=w?e.get("center"):e.getCenter();break;default:t=w?e.get("extent").get("center"):e.getExtent().getCenter()}return T.a({action:"flipv",geoma:d(e),spatialReference:m(e.spatialReference),flippt:d(t)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(v(e.result,n))},function(e){r.reject(e)}),r.promise},e.distance=function(e,t,r){var n=new f;return T.a({action:"distance",geoma:d(e),geomb:d(t),spatialReference:m(e.spatialReference),distanceunits:h(r,3)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.relate=function(e,t,r){var n=new f;return T.a({action:"relate",geoma:d(e),geomb:d(t),relation:r,spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.nearestCoordinate=function(e,t,r){var n=new f,a=e.spatialReference;return T.a({action:"nearestcoord",geoma:d(e),geomb:d(t),spatialReference:m(e.spatialReference),testinterior:void 0===r||r}).then(function(e){0===e.status?n.reject(Error(e.error.message)):(e.result.coordinate=v(e.result.coordinate,a),n.resolve(e.result))},function(e){n.reject(e)}),n.promise},e.nearestVertex=function(e,t){var r=new f,n=e.spatialReference;return T.a({action:"nearestvertex",geoma:d(e),geomb:d(t),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):(e.result.coordinate=v(e.result.coordinate,n),r.resolve(e.result))},function(e){r.reject(e)}),r.promise},e.nearestVertices=function(e,t,r,n){var a=new f,i=e.spatialReference;return T.a({action:"nearestvertices",geoma:d(e),geomb:d(t),spatialReference:m(e.spatialReference),searchradius:r,maxreturn:n}).then(function(e){if(0===e.status)a.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t].coordinate=v(e.result[t].coordinate,i);a.resolve(e.result)}},function(e){a.reject(e)}),a.promise},e.cut=function(e,t){var r=new f,n=e.spatialReference;return T.a({action:"cut",geoma:d(e),geomb:d(t),spatialReference:m(e.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],n);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.generalize=function(e,t,r,n){var a=new f,i=e.spatialReference;return T.a({action:"generalize",geoma:d(e),maxdeviation:t,removedegenerateparts:r,maxdeviationunit:h(n,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?a.reject(Error(e.error.message)):a.resolve(v(e.result,i))},function(e){a.reject(e)}),a.promise},e.densify=function(e,t,r){var n=new f,a=e.spatialReference;return T.a({action:"densify",geoma:d(e),maxsegmentlength:t,maxsegmentlengthunit:h(r,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(v(e.result,a))},function(e){n.reject(e)}),n.promise},e.geodesicDensify=function(e,t,r,n){void 0===n&&(n=0);var a=new f,i=e.spatialReference;return T.a({action:"geodensify",geoma:d(e),maxsegmentlength:t,maxsegmentlengthunit:h(r,3),spatialReference:m(e.spatialReference),curveType:n}).then(function(e){0===e.status?a.reject(Error(e.error.message)):a.resolve(v(e.result,i))},function(e){a.reject(e)}),a.promise},e.intersect=function(t,r){return t instanceof a?g("intersect",t,r):e.u(t,r)},e.u=function(e,t){for(var r=new f,n=[],a=0;a<e.length;a++)n.push(d(e[a]));var i=t.spatialReference;return T.a({action:"intersectmany",geom:d(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.difference=function(t,r){return t instanceof a?g("difference",t,r):e.s(t,r)},e.s=function(e,t){for(var r=new f,n=[],a=0;a<e.length;a++)n.push(d(e[a]));var i=t.spatialReference;return T.a({action:"differencemany",geom:d(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.symmetricDifference=function(t,r){return t instanceof a?g("symdifference",t,r):e.w(t,r)},e.w=function(e,t){for(var r=new f,n=[],a=0;a<e.length;a++)n.push(d(e[a]));var i=t.spatialReference;return T.a({action:"symdifferencemany",geom:d(t),geometries:n,spatialReference:m(t.spatialReference)}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.union=function(e,t){void 0===t&&(t=null);var r=new f,n=[];if(null===e)return r.resolve(null),r.promise;if(e instanceof a&&(e=[e],null!==t&&e.push(t)),0===e.length)return r.resolve(null),r.promise;for(var i=0;i<e.length;i++)n.push(d(e[i]));var s=e[0].spatialReference;return T.a({action:"unionmany",geometries:n,spatialReference:m(s)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(v(e.result,s))},function(e){r.reject(e)}),r.promise},e.buffer=function(t,r,n,i){if(void 0===i&&(i=!1),t instanceof a){var s=new f,o=t.spatialReference;return T.a({action:"buffer",geoma:d(t),spatialReference:m(t.spatialReference),distance:r,unit:h(n,3),geodesic:!1,geodesicmaxdeviation:NaN,geodesiccurvetype:0}).then(function(e){0===e.status?s.reject(Error(e.error.message)):s.resolve(v(e.result,o))},function(e){s.reject(e)}),s.promise}if("[object Array]"!==Object.prototype.toString.call(r)){for(var l=[],u=0;u<t.length;u++)l.push(r);r=l}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");l=[];var c=0;for(u=0;u<t.length;u++)void 0===r[u]?l.push(c):(l.push(r[u]),c=r[u]);r=l}return e.j(t,r,n,!1,i,"geodesic",NaN)},e.geodesicBuffer=function(t,r,n,i,s,o){if(t instanceof a){var l=new f;void 0===s&&(s=NaN);var u=t.spatialReference;return T.a({action:"buffer",geoma:d(t),spatialReference:m(t.spatialReference),distance:r,unit:h(n,0),geodesic:!0,geodesicmaxdeviation:s,geodesiccurvetype:p(i)}).then(function(e){0===e.status?l.reject(Error(e.error.message)):l.resolve(v(e.result,u))},function(e){l.reject(e)}),l.promise}if("[object Array]"!==Object.prototype.toString.call(r)){for(var c=[],g=0;g<t.length;g++)c.push(r);r=c}if(r.length!=t.length){if(0==r.length)throw Error("Illegal Argument Exception");c=[];var y=0;for(g=0;g<t.length;g++)void 0===r[g]?c.push(y):(c.push(r[g]),y=r[g]);r=c}return e.j(t,r,n,!0,i,s,o)},e.j=function(e,t,r,n,a,i,s){var o=new f,l=[];if(void 0===s&&(s=NaN),null===e||0===e.length)return o.resolve(null),o.promise;for(var u=0;u<e.length;u++)l.push(d(e[u]));r=h(r,n?0:3);var c=e[0].spatialReference;return T.a({action:"buffermany",geometries:l,spatialReference:m(c),distances:t,tounionresults:a,unit:r,geodesic:n,geodesicmaxdeviation:s,geodesiccurvetype:p(i)}).then(function(e){if(0===e.status)o.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],c);o.resolve(e.result)}},function(e){o.reject(e)}),o.promise},e.convexHull=function(t,r){if(void 0===r&&(r=!1),t instanceof a){var n=new f,i=t.spatialReference;return T.a({action:"convexhull",geoma:d(t),spatialReference:m(t.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(v(e.result,i))},function(e){n.reject(e)}),n.promise}return e.o(t,r)},e.o=function(e,t){for(var r=new f,n=[],a=0;a<e.length;a++)n.push(d(e[a]));var i=0<e.length?e[0].spatialReference:null;return T.a({action:"convexhullmany",geometries:n,merge:t}).then(function(e){if(0===e.status)r.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],i);r.resolve(e.result)}},function(e){r.reject(e)}),r.promise},e.offset=function(t,r,n,i,s,o){var l=0;if(null!=i&&void 0!=i)switch(i){case"round":l=0;break;case"bevel":l=1;break;case"miter":l=2;break;case"square":l=3}if(t instanceof a){var u=new f,c=t.spatialReference;return T.a({action:"offset",geoma:d(t),spatialReference:m(t.spatialReference),distance:r,joins:l,bevelratio:s,flattenerror:o,offsetunit:h(n,3)}).then(function(e){0===e.status?u.reject(Error(e.error.message)):u.resolve(v(e.result,c))},function(e){u.reject(e)}),u.promise}return e.v(t,r,n,l,s,o)},e.v=function(e,t,r,n,a,i){for(var s=new f,o=[],l=0;l<e.length;l++)o.push(d(e[l]));var u=0<e.length?e[0].spatialReference:null;return T.a({action:"offsetmany",geometries:o,spatialReference:m(u),distance:t,joins:n,bevelratio:a,offsetunit:h(r,3),flattenerror:i}).then(function(e){if(0===e.status)s.reject(Error(e.error.message));else{for(var t=0;t<e.result.length;t++)e.result[t]=v(e.result[t],u);s.resolve(e.result)}},function(e){s.reject(e)}),s.promise},e.planarArea=function(e,t){var r=new f;return T.a({action:"area",geoma:d(e),unit:h(t,2),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},e.planarLength=function(e,t){var r=new f;return T.a({action:"length",geoma:d(e),unit:h(t,3),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?r.reject(Error(e.error.message)):r.resolve(e.result)},function(e){r.reject(e)}),r.promise},e.geodesicArea=function(e,t,r){var n=new f;return T.a({action:"geodesicarea",geoma:d(e),unit:h(t,2),geodesiccurvetype:p(r),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e.geodesicLength=function(e,t,r){var n=new f;return T.a({action:"geodesiclength",geoma:d(e),unit:h(t,0),geodesiccurvetype:p(r),spatialReference:m(e.spatialReference)}).then(function(e){0===e.status?n.reject(Error(e.error.message)):n.resolve(e.result)},function(e){n.reject(e)}),n.promise},e}()}.apply(null,n))||(e.exports=a)},1710:function(e,t,r){var n,a;n=[r(251)],void 0===(a=function(e){return e}.apply(null,n))||(e.exports=a)},1771:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(498),r(249),r(479),r(1943),r(1546),r(1693)],void 0===(a=function(e,t,r,n,a,i,s,o,l){function u(e){if(e){for(var t="",r=0,n=e;r<n.length;r++){var a=n[r];""!==a&&(t=""===t?a:S[t]<S[a]?a:t)}return t}return""}function c(e){return a(e,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate()}function f(e){return a(e,["YYYY-M-D"]).toDate()}function h(e){return!0===e}function p(e){return Array.isArray(e)?e:[e]}function d(e){return null!==e?!0!==e:null}function v(e,t){return null!=e&&null!=t?!0===e&&!0===t:!1!==e&&!1!==t&&null}function m(e,t){return null!=e&&null!=t?!0===e||!0===t:!0===e||!0===t||null}function g(e,t){if(null==e)return null;for(var r=!1,n=0,a=t;n<a.length;n++){var i=a[n];if(null==i)r=null;else if(e===i){r=!0;break}}return r}function y(e,t,r){if(null==e)return null;for(var n=t,a=r,i="",s="-[]/{}()*+?.\\^$|",o=0,l=0;l<n.length;l++){var u=n.charAt(l);switch(o){case 0:u===a?o=1:s.indexOf(u)>=0?i+="\\"+u:i+="%"===u?".*":"_"===u?".":u;break;case 1:s.indexOf(u)>=0?i+="\\"+u:i+=u,o=0}}return new RegExp("^"+i+"$").test(e)}function _(e){return e instanceof Date?e.valueOf():e}function w(e,t,r){if(null==t||null==r)return null;var n=_(t),a=_(r);switch(e){case"<>":return n!==a;case"=":return n===a;case">":return n>a;case"<":return n<a;case">=":return n>=a;case"<=":return n<=a}}function b(e){for(var t=[],r={},n=0,a=e;n<a.length;n++){var i=a[n],s=i.toLowerCase();void 0===r[s]&&(t.push(i),r[s]=1)}return t}var S={boolean:1,string:2,integer:3,double:4,date:5},k=function(){function e(){}return e.makeBool=function(e){return h(e)},e.featureValue=function(e,t){var r=e.attributes[t];if(void 0!==r)return r;for(var n in e.attributes)if(t.toLowerCase()===n.toLowerCase())return e.attributes[n];return null},e.equalsNull=function(e){return null===e},e.applyLike=function(e,t,r){return y(e,t,r)},e.ensureArray=function(e){return p(e)},e.applyIn=function(e,t){return g(e,t)},e.currentDate=function(){var e=new Date;return e.setHours(0,0,0,0),e},e.currentTimestamp=function(){return new Date},e.compare=function(e,t,r){return w(e,t,r)},e.makeComparable=function(e){return _(e)},e.evaluateFunction=function(e,t){return s.evaluateFunction(e,t)},e.lookup=function(e,t){var r=t[e];return void 0===r?null:r},e.between=function(e,t){return null==e||null==t[0]||null==t[1]?null:e>=t[0]&&e<=t[1]},e.notbetween=function(e,t){return null==e||null==t[0]||null==t[1]?null:e<t[0]||e>t[1]},e}();return function(){function e(){this.parseTree=null,this.parameters=null}return e.create=function(t){var r=new e;return r.parseTree=o.WhereGrammar.parse(t),r},e.prototype.isStandardized=function(){var e=!0;return this.visitAll(this.parseTree,function(t){e&&"function"===t.type&&(e=s.isStandardized(t.name,t.args.value.length))}),e},e.prototype.setVariablesDictionary=function(e){this.parameters=e},e.prototype.testFeature=function(e){return!!this.evaluateNode(this.parseTree,e)},e.prototype.testFeatureCompiled=function(e){return void 0===this.parseTree._compiledVersion&&this._compileMe(),!!this.parseTree._compiledVersion(e,this.parameters)},e.prototype._compileMe=function(){var e="return "+this.evaluateNodeToJavaScript(this.parseTree);this.parseTree._compiledVersion=new Function("feature","lookups",e).bind(k)},e.prototype.evaluateNodeToJavaScript=function(e){switch(e.type){case"case_expression":var t="";if("simple"===e.format){var r="this.makeComparable("+this.evaluateNodeToJavaScript(e.operand)+")";t="( ";for(var n=0;n<e.clauses.length;n++)t+=" ("+r+" === this.makeComparable("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")) ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}else{t="( ";for(n=0;n<e.clauses.length;n++)t+=" this.makeBool("+this.evaluateNodeToJavaScript(e.clauses[n].operand)+")===true ? ("+this.evaluateNodeToJavaScript(e.clauses[n].value)+") : ";null!==e.else?t+=this.evaluateNodeToJavaScript(e.else):t+="null",t+=" )"}return t;case"param":return"this.lookup("+JSON.stringify(e.value.toLowerCase())+",lookups)";case"expr_list":for(var a="[",i=0,s=e.value;i<s.length;i++){var o=s[i];"["!==a&&(a+=","),a+=this.evaluateNodeToJavaScript(o)}return a+"]";case"unary_expr":return"this.ternaryNot("+this.evaluateNodeToJavaScript(e.expr)+")";case"binary_expr":switch(e.operator){case"AND":return"this.ternaryAnd("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+" )";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(e.left)+")))";case"IN":return"this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+"))";case"NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(e.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(e.right)+")))";case"BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+")";case"NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+","+JSON.stringify(e.escape)+"))";case"<>":case"<":case">":case">=":case"<=":case"=":return"this.compare("+JSON.stringify(e.operator)+","+this.evaluateNodeToJavaScript(e.left)+","+this.evaluateNodeToJavaScript(e.right)+")";case"*":return"("+this.evaluateNodeToJavaScript(e.left)+" * "+this.evaluateNodeToJavaScript(e.right)+")";case"-":return"("+this.evaluateNodeToJavaScript(e.left)+" - "+this.evaluateNodeToJavaScript(e.right)+")";case"+":return"("+this.evaluateNodeToJavaScript(e.left)+" + "+this.evaluateNodeToJavaScript(e.right)+")";case"/":return"("+this.evaluateNodeToJavaScript(e.left)+" / "+this.evaluateNodeToJavaScript(e.right)+")"}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return JSON.stringify(e.value);case"date":return"(new Date("+f(e.value).getTime().toString()+"))";case"timestamp":return"(new Date("+c(e.value).getTime().toString()+"))";case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?"this.currentDate()":"CURRENT_TIMESTAMP"===e.column.toUpperCase()?"this.currentTimestamp()":"this.featureValue(feature,"+JSON.stringify(e.column)+")";case"function":return"this.evaluateFunction("+JSON.stringify(e.name)+","+this.evaluateNodeToJavaScript(e.args)+")"}throw new Error("Unsupported sql syntax "+e.type)},e.prototype.calculateValue=function(e){return this.evaluateNode(this.parseTree,e)},e.prototype.predictType=function(e,t){void 0===t&&(t={});for(var r={},n={},a={esriFieldTypeSmallInteger:"integer",esriFieldTypeInteger:"integer",esriFieldTypeSingle:"double",esriFieldTypeDouble:"double",esriFieldTypeString:"string",esriFieldTypeDate:"date",esriFieldTypeOID:"integer",oid:"integer",long:"integer","small-integer":"integer",integer:"integer",single:"double",double:"double",date:"date",string:"string"},i=0,s=e;i<s.length;i++){var o=a[(l=s[i]).type];r[l.name.toLowerCase()]=void 0===o?"":o}for(var l in t){o=a[t[l]];n[l.toLowerCase()]=void 0===o?"":o}switch(this.evaluateType(r,this.parseTree,n)){case"double":return"double";case"integer":return"integer";case"double":return"double";case"date":return"date";case"string":return"string"}return""},e.prototype.evaluateType=function(e,t,r){var n;switch(t.type){case"case_expression":var a=[];if("simple"===t.format){for(var i=0;i<t.clauses.length;i++)a.push(this.evaluateType(e,t.clauses[i].value,r));null!==t.else&&a.push(this.evaluateType(e,t.else,r))}else{for(i=0;i<t.clauses.length;i++)a.push(this.evaluateType(e,t.else,r));null!==t.else&&a.push(this.evaluateType(e,t.else,r))}return u(a);case"param":var s=r[t.value.toLowerCase()];if(void 0===s&&this.parameters){var o=this.parameters[t.value.toLowerCase()];if(void 0===o)return"";if(null===o)return"";if("string"==typeof o||o instanceof String)return"string";if("boolean"==typeof o)return"boolean";if(o instanceof Date)return"date";if("number"==typeof o)return o%1==0?"integer":"double"}return void 0===s?"":s;case"expr_list":for(var l=[],c=0,f=t.value;c<f.length;c++){var h=f[c];l.push(this.evaluateType(e,h,r))}return l;case"unary_expr":return"boolean";case"binary_expr":switch(t.operator){case"AND":case"OR":return"boolean";case"IS":case"ISNOT":if("null"!==t.right.type)throw new Error("Unsupported RHS for IS");return"boolean";case"IN":case"NOT IN":case"BETWEEN":case"NOTBETWEEN":case"LIKE":case"NOT LIKE":return"boolean";case"<>":case"<":case">":case">=":case"<=":case"=":return"boolean";case"*":case"-":case"+":case"/":return u([this.evaluateType(e,t.left,r),this.evaluateType(e,t.right,r)])}throw new Error("Not Supported Operator "+t.operator);case"null":return"";case"bool":return"boolean";case"string":return"string";case"number":return null===t.value?"":t.value%1==0?"integer":"double";case"date":case"timestamp":return"date";case"column_ref":if("CURRENT_DATE"===t.column.toUpperCase())return"date";if("CURRENT_TIMESTAMP"===t.column.toUpperCase())return"date";var p=e[t.column.toLowerCase()];return void 0===p?"":p;case"function":switch(t.name.toLowerCase()){case"position":case"extract":case"char_length":return"integer";case"round":return(n=this.evaluateType(e,t.args,r))instanceof Array?n.length>0?n[0]:"":n;case"sign":return(n=this.evaluateType(e,t.args,r))instanceof Array&&(n=u(n)),"integer"===n||"double"===n?n:"double";case"ceiling":case"floor":case"abs":var d=this.evaluateType(e,t.args,r);return d instanceof Array?u(d):d;case"area":case"length":case"log":case"log10":case"sin":case"cos":case"tan":case"asin":case"acos":case"atan":case"power":return"double";case"substring":case"trim":case"concat":case"lower":case"upper":return"string";case"truncate":return"double";case"round":return(n=this.evaluateType(e,t.args,r))instanceof Array?n.length>0?n[0]:"":n}return""}throw new Error("Unsupported sql syntax "+t.type)},e.prototype.calculateValueCompiled=function(e){return void 0===this.parseTree._compiledVersion&&this._compileMe(),this.parseTree._compiledVersion(e,this.parameters)},e.prototype.getFunctions=function(){var e=[];return this.visitAll(this.parseTree,function(t){"function"===t.type&&e.push(t.name.toLowerCase())}),b(e)},e.prototype.getFields=function(){var e=[];return this.visitAll(this.parseTree,function(t){"column_ref"===t.type&&e.push(t.column)}),b(e)},e.prototype.getVariables=function(){var e=[];return this.visitAll(this.parseTree,function(t){"param"===t.type&&e.push(t.value.toLowerCase())}),b(e)},e.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return r.column=a,e.attributes[a];return null},e.prototype.visitAll=function(e,t){if(null!=e)switch(t(e),e.type){case"when_clause":this.visitAll(e.operand,t),this.visitAll(e.value,t);break;case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var a=n[r];this.visitAll(a,t)}"simple"===e.format&&this.visitAll(e.operand,t),null!==e.else&&this.visitAll(e.else,t);break;case"expr_list":for(var i=0,s=e.value;i<s.length;i++){a=s[i];this.visitAll(a,t)}break;case"unary_expr":this.visitAll(e.expr,t);break;case"binary_expr":this.visitAll(e.left,t),this.visitAll(e.right,t);break;case"function":this.visitAll(e.args,t)}},e.prototype.toWhereClause=function(e){return this.evaluateNodeToWhereClause(this.parseTree,e)},e.prototype.reformulateWithoutField=function(t,r){return e.create(this.evaluateNodeToWhereClause(this.parseTree,i.FeatureServiceDatabaseType.Standardised,t,r))},e.prototype.statisticFunction=function(){if("function"===this.parseTree.type){if(0===this.parseTree.args.value.length)return{name:this.parseTree.name,expr:null};if(this.parseTree.args.value.length>1)throw new Error("Statistic does not have 1 or 0 Parameters");var t=new e;return t.parseTree=this.parseTree.args.value[0],{name:this.parseTree.name,expr:t}}return null},e.prototype.testFeatureDeferred=function(e){var t=new r;return this.evaluateNodeDeferred(this.parseTree,e).then(i.callback(function(e){t.resolve(e)},t),i.errback(t)),t.promise},e.prototype.calculateValueDeferred=function(e){var t=new r;return this.evaluateNodeDeferred(this.parseTree,e).then(i.callback(function(e){t.resolve(e)},t),i.errback(t)),t.promise},e.prototype.scanForField=function(e){return this.findField(this.parseTree,e)},e.combine=function(t,r,n){return void 0===n&&(n="AND"),e.create("(("+t.toWhereClause(i.FeatureServiceDatabaseType.Standardised)+")"+n+"("+r.toWhereClause(i.FeatureServiceDatabaseType.Standardised)+"))")},e.prototype.isSingleField=function(){return"column_ref"===this.parseTree.type},e.prototype.findField=function(e,t){if(null===e||void 0===e)return!1;switch(e.type){case"when_clause":return this.findField(e.operand,t)||this.findField(e.value,t);case"case_expression":for(var r=0,n=e.clauses;r<n.length;r++){var a=n[r];if(this.findField(a,t))return!0}return!("simple"!==e.format||!this.findField(e.operand,t))||!(null===e.else||!this.findField(e.else,t));case"param":return!1;case"expr_list":for(var i=0,s=e.value;i<s.length;i++){a=s[i];if(this.findField(a,t))return!0}return!1;case"unary_expr":return this.findField(e.expr,t);case"binary_expr":return this.findField(e.left,t)||this.findField(e.right,t);case"null":case"bool":case"date":case"timestamp":case"string":case"number":return!1;case"column_ref":return t.toLowerCase()===e.column.toLowerCase();case"function":return this.findField(e.args,t)}return!1},e.prototype.evaluateNode=function(e,t){switch(e.type){case"case_expression":if("simple"===e.format){for(var r=_(this.evaluateNode(e.operand,t)),n=0;n<e.clauses.length;n++)if(r===_(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}else{for(n=0;n<e.clauses.length;n++)if(h(this.evaluateNode(e.clauses[n].operand,t)))return this.evaluateNode(e.clauses[n].value,t);if(null!==e.else)return this.evaluateNode(e.else,t)}return null;case"param":return this.parameters[e.value.toLowerCase()];case"expr_list":for(var a=[],i=0,o=e.value;i<o.length;i++){var l=o[i];a.push(this.evaluateNode(l,t))}return a;case"unary_expr":return d(this.evaluateNode(e.expr,t));case"binary_expr":switch(e.operator){case"AND":return v(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"OR":return m(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null===this.evaluateNode(e.left,t);case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return null!==this.evaluateNode(e.left,t);case"IN":var u=p(this.evaluateNode(e.right,t));return g(this.evaluateNode(e.left,t),u);case"NOT IN":u=p(this.evaluateNode(e.right,t));return d(g(this.evaluateNode(e.left,t),u));case"BETWEEN":var b=this.evaluateNode(e.left,t),S=this.evaluateNode(e.right,t);return null==b||null==S[0]||null==S[1]?null:b>=S[0]&&b<=S[1];case"NOTBETWEEN":b=this.evaluateNode(e.left,t),S=this.evaluateNode(e.right,t);return null==b||null==S[0]||null==S[1]?null:b<S[0]||b>S[1];case"LIKE":return y(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape);case"NOT LIKE":return d(y(this.evaluateNode(e.left,t),this.evaluateNode(e.right,t),e.escape));case"<>":case"<":case">":case">=":case"<=":case"=":return w(e.operator,this.evaluateNode(e.left,t),this.evaluateNode(e.right,t));case"*":return this.evaluateNode(e.left,t)*this.evaluateNode(e.right,t);case"-":return this.evaluateNode(e.left,t)-this.evaluateNode(e.right,t);case"+":return this.evaluateNode(e.left,t)+this.evaluateNode(e.right,t);case"/":return this.evaluateNode(e.left,t)/this.evaluateNode(e.right,t)}throw new Error("Not Supported Operator "+e.operator);case"null":case"bool":case"string":case"number":return e.value;case"date":return f(e.value);case"timestamp":return c(e.value);case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?((l=new Date).setHours(0,0,0,0),l):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?new Date:this.featureValue(t,e.column,e);case"function":var k=this.evaluateNode(e.args,t);return s.evaluateFunction(e.name,k)}throw new Error("Unsupported sql syntax "+e.type)},e.prototype._makeDateString=function(e,t){var r=a(e),n=0===r.minute()&&0===r.hour()&&0===r.second()&&0===r.millisecond();switch(t){case i.FeatureServiceDatabaseType.FILEGDB:case i.FeatureServiceDatabaseType.Standardised:return n?"date '"+r.format("YYYY-MM-DD")+"'":"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'";case i.FeatureServiceDatabaseType.Oracle:return n?"TO_DATE('"+r.format("YYYY-MM-DD")+"','YYYY-MM-DD')":"TO_DATE('"+r.format("YYYY-MM-DD HH:mm:ss")+"','YYYY-MM-DD HH24:MI:SS')";case i.FeatureServiceDatabaseType.SqlServer:return"'"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";case i.FeatureServiceDatabaseType.PGDB:return"#"+r.format(n?"MM-DD-YYYY":"MM-DD-YYYY HH:mm:ss")+"#";case i.FeatureServiceDatabaseType.Postgres:return"TIMESTAMP '"+r.format(n?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss")+"'";default:return"date '"+r.format("YYYY-MM-DD HH:mm:ss")+"'"}},e.prototype._makeToday=function(e,t){switch(t){case i.FeatureServiceDatabaseType.FILEGDB:case i.FeatureServiceDatabaseType.Standardised:case i.FeatureServiceDatabaseType.Oracle:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP";case i.FeatureServiceDatabaseType.SqlServer:return e?"CAST(GETDATE() AS DATE)":"GETDATE()";case i.FeatureServiceDatabaseType.PGDB:case i.FeatureServiceDatabaseType.Postgres:default:return e?"CURRENT_DATE":"CURRENT_TIMESTAMP"}},e.prototype.evaluateNodeToWhereClause=function(e,t,r,n){var a,i,s,o;switch(void 0===r&&(r=null),void 0===n&&(n=null),e.type){case"case_expression":var l=" CASE ";"simple"===e.format&&(l+=this.evaluateNodeToWhereClause(e.operand,t,r,n));for(var u=0;u<e.clauses.length;u++)l+=" WHEN "+this.evaluateNodeToWhereClause(e.clauses[u].operand,t,r,n)+" THEN "+this.evaluateNodeToWhereClause(e.clauses[u].value,t,r,n);return null!==e.else&&(l+=" ELSE "+this.evaluateNodeToWhereClause(e.else,t,r,n)),l+" END ";case"param":var c=this.parameters[e.value.toLowerCase()];if("string"==typeof c)return"'"+this.parameters[e.value.toLowerCase()].toString().replace(/'/g,"''")+"'";if(c instanceof Date)return this._makeDateString(c,t);if(c instanceof Array){var f=[];for(u=0;u<c.length;u++)"string"==typeof c[u]?f.push("'"+c[u].toString().replace(/'/g,"''")+"'"):c[u]instanceof Date?f.push(this._makeDateString(c[u],t)):f.push(c[u].toString());return f}return c.toString();case"expr_list":i=[];for(var h=0,p=e.value;h<p.length;h++){var d=p[h];i.push(this.evaluateNodeToWhereClause(d,t,r,n))}return i;case"unary_expr":return" ( NOT "+this.evaluateNodeToWhereClause(e.expr,t,r,n)+" ) ";case"binary_expr":switch(e.operator){case"AND":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" AND "+this.evaluateNodeToWhereClause(e.right,t,r,n)+") ";case"OR":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" OR "+this.evaluateNodeToWhereClause(e.right,t,r,n)+") ";case"IS":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" IS NULL )";case"ISNOT":if("null"!==e.right.type)throw new Error("Unsupported RHS for IS");return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" IS NOT NULL )";case"IN":return a=[],"expr_list"===e.right.type?(a=this.evaluateNodeToWhereClause(e.right,t,r,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" IN ("+a.join(",")+")) "):(o=this.evaluateNodeToWhereClause(e.right,t,r,n))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" IN ("+o+")) ";case"NOT IN":return a=[],"expr_list"===e.right.type?(a=this.evaluateNodeToWhereClause(e.right,t,r,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT IN ("+a.join(",")+")) "):(o=this.evaluateNodeToWhereClause(e.right,t,r,n))instanceof Array?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT IN ("+o.join(",")+")) ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT IN ("+o+")) ";case"BETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,r,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"NOTBETWEEN":return s=this.evaluateNodeToWhereClause(e.right,t,r,n)," ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT BETWEEN "+s[0]+" AND "+s[1]+" ) ";case"LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,n)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,n)+") ";case"NOT LIKE":return""!==e.escape?" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,n)+" ESCAPE '"+e.escape+"') ":" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" NOT LIKE "+this.evaluateNodeToWhereClause(e.right,t,r,n)+") ";case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":return" ("+this.evaluateNodeToWhereClause(e.left,t,r,n)+" "+e.operator+" "+this.evaluateNodeToWhereClause(e.right,t,r,n)+") "}throw new Error("Not Supported Operator "+e.operator);case"null":return"null";case"bool":return!0===e.value?"1":"0";case"string":return"'"+e.value.toString().replace(/'/g,"''")+"'";case"timestamp":case"date":return this._makeDateString(e.value,t);case"number":return e.value.toString();case"column_ref":return"CURRENT_DATE"===e.column.toUpperCase()?this._makeToday(!0,t):"CURRENT_TIMESTAMP"===e.column.toUpperCase()?this._makeToday(!1,t):r&&r.toLowerCase()===e.column.toLowerCase()?"("+n+")":e.column;case"function":var v=this.evaluateNodeToWhereClause(e.args,t,r,n);return this._translateFunctionToDatabaseSpecific(e.name,v,t)}throw new Error("Unsupported sql syntax "+e.type)},e.prototype._translateFunctionToDatabaseSpecific=function(e,t,r){switch(e.toLowerCase().trim()){case"abs":if(1!==t.length)throw new Error("Invalid Parameter for call to ABS");return"abs("+t[0]+")";case"ceiling":case"ceil":if(1!==t.length)throw new Error("Invalid Parameter for call to CEILING");switch(r){case i.FeatureServiceDatabaseType.Standardised:default:return"CEILING("+t[0]+")"}case"floor":if(1!==t.length)throw new Error("Invalid Parameter for call to Floor");return"FLOOR("+t[0]+")";case"log":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG");return"LOG("+t[0]+")";case"log10":if(1!==t.length)throw new Error("Invalid Parameter for call to LOG10");return"LOG10("+t[0]+")";case"power":if(2!==t.length)throw new Error("Invalid Parameter for call to POWER");return"POWER("+t[0]+","+t[1]+")";case"round":if(2===t.length)return"ROUND("+t[0]+","+t[1]+")";if(1===t.length)return"ROUND("+t[0]+")";throw new Error("Invalid Parameter for call to ROUND");case"truncate":if(t.length<1||t.length>2)throw new Error("Invalid Parameter for TRUNCATE function");switch(r){case i.FeatureServiceDatabaseType.SqlServer:return"ROUND("+t[0]+(1===t.length?"0":","+t[1])+",1)";default:return"TRUNCATE("+t[0]+(1===t.length?")":","+t[1]+")")}case"char_length":case"len":if(1!==t.length)throw new Error("Invalid Parameter for CHAR_LENGTH function");switch(r){case i.FeatureServiceDatabaseType.SqlServer:return"LEN("+t[0]+")";case i.FeatureServiceDatabaseType.Oracle:return"LENGTH("+t[0]+")";default:return"CHAR_LENGTH("+t[0]+")"}case"concat":if(t.length<1)throw new Error("Invalid Parameter for CONCAT function");for(var n="CONCAT(",a=0;a<t.length;a++)0!==a&&(n+=","),n+=t[a];return n+")";case"lower":case"lcase":if(1!==t.length)throw new Error("Invalid Parameter for Lower function");return"LOWER("+t[0]+")";case"upper":case"ucase":if(1!==t.length)throw new Error("Invalid Parameter for Upper function");return"UPPER("+t[0]+")";case"substring":var s="";switch(r){case i.FeatureServiceDatabaseType.Oracle:return s="SUBSTR("+t[0]+","+t[1],3===t.length&&(s+=","+t[2]),s+")";case i.FeatureServiceDatabaseType.SqlServer:return 3===t.length?"SUBSTRING("+t[0]+","+t[1]+","+t[2]+")":"SUBSTRING("+t[0]+",  "+t[1]+", LEN("+t[0]+") - "+t[1]+")";default:return s="SUBSTRING("+t[0]+" FROM "+t[1],3===t.length&&(s+=" FOR "+t[2]),s+")"}case"extract":return"EXTRACT("+t[0].replace(/\'/g,"")+" FROM "+t[1]+")"}throw new Error("Function Not Recognised")},e.prototype.evaluateWhereClausesSimpleDeferred=function(e,t,n,a,i){var s=this,o=new r;try{t>=e.length?null===n?o.resolve(null):this.evaluateNodeDeferred(n,i).then(function(e){o.resolve(e)},function(e){o.reject(e)}):this.evaluateNodeDeferred(e[t],i).then(function(r){try{a===_(r)?s.evaluateNodeDeferred(e[t].value,i).then(function(e){o.resolve(e)},function(e){o.reject(e)}):s.evaluateWhereClausesSimpleDeferred(e,t+1,n,a,i).then(function(e){o.resolve(e)},function(e){o.reject(e)})}catch(e){o.reject(e)}},function(e){o.reject(e)})}catch(e){o.reject(e)}return o.promise},e.prototype.evaluateWhereClausesDeferred=function(e,t,n,a){var i=this,s=new r;try{t>=e.length?null===n?s.resolve(null):this.evaluateNodeDeferred(n,a).then(function(e){s.resolve(e)},function(e){s.reject(e)}):this.evaluateNodeDeferred(e[t].operand,a).then(function(r){try{h(r)?i.evaluateNodeDeferred(e[t].value,a).then(function(e){s.resolve(e)},function(e){s.reject(e)}):i.evaluateWhereClausesDeferred(e,t+1,n,a).then(function(e){s.resolve(e)},function(e){s.reject(e)})}catch(e){s.reject(e)}},function(e){s.reject(e)})}catch(e){s.reject(e)}return s.promise},e.prototype.evaluateNodeDeferred=function(e,t){var a,s=this,o=new r;try{var l=void 0;switch(e.type){case"case_expression":"simple"===e.format?this.evaluateNodeDeferred(e.operand,t).then(function(r){var n=_(r);s.evaluateWhereClausesSimpleDeferred(e.clauses,0,e.else,n,t).then(function(e){o.resolve(e)},function(e){o.reject(e)})},function(e){o.reject(e)}):this.evaluateWhereClausesDeferred(e.clauses,0,e.else,t).then(function(e){o.resolve(e)},function(e){o.reject(e)});break;case"param":o.resolve(this.parameters[e.value.toLowerCase()]);break;case"expr_list":l=[];for(var u=0,h=e.value;u<h.length;u++){var p=h[u];l.push(this.evaluateNodeDeferred(p,t))}n(l).then(i.callback(function(e){o.resolve(e)},o),i.errback(o));break;case"unary_expr":this.evaluateNodeDeferred(e.value,t).then(i.callback(function(e){o.resolve(d(e))},o),i.errback(o));break;case"binary_expr":switch(e.operator){case"IS":"null"!==e.right.type?o.reject(new Error("Unsupported RHS for IS")):this.evaluateNodeDeferred(e.left,t).then(i.callback(function(e){o.resolve(null===e)},o),i.errback(o));break;case"ISNOT":"null"!==e.right.type?o.reject(new Error("Unsupported RHS for IS")):this.evaluateNodeDeferred(e.left,t).then(i.callback(function(e){o.resolve(null!==e)},o),i.errback(o));break;case"LIKE":case"NOT LIKE":case"BETWEEN":case"NOTBETWEEN":case"IN":case"NOT IN":case"AND":case"OR":case"<>":case"<":case">":case">=":case"<=":case"=":case"*":case"-":case"+":case"/":a=[this.evaluateNodeDeferred(e.left,t),this.evaluateNodeDeferred(e.right,t)],n(a).then(i.callback(function(t){switch(e.operator){case"LIKE":case"NOT LIKE":var r=y(t[0],t[0],e.escape);o.resolve("LIKE"===e.operator?r:d(r));break;case"BETWEEN":var n=t[0],a=t[1];o.resolve(null==n||null==a[0]||null==a[1]?null:n>=a[0]&&n<=a[1]);break;case"NOTBETWEEN":var i=t[0],s=t[1];o.resolve(null==i||null==s[0]||null==s[1]?null:i<s[0]||i>s[1]);break;case"IN":case"NOT IN":var l=null;l=t[1]instanceof Array?t[1]:[l],"IN"===e.operator?o.resolve(g(t[0],l)):"NOT IN"===e.operator&&o.resolve(d(g(t[0],l)));break;case"AND":o.resolve(v(t[0],t[1]));break;case"OR":o.resolve(m(t[0],t[1]));break;case"<>":case"<":case">":case">=":case"<=":case"=":o.resolve(w(e.operator,t[0],t[1]));break;case"*":o.resolve(t[0]*t[1]);break;case"-":o.resolve(t[0]-t[1]);break;case"+":o.resolve(t[0]+t[1]);break;case"/":o.resolve(t[0]/t[1]);break;default:o.reject(new Error("Unrecognised operator"))}},o),i.errback(o));break;default:o.reject(new Error("Not Supported Operator "+e.operator))}break;case"null":case"bool":case"string":case"number":o.resolve(e.value);break;case"date":o.resolve(f(e.value));break;case"timestamp":o.resolve(c(e.value));break;case"column_ref":if("CURRENT_DATE"===e.column.toUpperCase())(p=new Date).setHours(0,0,0,0),o.resolve(p);else if("CURRENT_TIMESTAMP"===e.column.toUpperCase()){var b=new Date;o.resolve(b)}else o.resolve(this.featureValue(t,e.column,e));break;case"function":this.evaluateNodeDeferred(e.args,t).then(i.callback(function(r){s.executeFunctionDeferred(e.name,t,r).then(i.callback(function(e){o.resolve(e)},o),i.errback(o))},o),i.errback(o));break;default:o.reject(new Error("Malformed Where Clause"))}}catch(e){o.reject(e)}return o.promise},e.prototype.executeFunctionDeferred=function(e,t,n){var a=new r,o=0;try{if(s.isStandardized(e,n.length))a.resolve(s.evaluateFunction(e,n));else switch(e.toLowerCase().trim()){case"area":o=i.convertSquareUnitsToCode(n[0]);var u=!1;void 0!==n[1]&&null!==n[1]&&("1"!==n[1].toString()&&"true"!==n[1].toString().toLowerCase()&&"geodesic"!==n[1].toString().toLowerCase()||(u=!0)),null===t.geometry?a.resolve(0):u?l.geodesicArea(t.geometry,o).then(i.callback(function(e){a.resolve(e)},a),i.errback(a)):l.planarArea(t.geometry,o).then(i.callback(function(e){a.resolve(e)},a),i.errback(a));break;case"length":o=i.convertLinearUnitsToCode(n[0]),void 0!==n[1]&&null!==n[1]&&("1"!==n[1].toString()&&"true"!==n[1].toString().toLowerCase()&&"geodesic"!==n[1].toString().toLowerCase()||(u=!0)),null===t.geometry?a.resolve(0):l.planarLength(t.geometry,o).then(i.callback(function(e){a.resolve(e)},a),i.errback(a));break;default:a.reject(new Error("Function Not Recognised"))}}catch(e){a.reject(e)}return a.promise},e}()}.apply(null,n))||(e.exports=a)},1785:function(e,t,r){var n,a;n=[r(167),r(104),r(58),r(1710),r(16),r(22),r.dj.c(e.i)],void 0===(a=function(e,t,r,n,a,i,s){var o=window.Blob||window.webkitBlob||window.mozBlob,l=window.URL||window.webkitURL||window.mozURL;return t([e],{declaredClass:"esri.workers.WorkerClient",worker:null,_queue:null,constructor:function(e,t){this._isIE=a("ie"),this._queue={},this._acceptMessage=this._acceptMessage.bind(this),this._errorMessage=this._errorMessage.bind(this),e&&this.setWorker(e,function(e){this.worker=e,t(this)}.bind(this))},setWorker:function(e,t){if(e instanceof Array){var r=e;e=r.shift()}var n=this._getUrl(e);n=i.normalize(n);var a,s=!i.hasSameOrigin(n,location.href);if(!1===n)return console.log("Can not resolve worker path"),!1;if(this.worker&&((a=this.worker).removeEventListener("message",this._acceptMessage,!1),a.removeEventListener("error",this._errorMessage,!1),a.terminate(),a=null),s){var u=this._getUrl("./mutableWorker",!0);try{this._getRemoteText(u,function(e){var r=l.createObjectURL(new o([e],{type:"text/javascript"}));t(this._createWorker(r,n))}.bind(this))}catch(e){try{u=i.getProxyUrl(u).path+"?"+encodeURI(u),this._useProxy=!0,t(this._createWorker(u,r))}catch(e){return console.log("Can not create worker"),!1}}}else t(this._createWorker(n,r))},_createWorker:function(e,t){var r=new Worker(e);return r.addEventListener("message",this._acceptMessage,!1),r.addEventListener("error",this._errorMessage,!1),this.worker=r,t&&this.importScripts(t),r},postMessage:function(e,t){(e instanceof Array||"object"!=typeof e)&&(e={data:e});var n=Math.floor(64e9*Math.random()).toString(36);e.msgId=n;var a=this._queue[n]=new r;return this.worker?(t?this.worker.postMessage(e,t):this.worker.postMessage(e),this.emit("start-message",{target:this,message:e})):a.reject({message:"No worker was set."}),a.promise},terminate:function(){var e=Object.keys(this._queue);this.worker&&this.worker.terminate();for(var t=e.length-1;t>=0;t--)this._queue[e[t]].cancel("terminated"),delete this._queue[e[t]]},addWorkerCallback:function(e,t){var n,a=this._getUrl(e,!0);return!1===a?((n=new r).reject({message:"Could not load text from "+e}),n.promise):this.postMessage({action:"add-callback",url:a,cbName:t||"main"}).then(function(e){e.target=this,this.emit("callback-added",e)}.bind(this))},importScripts:function(e){Array.isArray(e)||(e=[e]);var t=e.map(function(e){var t=this._getUrl(e,!0);return this._useProxy&&!i.hasSameOrigin(t,location.href)&&(t=i.getProxyUrl(t).path+"?"+encodeURI(t)),t},this);return this.postMessage({action:"import-script",url:t}).then(function(e){e.target=this,this.emit("scripts-imported",e)}.bind(this))},_acceptMessage:function(e){var t=e.data,r=t.msgId;if(t.status&&"debug"==t.status){var n=t.showAs||"debug";console[n](t)}else if(r&&r in this._queue){var a=this._queue[r];"progress"==t.status?a.progress(e.data):"error"==t.status?(a.reject(e.data),delete this._queue[r]):(a.resolve(e.data),delete this._queue[r])}this.emit("message",{message:e.data,event:e,target:this})},_errorMessage:function(e){this.onerror||this.onError?this.onerror?this.onerror(e):this.onError(e):console.log("Worker Error: "+e.message+"\nIn "+e.filename+" on "+e.lineno)},_getUrl:function(e,t){if(!e)return console.error("can not resolve empty path"),!1;e.match(/\.js$/)||(e+=".js");var r=s.toUrl(e);return t?i.makeAbsolute(r):r},_getRemoteText:function(e,t){(e=this._getUrl(e))&&n.get(e,{sync:!1,handleAs:"text",headers:{"X-Requested-With":"","Content-Type":"text/plain"}}).then(function(e){t(e)})},_startBlobWorker:function(){var e=this._xdSource;if(!e){var t=this._getUrl("./mutableWorker"),r=new o(["if(!self._mutable){importScripts('"+t+"');}"],{type:"text/javascript"});e=this._xdSource=l.createObjectURL(r)}try{return new Worker(e)}catch(e){return console.log(e.message),!1}}})}.apply(null,n))||(e.exports=a)},1786:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(2),r(1),r(9),r(0),r(99)],void 0===(a=function(e,t,r,n,a,i,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.handleAsTable=!1,r}return r(t,e),t.prototype._verifySource=function(){if(this._hasMemorySource()){if(this.url)throw new a("feature-layer:mixed-source-and-url","FeatureLayer cannot be created with both an in-memory source and a url")}else if(!this.url)throw new a("feature-layer:source-or-url-required","FeatureLayer requires either a url, a valid portal item or a source")},n([i.subclass("esri.arcade.featureset.polyfill.FeatureLayerAndTable")],t)}(i.declared(s))}.apply(null,n))||(e.exports=a)},1873:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){return function(){function e(){this._databaseTypeMetaData={},this._layerInfo={}}return e.prototype.clearDatabaseType=function(e){void 0===this._databaseTypeMetaData[e]&&delete this._databaseTypeMetaData[e]},e.prototype.getDatabaseType=function(e){return"MUSTBESET"===e?null:void 0===this._databaseTypeMetaData[e]?null:this._databaseTypeMetaData[e]},e.prototype.setDatabaseType=function(e,t){this._databaseTypeMetaData[e]=t},e.prototype.getLayerInfo=function(e){return void 0===this._layerInfo[e]?null:this._layerInfo[e]},e.prototype.setLayerInfo=function(e,t){this._layerInfo[e]=t},e.prototype.clearLayerInfo=function(e){void 0!==this._layerInfo[e]&&delete this._layerInfo[e]},e.applicationCache=null,e}()}.apply(null,n))||(e.exports=a)},1874:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58)],void 0===(a=function(e,t,r){return function(){function e(){this.declaredRootClass="esri.arcade.featureSetCollection",this._layerById={},this._layerByName={}}return e.prototype.add=function(e,t,r){this._layerById[t]=r,this._layerByName[e]=r},e.prototype.featureSetByName=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerByName[e]?this.resolvePromise(null):this.resolvePromise(this._layerByName[e])},e.prototype.featureSetById=function(e,t,r){return void 0===t&&(t=!0),void 0===r&&(r=["*"]),void 0===this._layerById[e]?this.resolvePromise(null):this.resolvePromise(this._layerById[e])},e.prototype.castToText=function(){return"object, FeatureSetCollection"},e.prototype.resolvePromise=function(e){var t=new r;return t.resolve(e),t.promise},e}()}.apply(null,n))||(e.exports=a)},1875:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(479)],void 0===(a=function(e,t,r,n){return function(){function e(e,t){this._lastId=-1,this._progress=t,this._parent=e}return e.prototype.reset=function(){this._lastId=-1},e.prototype.next=function(){var e=this,t=new r;return null!==this._parent._mainSetInUse?(this._parent._mainSetInUse.then(n.callback(function(r){e.next().then(n.callback(function(e){t.resolve(e)},t),n.errback(t))},t),function(r){e.next().then(n.callback(function(e){t.resolve(e)},t),n.errback(t))}),t.promise):(this._parent._mainSetInUse=t.promise,this._parent._getSet(this._progress).then(function(r){e._lastId<r._known.length-1?"GETPAGES"===r._known[e._lastId+1]?e._parent._expandPagedSet(r,e._parent._maxQueryRate(),0,0,e._progress).then(n.callback(function(r){e._parent._mainSetInUse=null,e.next().then(n.callback(function(e){t.resolve(e)},t),n.errback(t))},t),n.errback(t)):(e._lastId+=1,e._parent._getFeature(r,r._known[e._lastId],e._progress).then(n.callback(function(r){e._parent._mainSetInUse=null,t.resolve(r)},t),function(r){e._parent._mainSetInUse=null,t.reject(r)})):r._candidates.length>0?e._parent._refineSetBlock(r,e._parent._maxProcessingRate(),e._progress).then(n.callback(function(){e._parent._mainSetInUse=null,e.next().then(n.callback(function(e){t.resolve(e)},t),n.errback(t))},t),function(r){e._parent._mainSetInUse=null,t.reject(r)}):(e._parent._mainSetInUse=null,t.resolve(null))},function(r){e._parent._mainSetInUse=null,t.reject(r)}),t.promise)},e.prototype.count=function(){var e=this,t=new r;return-1!==this._parent._totalCount?t.resolve(this._parent._totalCount):this._parent._getSet(this._progress).then(n.callback(function(r){e._refineAllSets(r).then(n.callback(function(r){e._parent._totalCount=r._known.length,t.resolve(e._parent._totalCount)},t),n.errback(t))},t),n.errback(t)),t.promise},e.prototype._refineAllSets=function(e){var t=this,a=new r;return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?(this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,1,this._progress).then(n.callback(function(r){t._refineAllSets(e).then(n.callback(function(e){a.resolve(e)},a),n.errback(a))},a),n.errback(a)),a.promise):(e._candidates.length>0?"GETPAGES"===e._known[e._candidates.length-1]?this._parent._expandPagedSet(e,this._parent._maxQueryRate(),0,2,this._progress).then(n.callback(function(r){t._refineAllSets(e).then(n.callback(function(e){a.resolve(e)},a),n.errback(a))},a),n.errback(a)):this._parent._refineSetBlock(e,this._parent._maxProcessingRate(),this._progress).then(n.callback(function(e){e._candidates.length>0?t._refineAllSets(e).then(n.callback(function(e){a.resolve(e)},a),n.errback(a)):a.resolve(e)},a),n.errback(a)):a.resolve(e),a.promise)},e}()}.apply(null,n))||(e.exports=a)},1876:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(58),r(479)],void 0===(a=function(e,t,r,n){function a(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t/e.length}function i(e){for(var t=a(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/e.length}function s(e){for(var t=a(e),r=0,n=0;n<e.length;n++)r+=Math.pow(t-e[n],2);return r/(e.length-1)}function o(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t}function l(e,t,a,i){void 0===i&&(i=!1);var s=new r;try{(function e(t,a,i,s){var o=new r;return t.next().then(n.callback(function(r){null!==r?i.calculateValueDeferred(r).then(n.callback(function(r){null===r?!1===s&&(a[a.length]=r):a[a.length]=r,e(t,a,i,s).then(n.callback(function(e){o.resolve(e)},o),n.errback(o))},o),n.errback(o)):o.resolve(a)},o),n.errback(o)),o.promise})(e.iterator(a),[],t,i).then(n.callback(function(e){s.resolve(e)},s),n.errback(s))}catch(e){s.reject(e)}return s.promise}Object.defineProperty(t,"__esModule",{value:!0}),t.decodeStatType=function(e){switch(e.toLowerCase()){case"distinct":return"distinct";case"avg":case"mean":return"avg";case"min":return"min";case"sum":return"sum";case"max":return"max";case"stdev":case"stddev":return"stddev";case"var":case"variance":return"var";case"count":return"count"}return""},t.calculateStat=function(e,t,r){switch(void 0===r&&(r=1e3),e.toLowerCase()){case"distinct":return function(e,t){for(var r=[],a={},i=[],s=0;s<e.length;s++){if(void 0!==e[s]&&null!==e[s]){var o=e[s];if(n.isNumber(o)||n.isString(o))void 0===a[o]&&(r.push(o),a[o]=1);else{for(var l=!1,u=0;u<i.length;u++)!0===n.equalityTest(i[u],o)&&(l=!0);!1===l&&(i.push(o),r.push(o))}}if(r.length>=t&&-1!==t)return r}return r}(t,r);case"avg":case"mean":return a(t);case"min":return Math.min.apply(Math,t);case"sum":return o(t);case"max":return Math.max.apply(Math,t);case"stdev":case"stddev":return Math.sqrt(i(t));case"var":case"variance":return i(t);case"count":return t.length}return 0},t.min=function(e,t,a){var i=new r;return l(e,t,a,!0).then(n.callback(function(e){0===e.length?i.resolve(null):i.resolve(Math.min.apply(Math,e))},i),n.errback(i)),i.promise},t.max=function(e,t,a){var i=new r;return l(e,t,a,!0).then(n.callback(function(e){0===e.length?i.resolve(null):i.resolve(Math.max.apply(Math,e))},i),n.errback(i)),i.promise},t.mean=function(e,t,i){var s=new r,o="";return!1===t.isSingleField()&&(o=t.predictType(e.fields,null)),l(e,t,i,!0).then(n.callback(function(e){if(0===e.length)s.resolve(null);else{var t=a(e);null===t&&s.resolve(t),"integer"===o?s.resolve(function(e){return e=+e,isFinite(e)?e-e%1||(e<0?-0:0===e?e:0):e}(t)):s.resolve(t)}},s),n.errback(s)),s.promise},t.variance=function(e,t,a){var i=new r;return l(e,t,a,!0).then(n.callback(function(e){0===e.length?i.resolve(null):i.resolve(s(e))},i),n.errback(i)),i.promise},t.stdev=function(e,t,a){var i=new r;return l(e,t,a,!0).then(n.callback(function(e){0===e.length?i.resolve(null):i.resolve(Math.sqrt(s(e)))},i),n.errback(i)),i.promise},t.sum=function(e,t,a){var i=new r;return l(e,t,a,!0).then(n.callback(function(e){0===e.length?i.resolve(null):i.resolve(o(e))},i),n.errback(i)),i.promise},t.count=function(e,t){var a=new r;try{e.iterator(t).count().then(n.callback(function(e){a.resolve(e)},a),n.errback(a))}catch(e){a.reject(e)}return a.promise},t.distinct=function(e,t,a,i){void 0===a&&(a=1e3),void 0===i&&(i=null);var s=new r;return function(e,t,a,i){var s=new r;try{(function e(t,a,i,s,o){var l=new r;return t.next().then(n.callback(function(r){null!==r?s.calculateValueDeferred(r).then(n.callback(function(r){void 0!==r&&null!==r&&void 0===a[r]&&(i.push(r),a[r]=1),i.length>=o&&-1!==o?l.resolve(i):e(t,a,i,s,o).then(n.callback(function(e){l.resolve(i)},l),n.errback(l))},l),n.errback(l)):l.resolve(i)},l),n.errback(l)),l.promise})(e.iterator(i),{},[],t,a).then(n.callback(function(e){s.resolve(e)},s),n.errback(s))}catch(e){s.reject(e)}return s.promise}(e,t,a,i).then(n.callback(function(e){s.resolve(e)},s),n.errback(s)),s.promise}}.apply(null,n))||(e.exports=a)},1877:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(45),r(1648),r(1649),r(479),r(30),r(83),r(97),r(1786)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerMemory",r._removeGeometry=!1,r._overrideFields=null,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=new n),null!==this._layer&&(!0===this._layer.loaded?!1===this._loadPromise.isFulfilled()&&(this._initialiseFeatureSet(),this._loadPromise.resolve(this)):(this._layer.when(function(){try{e._initialiseFeatureSet(),e._loadPromise.resolve(e)}catch(t){e._loadPromise.reject(t)}},function(t){e._loadPromise.reject(t)}),this._layer.load())),this._loadPromise.promise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,!0===this._layer.handleAsTable&&(this.geometryType=""),this.fields=this._layer.fields.slice(0),1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(u=r[t]).type)e.push(u);else for(var n=0,a=this._layer.outFields;n<a.length;n++){if(a[n].toLowerCase()===u.name.toLowerCase()){e.push(u);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,l=this.fields;s<l.length;s++){var u;if("oid"===(u=l[s]).type)e.push(u),i.push(u.name);else for(var c=0,f=this._overrideFields;c<f.length;c++){if(f[c].toLowerCase()===u.name.toLowerCase()){e.push(u),i.push(u.name);break}}}this.fields=e,this._overrideFields=i}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this._databaseType=o.FeatureServiceDatabaseType.Standardised,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype.isTable=function(){return"table"===this._layer.type||!0===this._layer.handleAsTable||!this._layer.geometryType},t.prototype._isInFeatureSet=function(e){return o.IdState.InFeatureSet},t.prototype._transformSetWithIdChanges=function(e){},t.prototype._candidateIdTransform=function(e){return e},t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(o.callback(function(){t._getFilteredSet("",null,null,null,e).then(function(e){t._wset=e,r.resolve(e)},o.errback(r))},r),o.errback(r)):r.resolve(this._wset),r.promise},t.prototype._changeFeature=function(e){for(var t={},r=0,n=this.fields;r<n.length;r++){var i=n[r];t[i.name]=e.attributes[i.name]}return new a({geometry:!0===this._removeGeometry?null:e.geometry,attributes:t})},t.prototype._getFilteredSet=function(e,t,r,a,i){var l=this,u=new n,f="",h=!1;if(null!==a&&(f=a.constructClause(),h=!0),this.isTable()&&t&&null!==e&&""!==e){var p=new s([],[],!0,null);return u.resolve(p),u.promise}var d=new c;return d.where=null===r?null===t?"1=1":"":r.toWhereClause(o.FeatureServiceDatabaseType.Standardised),d.spatialRelationship=this._makeRelationshipEnum(e),d.outSpatialReference=this.spatialReference,d.orderByFields=""!==f?f.split(","):null,d.geometry=null===t?null:t,d.returnGeometry=!0,d.relationParameter=this._makeRelationshipParam(e),this._layer.queryFeatures(d).then(o.callback(function(e){if(null!==e){l._checkCancelled(i);var t=[];e.features.forEach(function(e){var r=e.attributes[l._layer.objectIdField];t.push(r),l._featureCache[r]=l._changeFeature(e)});var r=new s([],t,h,null);u.resolve(r)}else u.resolve(new s([],[],h,null))},u),o.errback(u)),u.promise},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._queryAllFeatures=function(){var e=this,t=new n;if(this._wset)return t.resolve(this._wset),t.promise;var r=new c;return r.where="1=1",this._ensureLoaded().then(o.callback(function(n){if(e._layer.source&&e._layer.source.items){var a=[];return e._layer.source.items.forEach(function(t){var r=t.attributes[e._layer.objectIdField];a.push(r),e._featureCache[r]=e._changeFeature(t)}),e._wset=new s([],a,!1,null),void t.resolve(e._wset)}e._layer.queryFeatures(r).then(o.callback(function(r){var n=[];r.features.forEach(function(t){var r=t.attributes[e._layer.objectIdField];n.push(r),e._featureCache[r]=e._changeFeature(t)}),e._wset=new s([],n,!1,null),t.resolve(e._wset)},t),o.errback(t))},t),o.errback(t)),t.promise},t.prototype._getFeatures=function(e,t,r,a){var i=new n,s=[];-1!==t&&void 0===this._featureCache[t]&&s.push(t);for(var o=e._lastFetchedIndex;o<e._known.length&&(e._lastFetchedIndex+=1,!(void 0===this._featureCache[e._known[o]]&&(e._known[o]!==t&&s.push(e._known[o]),s.length>r)));o++);return 0===s.length?i.resolve("success"):i.reject(new Error("Unaccounted for Features. Not in Feature Collection")),i.promise},t.prototype._refineSetBlock=function(e,t,r){var a=new n;return a.resolve(e),a.promise},t.prototype._stat=function(e,t,r,a,i,s,o){var l=new n;return l.resolve({calculated:!1}),l.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=new n;return s.resolve(!1),s.promise},t._cloneAttr=function(e){var t={};for(var r in e)t[r]=e[r];return t},t.create=function(e,r){var n=e.layerDefinition.objectIdField,a=e.layerDefinition.geometryType;void 0===a&&(a=e.featureSet.geometryType||"");var i=e.featureSet.features,s=r.toJSON();if(""===n||void 0===n){for(var o=!1,c=0,h=e.layerDefinition.fields;c<h.length;c++){if("oid"===(x=h[c]).type||"esriFieldTypeOID"===x.type){n=x.name,o=!0;break}}if(!1===o){for(var p="FID",d=!0,v=0;d;){for(var m=!0,g=0,y=e.layerDefinition.fields;g<y.length;g++){if((x=y[g]).name===p){m=!1;break}}!0===m?d=!1:p="FID"+(++v).toString()}e.layerDefinition.fields.push({type:"esriFieldTypeOID",name:p,alias:p});for(var _=[],w=0;w<i.length;w++)_.push({geometry:e.featureSet.features[w].geometry,attributes:e.featureSet.features[w].attributes?this._cloneAttr(e.featureSet.features[w].attributes):{}}),_[w].attributes[p]=w;i=_,n=p}}for(var b=[],S=0,k=e.layerDefinition.fields;S<k.length;S++){(x=k[S])instanceof u?b.push(x):b.push(u.fromJSON(x))}var F=a;switch(F){case"esriGeometryPoint":F="point";break;case"esriGeometryPolyline":F="polyline";break;case"esriGeometryPolygon":F="polygon";break;case"esriGeometryExtent":F="extent";break;case"esriGeometryMultipoint":F="multipoint"}for(var T=0,D=i;T<D.length;T++){var x;(x=D[T]).geometry&&x.geometry instanceof l==0&&(x.geometry.type=F,void 0===x.geometry.spatialReference&&(x.geometry.spatialReference=s))}var I={outFields:["*"],source:i,fields:b,objectIdField:n,spatialReference:r};I.geometryType=F||"point";var R=new f(I);return""===F&&(R.handleAsTable=!0),new t({layer:R,spatialReference:r})},t.prototype.canBeBigDataFeatureSet=function(){return!1},t.prototype.shouldBeResolvedAsBigData=function(){return!1},t}(i)}.apply(null,n))||(e.exports=a)},1878:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(1648),r(1649),r(1879),r(479)],void 0===(a=function(e,t,r,n,a,i,s,o){var l=function(e){function t(t){var r=e.call(this,t)||this;return r._orderbyclause=null,r.declaredClass="esri.arcade.featureset.actions.OrderBy",r._maxProcessing=100,r._orderbyclause=t.orderbyclause,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(o.callback(function(){t._getFilteredSet("",null,null,t._orderbyclause,e).then(o.callback(function(n){t._checkCancelled(e),t._wset=n,r.resolve(t._wset)},r),o.errback(r))},r),o.errback(r)):r.resolve(this._wset),r.promise},t.prototype.manualOrderSet=function(e,t){var r=this,a=new n;return this.getIdColumnDictionary(e,[],-1,t).then(o.callback(function(e){r._orderbyclause.order(e);for(var t=new i([],[],!0,null),n=0;n<e.length;n++)t._known.push(e[n].id);a.resolve(t)},a),o.errback(a)),a.promise},t.prototype.getIdColumnDictionary=function(e,t,r,a){var i=this,s=new n;if(r<e._known.length-1){var l=this._maxQueryRate();"GETPAGES"===e._known[r+1]?this._parent._expandPagedSet(e,l,0,0,a).then(o.callback(function(n){i.getIdColumnDictionary(e,t,r,a).then(o.callback(function(e){s.resolve(e)},s),o.errback(s))},s),o.errback(s)):this._parent._getFeature(e,e._known[r+1],a).then(o.callback(function(n){r+=1,i._checkCancelled(a),t.push({id:e._known[r],feature:n}),i.getIdColumnDictionary(e,t,r,a).then(o.callback(function(e){s.resolve(e)},s),o.errback(s))},s),o.errback(s))}else e._candidates.length>0?this._refineSetBlock(e,this._maxProcessingRate(),a).then(o.callback(function(){i._checkCancelled(a),i.getIdColumnDictionary(e,t,r,a).then(o.callback(function(e){s.resolve(e)},s),o.errback(s))},s),o.errback(s)):s.resolve(t);return s.promise},t.prototype._isInFeatureSet=function(e){return this._parent._isInFeatureSet(e)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){if(void 0===this._featureCache[e]){var t=this._parent._featureFromCache(e);if(void 0===t)return;return null===t?null:(this._featureCache[e]=t,t)}return this._featureCache[e]},t.prototype._fetchAndRefineFeatures=function(e,t,r){var a=new n;return a.reject(new Error("Fetch and Refine should not be called in this featureset")),a.promise},t.prototype._getFilteredSet=function(e,t,r,a,s){var l=this,u=new n;return this._ensureLoaded().then(o.callback(function(){l._parent._getFilteredSet(e,t,r,null===a?l._orderbyclause:a,s).then(o.callback(function(e){var n;l._checkCancelled(s),n=new i(e._candidates.slice(0),e._known.slice(0),e._ordered,l._clonePageDefinition(e.pagesDefinition));var a=!0;e._candidates.length>0&&(a=!1),!1===n._ordered?l.manualOrderSet(n,s).then(o.callback(function(e){!1===a&&(null===t&&null===r||(e=new i(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,l._clonePageDefinition(e.pagesDefinition)))),u.resolve(e)},u),o.errback(u)):u.resolve(n)},u),o.errback(u))},u),o.errback(u)),u.promise},t.prototype.arcadeScriptStep=function(e,t,r){var n=this.arcadeAssignNextScriptStepIdentifiers(r),a=this._orderbyclause.constructClause();return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("orderby( "+n.currentFeatureSet+',"'+a+'")')+";"},t}(a);return a._featuresetFunctions.orderBy=function(e){return""===e?this:new l({parentfeatureset:this,orderbyclause:new s(e)})},l}.apply(null,n))||(e.exports=a)},1879:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){return e===t?0:e<t?-1:1}return function(){function e(e){var t=e.split(",");this._fields=[],this._directions=[];for(var r=0;r<t.length;r++){var n=t[r].match(/\S+/g);this._fields.push(n[0]),2===n.length?"asc"===n[1].toLowerCase()?this._directions.push(1):this._directions.push(0):this._directions.push(1)}}return e.prototype.constructClause=function(){for(var e="",t=0;t<this._fields.length;t++)0!==t&&(e+=","),e+=this._fields[t],1===this._directions[t]?e+=" ASC":e+=" DESC";return e},e.prototype.order=function(e){var t=this;e.sort(function(e,n){for(var a=0;a<t._fields.length;a++){var i,s=t.featureValue(e.feature,t._fields[a],a),o=t.featureValue(n.feature,t._fields[a],a);if(0!==(i=1===t._directions[a]?r(s,o):-1*r(s,o)))return i}return 0})},e.prototype.scanForField=function(e){for(var t=0;t<this._fields.length;t++)if(this._fields[t].toLowerCase().trim()===e.toLowerCase().trim())return!0;return!1},e.prototype.featureValue=function(e,t,r){var n=e.attributes[t];if(void 0!==n)return n;for(var a in e.attributes)if(t.toLowerCase()===a.toLowerCase())return this._fields[r]=a,e.attributes[a];return null},e}()}.apply(null,n))||(e.exports=a)},1880:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(1648),r(1649),r(479)],void 0===(a=function(e,t,r,n,a,i,s){var o=function(e){function t(t){var r=e.call(this,t)||this;return r._topnum=0,r.declaredClass="esri.arcade.featureset.actions.Top",r._countedin=0,r._maxProcessing=100,r._topnum=t.topnum,r._parent=t.parentfeatureset,r}return r(t,e),t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(s.callback(function(){t._parent._getSet(e).then(s.callback(function(e){t._wset=new i(e._candidates.slice(0),e._known.slice(0),!1,t._clonePageDefinition(e.pagesDefinition)),t._setKnownLength(t._wset)>t._topnum&&(t._wset._known=t._wset._known.slice(0,t._topnum)),t._setKnownLength(t._wset)>=t._topnum&&(t._wset._candidates=[]),r.resolve(t._wset)},r),s.errback(r))},r),s.errback(r)):r.resolve(this._wset),r.promise},t.prototype._setKnownLength=function(e){return e._known.length>0&&"GETPAGES"===e._known[e._known.length-1]?e._known.length-1:e._known.length},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);if(t===s.IdState.NotInFeatureSet)return t;var r=this._idstates[e];return r===s.IdState.InFeatureSet||r===s.IdState.NotInFeatureSet?r:t===s.IdState.InFeatureSet&&void 0===r?this._countedin<this._topnum?(this._idstates[e]=s.IdState.InFeatureSet,this._countedin++,s.IdState.InFeatureSet):(this._idstates[e]=s.IdState.NotInFeatureSet,s.IdState.NotInFeatureSet):s.IdState.Unknown},t.prototype._expandPagedSet=function(e,t,r,a,i){var o=this,l=new n;if(null===this._parent){var u=new n;return u.reject(new Error("Parent Paging not implemented")),u.promise}if(t>this._topnum&&(t=this._topnum),this._countedin>=this._topnum&&e.pagesDefinition.internal.set.length<=e.pagesDefinition.resultOffset){var c=e._known.length;return c>0&&"GETPAGES"===e._known[c-1]&&(e._known.length=c-1),(c=e._candidates.length)>0&&"GETPAGES"===e._candidates[c-1]&&(e._candidates.length=c-1),l.resolve("success"),l.promise}return this._parent._expandPagedSet(e,t,r,a,i).then(s.callback(function(t){o._setKnownLength(e)>o._topnum&&(e._known.length=o._topnum),o._setKnownLength(e)>=o._topnum&&(e._candidates.length=0),l.resolve(t)},l),s.errback(l)),l.promise},t.prototype._getFeatures=function(e,t,r,a){var o=this,l=new n,u=[],c=this._maxQueryRate();if(!0===this._checkIfNeedToExpandKnownPage(e,c,a))return this._expandPagedSet(e,c,0,0,a).then(s.callback(function(n){o._getFeatures(e,t,r,a).then(s.callback(function(e){l.resolve(e)},l),s.errback(l))},l),s.errback(l)),l.promise;-1!==t&&void 0===this._featureCache[t]&&u.push(t);for(var f=0,h=e._lastFetchedIndex;h<e._known.length&&(++f<=r&&(e._lastFetchedIndex+=1),!(void 0===this._featureCache[e._known[h]]&&(e._known[h]!==t&&u.push(e._known[h]),u.length>c-1)));h++);if(0===u.length)l.resolve("success");else{var p=new i([],u,!1,null),d=Math.min(u.length,r);this._parent._getFeatures(p,-1,d,a).then(s.callback(function(e){for(var t=0;t<d;t++){var r=o._parent._featureFromCache(u[t]);void 0!==r&&(o._featureCache[u[t]]=r)}l.resolve("success")},l),s.errback(l))}return l.promise},t.prototype._getFilteredSet=function(e,t,r,a,o){var l=this,u=new n;return this._ensureLoaded().then(s.callback(function(){l._getSet(o).then(s.callback(function(e){var t=new i(e._candidates.slice(0).concat(e._known.slice(0)),[],!1,l._clonePageDefinition(e.pagesDefinition));u.resolve(t)},u),s.errback(u))},u),s.errback(u)),u.promise},t.prototype._refineKnowns=function(e,t){for(var r=0,n=null,a=[],i=0;i<e._candidates.length;i++){var o=this._isInFeatureSet(e._candidates[i]);if(o===s.IdState.InFeatureSet){if(e._known.push(e._candidates[i]),r+=1,null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),e._known.length>=this._topnum)break}else if(o===s.IdState.NotInFeatureSet)null===n?n={start:i,end:i}:n.end===i-1?n.end=i:(a.push(n),n={start:i,end:i}),r+=1;else if(o===s.IdState.Unknown)break;if(r>=t)break}null!==n&&a.push(n);for(var l=a.length-1;l>=0;l--)e._candidates.splice(a[l].start,a[l].end-a[l].start+1);this._setKnownLength(e)>this._topnum&&(e._known=e._known.slice(0,this._topnum)),this._setKnownLength(e)>=this._topnum&&(e._candidates=[])},t.prototype._stat=function(e,t,r,a,i,s,o){var l=new n;return l.resolve({calculated:!1}),l.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=new n;return s.resolve(!1),s.promise},t.prototype.arcadeScriptStep=function(e,t,r){var n=this.arcadeAssignNextScriptStepIdentifiers(r);return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("top( "+n.currentFeatureSet+","+this._topnum.toString()+")")+"; "},t}(a);return a._featuresetFunctions.top=function(e){return new o({parentfeatureset:this,topnum:e})},o}.apply(null,n))||(e.exports=a)},1881:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(498),r(1882),r(1648),r(1649),r(479),r(1693)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u){var c=function(e){function t(t){var r=e.call(this,t)||this;return r._relation="",r._relationGeom=null,r._relationString="",r.declaredClass="esri.arcade.featureset.actions.SpatialFilter",r._relationString=t.relationString,r._parent=t.parentfeatureset,r._maxProcessing=40,r._relation=t.relation,r._relationGeom=t.relationGeom,r}return r(t,e),t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(l.callback(function(){t._parent._getFilteredSet("esriSpatialRelRelation"!==t._relation?t._relation:t._relation+":"+t._relationString,t._relationGeom,null,null,e).then(l.callback(function(n){t._checkCancelled(e),t._wset=new o(n._candidates.slice(0),n._known.slice(0),n._ordered,t._clonePageDefinition(n.pagesDefinition)),r.resolve(t._wset)},r),l.errback(r))},r),l.errback(r)):r.resolve(this._wset),r.promise},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===l.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeSpatialRelationTest=function(e){if(null===e.geometry){var t=new n;return t.resolve(!1),t.promise}switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var r=l.shapeExtent(this._relationGeom),a=l.shapeExtent(e.geometry);return u.intersects(r,a);case"esriSpatialRelIntersects":return u.intersects(this._relationGeom,e.geometry);case"esriSpatialRelContains":return u.contains(this._relationGeom,e.geometry);case"esriSpatialRelOverlaps":return u.overlaps(this._relationGeom,e.geometry);case"esriSpatialRelWithin":return u.within(this._relationGeom,e.geometry);case"esriSpatialRelTouches":return u.touches(this._relationGeom,e.geometry);case"esriSpatialRelCrosses":return u.crosses(this._relationGeom,e.geometry);case"esriSpatialRelRelation":return u.relate(this._relationGeom,e.geometry,this._relationString)}},t.prototype._fetchAndRefineFeatures=function(e,t,r){var i=this,s=new n,u=new o([],e,!1,null),c=Math.min(t,e.length);return this._parent._getFeatures(u,-1,c,r).then(l.callback(function(){i._checkCancelled(r);for(var n=[],o=0;o<c;o++){var u=i._parent._featureFromCache(e[o]);n.push(i.executeSpatialRelationTest(u))}a(n).then(l.callback(function(r){for(var n=0;n<t;n++)!0===r[n]?i._idstates[e[n]]=l.IdState.InFeatureSet:i._idstates[e[n]]=l.IdState.NotInFeatureSet;s.resolve("success")},s),l.errback(s))},s),l.errback(s)),s.promise},t.prototype._getFilteredSet=function(e,t,r,a,i){var s=this,u=new n;return this._ensureLoaded().then(l.callback(function(){s._parent._getFilteredSet("esriSpatialRelRelation"!==s._relation?s._relation:s._relation+":"+s._relationString,s._relationGeom,r,a,i).then(l.callback(function(e){var r;s._checkCancelled(i),r=null!==t?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition)),u.resolve(r)},u),l.errback(u))},u),l.errback(u)),u.promise},t.prototype._stat=function(e,t,r,a,i,s,o){var u=this,c=new n;return""!==r?c.resolve({calculated:!1}):this._parent._stat(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,s,o).then(l.callback(function(n){!1===n.calculated?null===i&&""===r&&null===a?u._manualStat(e,t,s,o).then(l.callback(function(e){c.resolve(e)},c),l.errback(c)):c.resolve({calculated:!1}):c.resolve(n)},c),l.errback(c)),c.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=new n;return""!==r||null!==a?(s.resolve(!1),s.promise):null===this._parent?(s.resolve(!1),s.promise):this._parent._canDoAggregates(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i)},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,a,i,s,o){var l=new n;return null!==this._parent?this._parent._getAggregatePagesDataSourceDefinition(e,t,"esriSpatialRelRelation"!==this._relation?this._relation:this._relation+":"+this._relationString,this._relationGeom,i,s,o):(l.reject(new Error("Should never be called")),l.promise)},t.prototype.arcadeScriptStep=function(e,t,r){var n=this.arcadeAssignNextScriptStepIdentifiers(r);switch(this._relation){case"esriSpatialRelEnvelopeIntersects":var a=null===this._relationGeom?null:this._relationGeom.extent;return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("envelopeIntersects( "+n.currentFeatureSet+","+this.constructArcadeGeom(a,t,r)+")")+"; ";case"esriSpatialRelIntersects":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("intersects( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelContains":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("contains( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelOverlaps":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("overlaps( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelWithin":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("within( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelTouches":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("touches( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelCrosses":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("crosses( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+")")+"; ";case"esriSpatialRelRelation":return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("relate( "+n.currentFeatureSet+","+this.constructArcadeGeom(this._relationGeom,t,r)+', "'+this._relationString+'")')+";"}return"var "+n.newFeatureSet+" = null; "},t}(s);return s._featuresetFunctions.intersects=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelIntersects",relationGeom:e})},s._featuresetFunctions.envelopeIntersects=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelEnvelopeIntersects",relationGeom:e})},s._featuresetFunctions.contains=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelContains",relationGeom:e})},s._featuresetFunctions.overlaps=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelOverlaps",relationGeom:e})},s._featuresetFunctions.within=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelWithin",relationGeom:e})},s._featuresetFunctions.touches=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelTouches",relationGeom:e})},s._featuresetFunctions.crosses=function(e){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelCrosses",relationGeom:e})},s._featuresetFunctions.relate=function(e,t){return null===e||void 0===e?new i({parentfeatureset:this}):new c({parentfeatureset:this,relation:"esriSpatialRelRelation",relationGeom:e,relationString:t})},c}.apply(null,n))||(e.exports=a)},1882:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(1648),r(1649),r(479)],void 0===(a=function(e,t,r,n,a,i,s){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.layers.featureset.sources.Empty",r._maxProcessing=1e3,r._wset=new i([],[],!1,null),r._parent=t.parentfeatureset,r._databaseType=s.FeatureServiceDatabaseType.Standardised,r}return r(t,e),t.prototype._getSet=function(e){var t=new n;return t.resolve(this._wset),t.promise},t.prototype.optimisePagingFeatureQueries=function(e){},t.prototype._isInFeatureSet=function(e){return s.IdState.NotInFeatureSet},t.prototype._getFeature=function(e,t){var r=new n;return r.reject(new Error("No Feature Found in EmptySet")),r.promise},t.prototype._getFeatures=function(e,t,r,a){var i=new n;return i.resolve("success"),i.promise},t.prototype._featureFromCache=function(e){return null},t.prototype._fetchAndRefineFeatures=function(e,t,r){var a=new n;return a.reject(new Error("Fetch and Refine should not be called in this featureset")),a.promise},t.prototype._getFilteredSet=function(e,t,r,a,s){var o=new n,l=new i([],[],!1,null);return o.resolve(l),o.promise},t.prototype._stat=function(e,t,r,a,i,o,l){var u=new n;return this._manualStat(e,t,o,l).then(s.callback(function(e){u.resolve(e)},u),s.errback(u)),u.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=new n;return s.resolve(!1),s.promise},t.prototype.canBeBigDataFeatureSet=function(){return!1},t.prototype.shouldBeResolvedAsBigData=function(){return!1},t}(a)}.apply(null,n))||(e.exports=a)},1883:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(498),r(111),r(1648),r(1649),r(479),r(1771)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u){var c=function(e){function t(t){var r=e.call(this,t)||this;if(r.declaredClass="esri.arcade.featureset.actions.AttributeFilter",r._maxProcessing=1e3,r._parent=t.parentfeatureset,t.whereclause instanceof u){r._whereclause=t.whereclause,r._whereClauseFunction=null;var n=r._whereclause.getFunctions();r._whereclauseDoesGeometry=!1,n.indexOf("area")>=0?r._whereclauseDoesGeometry=!0:n.indexOf("length")>=0&&(r._whereclauseDoesGeometry=!0)}else r._whereClauseFunction=t.whereclause,r._whereclause=null;return r}return r(t,e),t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(l.callback(function(){t._parent._getFilteredSet("",null,!1===t._whereclauseDoesGeometry?t._whereclause:null,null,e).then(l.callback(function(n){t._checkCancelled(e),!0===t._whereclauseDoesGeometry||null!==t._whereClauseFunction?t._wset=new o(n._candidates.slice(0).concat(n._known.slice(0)),[],n._ordered,t._clonePageDefinition(n.pagesDefinition)):t._wset=new o(n._candidates.slice(0),n._known.slice(0),n._ordered,t._clonePageDefinition(n.pagesDefinition)),r.resolve(t._wset)},r),l.errback(r))},r),l.errback(r)):r.resolve(this._wset),r.promise},t.prototype._isInFeatureSet=function(e){var t=this._parent._isInFeatureSet(e);return t===l.IdState.NotInFeatureSet?t:void 0===(t=this._idstates[e])?l.IdState.Unknown:t},t.prototype._getFeature=function(e,t,r){return this._parent._getFeature(e,t,r)},t.prototype._getFeatures=function(e,t,r,n){return this._parent._getFeatures(e,t,r,n)},t.prototype._featureFromCache=function(e){return this._parent._featureFromCache(e)},t.prototype.executeWhereClause=function(e){return this._whereclause.testFeature(e)},t.prototype.executeWhereClauseDeferred=function(e){if(null!==this._whereClauseFunction){var t=new n;try{var r=this._whereClauseFunction(e);r instanceof i?r.then(l.callback(function(e){t.resolve(e)},t),l.errback(t)):t.resolve(r)}catch(e){t.reject(e)}return t.promise}return this._whereclause.testFeatureDeferred(e)},t.prototype._fetchAndRefineFeatures=function(e,t,r){var i=this,s=new n,u=new o([],e,!1,null),c=Math.min(t,e.length);return this._parent._getFeatures(u,-1,c,r).then(l.callback(function(){if(i._checkCancelled(r),!1===i._whereclauseDoesGeometry&&null==i._whereClauseFunction){for(var n=0;n<c;n++){var o=i._parent._featureFromCache(e[n]);!0===i.executeWhereClause(o)?i._idstates[e[n]]=l.IdState.InFeatureSet:i._idstates[e[n]]=l.IdState.NotInFeatureSet}s.resolve("success")}else{var u=[];for(n=0;n<c;n++){o=i._parent._featureFromCache(e[n]);u.push(i.executeWhereClauseDeferred(o))}a(u).then(l.callback(function(r){for(var n=0;n<t;n++)!0===r[n]?i._idstates[e[n]]=l.IdState.InFeatureSet:i._idstates[e[n]]=l.IdState.NotInFeatureSet;s.resolve("success")},s),l.errback(s))}},s),l.errback(s)),s.promise},t.prototype._getFilteredSet=function(e,t,r,a,i){var s=this,c=new n;return!0===this._whereclauseDoesGeometry||null!==this._whereClauseFunction||(null!==r?null!==this._whereclause&&(r=u.combine(this._whereclause,r)):r=this._whereclause),this._ensureLoaded().then(l.callback(function(){s._parent._getFilteredSet(e,t,r,a,i).then(l.callback(function(e){var t;s._checkCancelled(i),t=!0===s._whereclauseDoesGeometry||null!==s._whereClauseFunction?new o(e._candidates.slice(0).concat(e._known.slice(0)),[],e._ordered,s._clonePageDefinition(e.pagesDefinition)):new o(e._candidates.slice(0),e._known.slice(0),e._ordered,s._clonePageDefinition(e.pagesDefinition)),c.resolve(t)},c),l.errback(c))},c),l.errback(c)),c.promise},t.prototype._stat=function(e,t,r,a,i,s,o){var c=this,f=new n;if(!0===this._whereclauseDoesGeometry||null!==this._whereClauseFunction)return null===i&&""===r&&null===a?this._manualStat(e,t,s,o).then(l.callback(function(e){f.resolve(e)},f),l.errback(f)):f.resolve({calculated:!1}),f.promise;var h=this._whereclause;return null!==i&&null!==this._whereclause&&(h=u.combine(this._whereclause,i)),this._parent._stat(e,t,r,a,h,s,o).then(l.callback(function(n){!1===n.calculated?null===i&&""===r&&null===a?c._manualStat(e,t,s,o).then(l.callback(function(e){f.resolve(e)},f),l.errback(f)):f.resolve({calculated:!1}):f.resolve(n)},f),l.errback(f)),f.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=new n;return!0===this._whereclauseDoesGeometry||null!==this._whereClauseFunction?(s.resolve(!1),s.promise):(null!==i?null!==this._whereclause&&(i=u.combine(this._whereclause,i)):i=this._whereclause,null===this._parent?(s.resolve(!1),s.promise):this._parent._canDoAggregates(e,t,r,a,i))},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,a,i,s,o){var l=new n;return null!==this._parent?(null!==i?null!==this._whereclause&&(i=u.combine(this._whereclause,i)):i=this._whereclause,this._parent._getAggregatePagesDataSourceDefinition(e,t,r,a,i,s,o)):(l.reject(new Error("Should never be called")),l.promise)},t.prototype.arcadeScriptStep=function(e,t,r){var n=this.arcadeAssignNextScriptStepIdentifiers(r),a=this._whereclause.toWhereClause(l.FeatureServiceDatabaseType.Standardised);return"var "+n.newFeatureSet+" = "+this.bigDataCachePipeline("filter( "+n.currentFeatureSet+',"'+a+'")')+";"},t}(s);return s._featuresetFunctions.filter=function(e,t){if(void 0===t&&(t=null),"function"==typeof e)return new c({parentfeatureset:this,whereclause:e});if(""===e)return this;var r=u.create(e);if(null!==t){var n={};for(var a in t)n[a.toLowerCase()]=t[a];r.setVariablesDictionary(n)}return new c({parentfeatureset:this,whereclause:r})},c}.apply(null,n))||(e.exports=a)},1940:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(45),r(1648),r(1649),r(479),r(1876),r(1941),r(126),r(511),r(481),r(97),r(256),r(488),r(1786)],void 0===(a=function(e,t,r,n,a,i,s,o,l,u,c,f,h,p,d,v,m){return function(e){function t(t){var r=e.call(this,t)||this;return r.declaredClass="esri.arcade.featureset.sources.FeatureLayerDynamic",r._removeGeometry=!1,r._overrideFields=null,r.formulaCredential=null,r._pageJustIds=!1,r._requestStandardised=!1,t.spatialReference&&(r.spatialReference=t.spatialReference),r._transparent=!0,r._maxProcessing=1e3,r._layer=t.layer,r._wset=null,void 0!==t.outFields&&(r._overrideFields=t.outFields),void 0!==t.includeGeometry&&(r._removeGeometry=!1===t.includeGeometry),r}return r(t,e),t.prototype._maxQueryRate=function(){return o.defaultMaxRecords},t.prototype.end=function(){return this._layer},t.prototype.optimisePagingFeatureQueries=function(e){this._pageJustIds=e},t.prototype.convertQueryToLruCacheKey=function(e){var t=o.stableStringify(e.toJSON());return new u(t,"TEXT").getHash("SHA-1","B64")},t.prototype.load=function(){var e=this;return null===this._loadPromise&&(this._loadPromise=new n),null!==this._layer&&(!0===this._layer.loaded?!1===this._loadPromise.isFulfilled()&&(this._initialiseFeatureSet(),this._loadPromise.resolve(this)):(this._layer.when(function(){try{e._initialiseFeatureSet(),e._loadPromise.resolve(e)}catch(t){e._loadPromise.reject(t)}},function(t){e._loadPromise.reject(t)}),this._layer.load())),this._loadPromise.promise},t.prototype._initialiseFeatureSet=function(){if(null==this.spatialReference&&(this.spatialReference=this._layer.spatialReference),this.geometryType=this._layer.geometryType,this.fields=this._layer.fields.slice(0),1===this._layer.outFields.length&&"*"===this._layer.outFields[0]);else{for(var e=[],t=0,r=this.fields;t<r.length;t++){if("oid"===(u=r[t]).type)e.push(u);else for(var n=0,a=this._layer.outFields;n<a.length;n++){if(a[n].toLowerCase()===u.name.toLowerCase()){e.push(u);break}}}this.fields=e}if(null!==this._overrideFields)if(1===this._overrideFields.length&&"*"===this._overrideFields[0])this._overrideFields=null;else{e=[];for(var i=[],s=0,l=this.fields;s<l.length;s++){var u;if("oid"===(u=l[s]).type)e.push(u),i.push(u.name);else for(var c=0,f=this._overrideFields;c<f.length;c++){if(f[c].toLowerCase()===u.name.toLowerCase()){e.push(u),i.push(u.name);break}}}this.fields=e,this._overrideFields=i}if(this._layer.source&&this._layer.source.layerDefinition)if(!0===this._layer.source.layerDefinition.useStandardizedQueries)this._databaseType=o.FeatureServiceDatabaseType.Standardised;else{var h=this._layer.source.layerDefinition.currentVersion;void 0!==h&&null!==h&&h>=10.5&&(this._databaseType=o.FeatureServiceDatabaseType.Standardised,this._requestStandardised=!0)}this.objectIdField=this._layer.objectIdField,this.hasM=this._layer.supportsM,this.hasZ=this._layer.supportsZ,this.typeIdField=this._layer.typeIdField,this.types=this._layer.types},t.prototype._isInFeatureSet=function(){return o.IdState.InFeatureSet},t.prototype._refineSetBlock=function(e){var t=new n;return t.resolve(e),t.promise},t.prototype._candidateIdTransform=function(e){return e},t.prototype._transformSetWithIdChanges=function(){},t.prototype._getSet=function(e){var t=this,r=new n;return null===this._wset?this._ensureLoaded().then(o.callback(function(){t._getFilteredSet("",null,null,null,e).then(o.callback(function(e){t._wset=e,r.resolve(e)},r),o.errback(r))},r),o.errback(r)):r.resolve(this._wset),r.promise},t.prototype._runDatabaseProbe=function(e){var t=this,r=new n;return this._ensureLoaded().then(o.callback(function(){var n=new p;n.where=e.replace("OBJECTID",t._layer.objectIdField),t._layer.queryObjectIds(n).then(o.callback(function(){r.resolve(!0)},r),function(e){try{r.resolve(!1)}catch(e){r.reject(e)}})},r),o.errback(r)),r.promise},t.prototype._canUsePagination=function(){return!(!this._layer.capabilities||!this._layer.capabilities.query||!0!==this._layer.capabilities.query.supportsPagination)},t.prototype._cacheableFeatureSetSourceKey=function(){return this._layer.url},t.prototype.pbfSupportedForQuery=function(e){return!e.outStatistics&&this._layer&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsFormatPBF},t.prototype.queryPBF=function(e,t){return e.quantizationParameters={mode:"edit"},f.executeQueryPBF(this._layer.parsedUrl,e,{type:"optimized"}).then(function(e){return c.fromJSON(v.convertToFeatureSet(e.data))})},t.prototype.executeQuery=function(e,t){var r=new h({url:this._layer.parsedUrl.path}),n="execute"===t&&this.pbfSupportedForQuery(e),a=null;if(this.recentlyUsedQueries){var i=this.convertQueryToLruCacheKey(e);(a=this.recentlyUsedQueries.getFromCache(i))&&a.isRejected()&&(a=null,this.recentlyUsedQueries.removeFromCache(i)),null===a&&(a=!0!==n?r[t](e):this.queryPBF(e,r),this.recentlyUsedQueries.addToCache(i,a))}return null===a&&(a=!0!==n?r[t](e):this.queryPBF(e,r)),a},t.prototype._getFilteredSet=function(e,t,r,a,i){var l=this,u=new n;return this.databaseType().then(o.callback(function(n){if(l.isTable()&&t&&null!==e&&""!==e){var c=new s([],[],!0,null);u.resolve(c)}else if(l._canUsePagination())l._getFilteredSetUsingPaging(e,t,r,a,i).then(o.callback(function(e){u.resolve(e)},u),o.errback(u));else{var f="",h=!1;null!==a&&l._layer.capabilities&&l._layer.capabilities.query&&!0===l._layer.capabilities.query.supportsOrderBy&&(f=a.constructClause(),h=!0);var d=new p;d.where=null===r?null===t?"1=1":"":r.toWhereClause(n),l._requestStandardised&&(d.sqlFormat="standard"),d.spatialRelationship=l._makeRelationshipEnum(e),d.outSpatialReference=l.spatialReference,d.orderByFields=""!==f?f.split(","):null,d.geometry=null===t?null:t,d.relationParameter=l._makeRelationshipParam(e),l.executeQuery(d,"executeForIds").then(o.callback(function(e){null===e&&(e=[]),l._checkCancelled(i);var t=new s([],e,h,null);u.resolve(t)},u),o.errback(u))}},u),o.errback(u)),u.promise},t.prototype._expandPagedSet=function(e,t,r,n,a){return this._expandPagedSetFeatureSet(e,t,r,n,a)},t.prototype._getFilteredSetUsingPaging=function(e,t,r,a,i){var l=this,u=new n;try{var c="",f=!1;null!==a&&this._layer.capabilities&&this._layer.capabilities.query&&!0===this._layer.capabilities.query.supportsOrderBy&&(c=a.constructClause(),f=!0),this.databaseType().then(o.callback(function(n){var a=null===r?null===t?"1=1":"":r.toWhereClause(n);l._layer.definitionExpression&&(a=""!==a?"(("+l._layer.definitionExpression+") AND ("+a+"))":l._layer.definitionExpression);var h=l._maxQueryRate();void 0!==l._layer.maxRecordCount&&l._layer.maxRecordCount<h&&(h=l._layer.maxRecordCount);var p=null;if(!0===l._pageJustIds)p=new s([],["GETPAGES"],f,{spatialRel:l._makeRelationshipEnum(e),relationParam:l._makeRelationshipParam(e),outFields:l._layer.objectIdField,resultRecordCount:h,resultOffset:0,geometry:null===t?null:t,where:a,orderByFields:c,returnGeometry:!1,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}});else{var d=!0;!0===l._removeGeometry&&(d=!1);var v=null!==l._overrideFields?l._overrideFields:l._fieldsIncludingObjectId(l._layer.outFields);p=new s([],["GETPAGES"],f,{spatialRel:l._makeRelationshipEnum(e),relationParam:l._makeRelationshipParam(e),outFields:v.join(","),resultRecordCount:h,resultOffset:0,geometry:null===t?null:t,where:a,orderByFields:c,returnGeometry:d,returnIdsOnly:"false",internal:{set:[],lastRetrieved:0,fullyResolved:!1}})}l._expandPagedSet(p,h,0,1,i).then(o.callback(function(){u.resolve(p)},u),o.errback(u))},u),o.errback(u))}catch(e){u.reject(e)}return u.promise},t.prototype._clonePageDefinition=function(e){return null===e?null:!0!==e.groupbypage?{groupbypage:!1,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,resultOffset:e.resultOffset,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}:{groupbypage:!0,spatialRel:e.spatialRel,relationParam:e.relationParam,outFields:e.outFields,resultRecordCount:e.resultRecordCount,useOIDpagination:e.useOIDpagination,generatedOid:e.generatedOid,groupByFieldsForStatistics:e.groupByFieldsForStatistics,resultOffset:e.resultOffset,outStatistics:e.outStatistics,geometry:e.geometry,where:e.where,orderByFields:e.orderByFields,returnGeometry:e.returnGeometry,returnIdsOnly:e.returnIdsOnly,internal:e.internal}},t.prototype._getPhysicalPage=function(e,t,r){var a=this,i=new n;try{var s=e.pagesDefinition.internal.lastRetrieved,l=s,u=new p;this._requestStandardised&&(u.sqlFormat="standard"),u.spatialRelationship=e.pagesDefinition.spatialRel,u.relationParameter=e.pagesDefinition.relationParam,u.outFields=e.pagesDefinition.outFields.split(","),u.num=e.pagesDefinition.resultRecordCount,u.start=e.pagesDefinition.internal.lastRetrieved,u.geometry=e.pagesDefinition.geometry,u.where=e.pagesDefinition.where,u.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,u.returnGeometry=e.pagesDefinition.returnGeometry,u.outSpatialReference=this.spatialReference,this.executeQuery(u,"execute").then(o.callback(function(t){a._checkCancelled(r),e.pagesDefinition.internal.lastRetrieved!==s&&i.resolve("done");for(var n=0;n<t.features.length;n++)e.pagesDefinition.internal.set[l+n]=t.features[n].attributes[a._layer.objectIdField];if(!1===a._pageJustIds)for(n=0;n<t.features.length;n++)a._featureCache[t.features[n].attributes[a._layer.objectIdField]]=t.features[n];t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=s+e.pagesDefinition.resultRecordCount,i.resolve("done")},i),o.errback(i))}catch(e){i.reject(e)}return i.promise},t.prototype._fieldsIncludingObjectId=function(e){if(null===e)return[this.objectIdField];var t=e.slice(0);if(t.indexOf("*")>-1)return t;for(var r=!1,n=0,a=t;n<a.length;n++)if(a[n].toUpperCase()===this.objectIdField.toUpperCase()){r=!0;break}return!1===r&&t.push(this.objectIdField),t},t.prototype._getFeatures=function(e,t,r,a){var i=this,s=new n,l=[];try{if(-1!==t&&void 0===this._featureCache[t]&&l.push(t),!0===this._checkIfNeedToExpandKnownPage(e,this._maxProcessingRate(),a))return this._expandPagedSet(e,this._maxProcessingRate(),0,0,a).then(o.callback(function(){i._getFeatures(e,t,r,a).then(o.callback(function(e){s.resolve(e)},s),o.errback(s))},s),o.errback(s)),s.promise;for(var u=0,c=e._lastFetchedIndex;c<e._known.length;c++){if(e._lastFetchedIndex+=1,u++,void 0===this._featureCache[e._known[c]]){var f=!1;if(null!==this._layer._mode&&void 0!==this._layer._mode){var h=this._layer._mode;if(void 0!==h._featureMap[e._known[c]]){var d=h._featureMap[e._known[c]];null!==d&&(f=!0,this._featureCache[e._known[c]]=d)}}if(!1===f&&(e._known[c]!==t&&l.push(e._known[c]),l.length>=this._maxProcessingRate()-1))break}if(u>=r&&0===l.length)break}if(0===l.length)s.resolve("success");else try{var v=new p;this._requestStandardised&&(v.sqlFormat="standard"),v.objectIds=l,v.outFields=null!==this._overrideFields?this._overrideFields:this._fieldsIncludingObjectId(this._layer.outFields),v.returnGeometry=!0,!0===this._removeGeometry&&(v.returnGeometry=!1),v.outSpatialReference=this.spatialReference,this.executeQuery(v,"execute").then(o.callback(function(e){if(i._checkCancelled(a),void 0===e.error){for(var t=0;t<e.features.length;t++)i._featureCache[e.features[t].attributes[i._layer.objectIdField]]=e.features[t];s.resolve("success")}else s.reject(new Error(e.error))},s),o.errback(s))}catch(e){s.reject(e)}}catch(e){s.reject(e)}return s.promise},t.prototype._getDistinctPages=function(e,t,r,a,i,s,l,u,c){var f=this,h=new n;return this._ensureLoaded().then(o.callback(function(){for(var n=r.parseTree.column,d=0;d<f._layer.fields.length;d++)if(f._layer.fields[d].name.toLowerCase()===n.toLowerCase()){n=f._layer.fields[d].name;break}f.databaseType().then(o.callback(function(d){var v=new p;f._requestStandardised&&(v.sqlFormat="standard");var m=null===s?null===i?"1=1":"":s.toWhereClause(d);f._layer.definitionExpression&&(m=""!==m?"(("+f._layer.definitionExpression+") AND ("+m+"))":f._layer.definitionExpression),v.where=m,v.spatialRelationship=f._makeRelationshipEnum(a),v.relationParameter=f._makeRelationshipParam(a),v.geometry=null===i?null:i,v.returnDistinctValues=!0,v.returnGeometry=!1,v.outFields=[n],f.executeQuery(v,"execute").then(o.callback(function(p){if(f._checkCancelled(c),p.hasOwnProperty("features")){for(var d=!1,v=0;v<f._layer.fields.length;v++)if(f._layer.fields[v].name===n){"date"===f._layer.fields[v].type&&(d=!0);break}for(v=0;v<p.features.length;v++){if(d){var m=p.features[v].attributes[n];null!==m?u.push(new Date(m)):u.push(m)}else u.push(p.features[v].attributes[n]);if(u.length>=l)break}0===p.features.length?h.resolve(u):p.features.length===f._layer.maxRecordCount&&u.length<l?f._getDistinctPages(e+p.features.length,t,r,a,i,s,l,u,c).then(o.callback(function(e){h.resolve({calculated:!0,result:e})},h),o.errback(h)):h.resolve(u)}else h.reject(new Error("Unnexected Result querying statistics from layer"))},h),o.errback(h))},h),o.errback(h))},h),o.errback(h)),h.promise},t.prototype._distinctStat=function(e,t,r,n,a,i,s,l){this._getDistinctPages(0,t,r,n,a,i,s,[],l).then(o.callback(function(t){e.resolve({calculated:!0,result:t})},e),o.errback(e))},t.prototype.isTable=function(){return null===this._layer.geometryType||"table"===this._layer.type||""===this._layer.geometryType},t.prototype._countstat=function(e,t,r,n,a,i){var s=this;this.databaseType().then(o.callback(function(t){var i=new p;if(s._requestStandardised&&(i.sqlFormat="standard"),s.isTable()&&n&&null!==r&&""!==r)e.resolve({calculated:!0,result:0});else{var l=null===a?null===n?"1=1":"":a.toWhereClause(t);s._layer.definitionExpression&&(l=""!==l?"(("+s._layer.definitionExpression+") AND ("+l+"))":s._layer.definitionExpression),i.where=l,i.where=l,i.spatialRelationship=s._makeRelationshipEnum(r),i.relationParameter=s._makeRelationshipParam(r),i.geometry=null===n?null:n,i.returnGeometry=!1,s.executeQuery(i,"executeForCount").then(o.callback(function(t){e.resolve({calculated:!0,result:t})},e),o.errback(e))}},e),o.errback(e))},t.prototype._stats=function(e,t,r,n,a,i,s,u){var c=this;this._ensureLoaded().then(o.callback(function(){var f=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsSqlExpression,h=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsStatistics,v=c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsDistinct;"count"===t?v?c._countstat(e,t,n,a,i,u):e.resolve({calculated:!1}):!1===h||!1===r.isSingleField()&&!1===f||!1===r.isStandardized()?""!==n||null!==i?e.resolve({calculated:!1}):c._manualStat(t,r,s,u).then(o.callback(function(t){e.resolve(t)},e),o.errback(e)):"distinct"===t?!1===v?""!==n||null!==i?e.resolve({calculated:!1}):c._manualStat(t,r,s,u).then(o.callback(function(t){e.resolve(t)},e),o.errback(e)):c._distinctStat(e,t,r,n,a,i,s,u):c.databaseType().then(o.callback(function(s){if(c.isTable()&&a&&null!==n&&""!==n)e.resolve({calculated:!0,result:null});else{var u=new p;c._requestStandardised&&(u.sqlFormat="standard");var f=null===i?null===a?"1=1":"":i.toWhereClause(s);c._layer.definitionExpression&&(f=""!==f?"(("+c._layer.definitionExpression+") AND ("+f+"))":c._layer.definitionExpression),u.where=f,u.spatialRelationship=c._makeRelationshipEnum(n),u.relationParameter=c._makeRelationshipParam(n),u.geometry=null===a?null:a;var h=new d;h.statisticType=l.decodeStatType(t),h.onStatisticField=r.toWhereClause(s),h.outStatisticFieldName="FORMULA_STAT_RESULT",u.returnGeometry=!1,u.outStatistics=[h],c.executeQuery(u,"execute").then(o.callback(function(t){if(t.hasOwnProperty("features")&&0!==t.features.length){for(var r=!1,n=0;n<t.fields.length;n++)if("FORMULA_STAT_RESULT"===t.fields[n].name.toUpperCase()){"esriFieldTypeDate"===t.fields[n].type&&(r=!0);break}if(r){var a=t.features[0].attributes.FORMULA_STAT_RESULT;null!==a&&(a=new Date(t.features[0].attributes.FORMULA_STAT_RESULT)),e.resolve({calculated:!0,result:a})}else e.resolve({calculated:!0,result:t.features[0].attributes.FORMULA_STAT_RESULT})}else e.reject(new Error("Unnexected Result querying statistics from layer"))},e),o.errback(e))}},e),o.errback(e))},e),o.errback(e))},t.prototype._stat=function(e,t,r,a,i,s,o){var l=new n;try{this._stats(l,e,t,r,a,i,s,o)}catch(e){l.reject(e)}return l.promise},t.prototype._canDoAggregates=function(e,t,r,a,i){var s=this,l=new n;return this._ensureLoaded().then(o.callback(function(){var e=!1,r=s._layer.capabilities&&s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsSqlExpression;if(void 0!==s._layer.capabilities&&null!==s._layer.capabilities.query&&!0===s._layer.capabilities.query.supportsStatistics&&!0===s._layer.capabilities.query.supportsOrderBy&&(e=!0),e)for(var n=0;n<t.length-1;n++)null!==t[n].workingexpr&&(!1===t[n].workingexpr.isStandardized()?e=!1:!1===t[n].workingexpr.isSingleField()&&!1===r&&(e=!1));!1===e?l.resolve(!1):l.resolve(!0)},l),o.errback(l)),l.promise},t.prototype._makeRelationshipEnum=function(e){if(e.indexOf("esriSpatialRelRelation")>=0)return"relation";switch(e){case"esriSpatialRelRelation":return"relation";case"esriSpatialRelIntersects":return"intersects";case"esriSpatialRelContains":return"contains";case"esriSpatialRelOverlaps":return"overlaps";case"esriSpatialRelWithin":return"within";case"esriSpatialRelTouches":return"touches";case"esriSpatialRelCrosses":return"crosses";case"esriSpatialRelEnvelopeIntersects":return"envelope-intersects"}return e},t.prototype._makeRelationshipParam=function(e){return e.indexOf("esriSpatialRelRelation")>=0?e.split(":")[1]:""},t.prototype._getAggregatePagesDataSourceDefinition=function(e,t,r,a,i,l,u){var c=this,f=new n;return this._ensureLoaded().then(o.callback(function(){c.databaseType().then(o.callback(function(n){var o="",h=!1,p=!1;null!==l&&c._layer.capabilities&&c._layer.capabilities.query&&!0===c._layer.capabilities.query.supportsOrderBy&&(o=l.constructClause(),p=!0),c._layer.capabilities&&c._layer.capabilities.query&&!1===c._layer.capabilities.query.supportsPagination&&(p=!1,h=!0,o=c._layer.objectIdField);for(var v=[],m=0;m<t.length;m++){var g=new d;g.onStatisticField=null!==t[m].workingexpr?t[m].workingexpr.toWhereClause(n):"",g.outStatisticFieldName=t[m].field,g.statisticType=t[m].toStatisticsName(),v.push(g)}""===o&&(o=e.join(","));var y=c._maxQueryRate();void 0!==c._layer.maxRecordCount&&c._layer.maxRecordCount<y&&(y=c._layer.maxRecordCount);var _=null===i?null===a?"1=1":"":i.toWhereClause(n);c._layer.definitionExpression&&(_=""!==_?"(("+c._layer.definitionExpression+") AND ("+_+"))":c._layer.definitionExpression);var w=new s([],["GETPAGES"],p,{groupbypage:!0,spatialRel:c._makeRelationshipEnum(r),relationParam:c._makeRelationshipParam(r),outFields:["*"],useOIDpagination:h,generatedOid:u,resultRecordCount:y,resultOffset:0,groupByFieldsForStatistics:e,outStatistics:v,geometry:null===a?null:a,where:_,orderByFields:o,returnGeometry:!1,returnIdsOnly:!1,internal:{lastMaxId:-1,set:[],lastRetrieved:0,fullyResolved:!1}});f.resolve(w)},f),o.errback(f))},f),o.errback(f)),f.promise},t.prototype._getAgregagtePhysicalPage=function(e,t,r){var i=this,s=new n;try{var l=e.pagesDefinition.where;!0===e.pagesDefinition.useOIDpagination&&(l=""!==l?"("+l+") AND ("+e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString()+")":e.pagesDefinition.generatedOid+">"+e.pagesDefinition.internal.lastMaxId.toString());var u=e.pagesDefinition.internal.lastRetrieved,c=u,f=new p;if(this._requestStandardised&&(f.sqlFormat="standard"),f.where=l,f.spatialRelationship=e.pagesDefinition.spatialRel,f.relationParameter=e.pagesDefinition.relationParam,f.outFields=e.pagesDefinition.outFields,f.outStatistics=e.pagesDefinition.outStatistics,f.geometry=e.pagesDefinition.geometry,f.groupByFieldsForStatistics=e.pagesDefinition.groupByFieldsForStatistics,f.num=e.pagesDefinition.resultRecordCount,f.start=e.pagesDefinition.internal.lastRetrieved,f.returnGeometry=e.pagesDefinition.returnGeometry,f.orderByFields=""!==e.pagesDefinition.orderByFields?e.pagesDefinition.orderByFields.split(","):null,this.isTable()&&f.geometry&&f.spatialRelationship)return s.resolve([]),s.promise;this.executeQuery(f,"execute").then(o.callback(function(t){if(i._checkCancelled(r),t.hasOwnProperty("features")){var n=[];if(e.pagesDefinition.internal.lastRetrieved===u){for(var o=0;o<t.features.length;o++)e.pagesDefinition.internal.set[c+o]=t.features[o].attributes[e.pagesDefinition.generatedOid];for(o=0;o<t.features.length;o++)n.push(new a({attributes:t.features[o].attributes,geometry:null}));!0===e.pagesDefinition.useOIDpagination?0===t.features.length?e.pagesDefinition.internal.fullyResolved=!0:e.pagesDefinition.internal.lastMaxId=t.features[t.features.length-1].attributes[e.pagesDefinition.generatedOid]:t.features.length!==e.pagesDefinition.resultRecordCount&&(e.pagesDefinition.internal.fullyResolved=!0),e.pagesDefinition.internal.lastRetrieved=u+e.pagesDefinition.resultRecordCount,s.resolve(n)}else s.resolve([])}else s.reject(new Error("Unnexected Result querying aggregates from layer"))},s),o.errback(s))}catch(e){s.reject(e)}return s.promise},t.create=function(e,r,n,a,i){var s={url:e,outFields:null===r?["*"]:r};return null!==n&&""!==n&&(s.token=n),new t({layer:new m(s),spatialReference:a,lrucache:i})},t.prototype.canBeBigDataFeatureSet=function(){return!0},t.prototype.shouldBeResolvedAsBigData=function(){return!1},t.prototype.expressAsArcadeScriptImpl=function(e,t,r){var n=this.arcadeAssignNextGlobalIdentifier(r);return t[n]={name:n,type:"FeatureLayer",params:{url:this._layer.parsedUrl.path,token:this._layer.token,definitionExpression:this._layer.definitionExpression,fields:this._layer.outFields}},r.featuresetsyms.push(n),""},t}(i)}.apply(null,n))||(e.exports=a)},1941:function(e,t,r){var n,a;
/**
 * @preserve A JavaScript implementation of the SHA family of hashes, as
 * defined in FIPS PUB 180-2 as well as the corresponding HMAC implementation
 * as defined in FIPS PUB 198a
 *
 * Copyright Brian Turek 2008-2015
 * Distributed under the BSD License
 * See http://caligatio.github.com/jsSHA/ for more information
 *
 * Several functions taken from Paul Johnston
 */n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e,t){var r,n,a,i,s=[],o=[],l=0;if("UTF8"===t)for(n=0;n<e.length;n+=1)for(o=[],128>(r=e.charCodeAt(n))?o.push(r):2048>r?(o.push(192|r>>>6),o.push(128|63&r)):55296>r||57344<=r?o.push(224|r>>>12,128|r>>>6&63,128|63&r):(n+=1,r=65536+((1023&r)<<10|1023&e.charCodeAt(n)),o.push(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)),a=0;a<o.length;a+=1){for(i=l>>>2;s.length<=i;)s.push(0);s[i]|=o[a]<<24-l%4*8,l+=1}else if("UTF16BE"===t||"UTF16LE"===t)for(n=0;n<e.length;n+=1){for(r=e.charCodeAt(n),"UTF16LE"===t&&(r=(a=255&r)<<8|r>>8),i=l>>>2;s.length<=i;)s.push(0);s[i]|=r<<16-l%4*8,l+=2}return{value:s,binLen:8*l}}function n(e){var t,r,n,a=[],i=e.length;if(0!=i%2)throw"String of HEX type must be in byte increments";for(t=0;t<i;t+=2){if(r=parseInt(e.substr(t,2),16),isNaN(r))throw"String of HEX type contains invalid characters";for(n=t>>>3;a.length<=n;)a.push(0);a[t>>>3]|=r<<24-t%8*4}return{value:a,binLen:4*i}}function a(e){var t,r,n,a=[];for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n=r>>>2,a.length<=n&&a.push(0),a[n]|=t<<24-r%4*8;return{value:a,binLen:8*e.length}}function i(e){var t,r,n,a,i,s,o=[],l=0;if(-1===e.search(/^[a-zA-Z0-9=+\/]+$/))throw"Invalid character in base-64 string";if(i=e.indexOf("="),e=e.replace(/\=/g,""),-1!==i&&i<e.length)throw"Invalid '=' found in base-64 string";for(t=0;t<e.length;t+=4){for(a=e.substr(t,4),n=0,r=0;r<a.length;r+=1)n|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(a[r])<<18-6*r;for(r=0;r<a.length-1;r+=1){for(s=l>>>2;o.length<=s;)o.push(0);o[s]|=(n>>>16-8*r&255)<<24-l%4*8,l+=1}}return{value:o,binLen:8*l}}function s(e,t){var r,n,a="0123456789abcdef",i="",s=4*e.length;for(r=0;r<s;r+=1)n=e[r>>>2]>>>8*(3-r%4),i+=a.charAt(n>>>4&15)+a.charAt(15&n);return t.outputUpper?i.toUpperCase():i}function o(e,t){var r,n,a,i,s,o,l="",u=4*e.length;for(r=0;r<u;r+=3)for(i=r+1>>>2,s=e.length<=i?0:e[i],i=r+2>>>2,o=e.length<=i?0:e[i],a=(e[r>>>2]>>>8*(3-r%4)&255)<<16|(s>>>8*(3-(r+1)%4)&255)<<8|o>>>8*(3-(r+2)%4)&255,n=0;n<4;n+=1)8*r+6*n<=32*e.length?l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6*(3-n)&63):l+=t.b64Pad;return l}function l(e,t){var r,n,a="",i=4*e.length;for(r=0;r<i;r+=1)n=e[r>>>2]>>>8*(3-r%4)&255,a+=String.fromCharCode(n);return a}function u(e){var t={outputUpper:!1,b64Pad:"="};try{e.hasOwnProperty("outputUpper")&&(t.outputUpper=e.outputUpper),e.hasOwnProperty("b64Pad")&&(t.b64Pad=e.b64Pad)}catch(e){}if("boolean"!=typeof t.outputUpper)throw"Invalid outputUpper formatting option";if("string"!=typeof t.b64Pad)throw"Invalid b64Pad formatting option";return t}function c(e,t){return e<<t|e>>>32-t}function f(e,t){return e>>>t|e<<32-t}function h(e,t){var r=new L(e.highOrder,e.lowOrder);return 32>=t?new L(r.highOrder>>>t|r.lowOrder<<32-t&4294967295,r.lowOrder>>>t|r.highOrder<<32-t&4294967295):new L(r.lowOrder>>>t-32|r.highOrder<<64-t&4294967295,r.highOrder>>>t-32|r.lowOrder<<64-t&4294967295)}function p(e,t){return e>>>t}function d(e,t){return 32>=t?new L(e.highOrder>>>t,e.lowOrder>>>t|e.highOrder<<32-t&4294967295):new L(0,e.highOrder>>>t-32)}function v(e,t,r){return e^t^r}function m(e,t,r){return e&t^~e&r}function g(e,t,r){return new L(e.highOrder&t.highOrder^~e.highOrder&r.highOrder,e.lowOrder&t.lowOrder^~e.lowOrder&r.lowOrder)}function y(e,t,r){return e&t^e&r^t&r}function _(e,t,r){return new L(e.highOrder&t.highOrder^e.highOrder&r.highOrder^t.highOrder&r.highOrder,e.lowOrder&t.lowOrder^e.lowOrder&r.lowOrder^t.lowOrder&r.lowOrder)}function w(e){return f(e,2)^f(e,13)^f(e,22)}function b(e){var t=h(e,28),r=h(e,34),n=h(e,39);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function S(e){return f(e,6)^f(e,11)^f(e,25)}function k(e){var t=h(e,14),r=h(e,18),n=h(e,41);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function F(e){return f(e,7)^f(e,18)^p(e,3)}function T(e){var t=h(e,1),r=h(e,8),n=d(e,7);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function D(e){return f(e,17)^f(e,19)^p(e,10)}function x(e){var t=h(e,19),r=h(e,61),n=d(e,6);return new L(t.highOrder^r.highOrder^n.highOrder,t.lowOrder^r.lowOrder^n.lowOrder)}function I(e,t){var r=(65535&e)+(65535&t);return(65535&(e>>>16)+(t>>>16)+(r>>>16))<<16|65535&r}function R(e,t,r,n){var a=(65535&e)+(65535&t)+(65535&r)+(65535&n);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16))<<16|65535&a}function C(e,t,r,n,a){var i=(65535&e)+(65535&t)+(65535&r)+(65535&n)+(65535&a);return(65535&(e>>>16)+(t>>>16)+(r>>>16)+(n>>>16)+(a>>>16)+(i>>>16))<<16|65535&i}function E(e,t){var r,n,a;return r=(65535&e.lowOrder)+(65535&t.lowOrder),a=(65535&(n=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r>>>16)))<<16|65535&r,r=(65535&e.highOrder)+(65535&t.highOrder)+(n>>>16),n=(e.highOrder>>>16)+(t.highOrder>>>16)+(r>>>16),new L((65535&n)<<16|65535&r,a)}function P(e,t,r,n){var a,i,s;return a=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder),s=(65535&(i=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a>>>16)))<<16|65535&a,a=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(i>>>16),i=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a>>>16),new L((65535&i)<<16|65535&a,s)}function N(e,t,r,n,a){var i,s,o;return i=(65535&e.lowOrder)+(65535&t.lowOrder)+(65535&r.lowOrder)+(65535&n.lowOrder)+(65535&a.lowOrder),o=(65535&(s=(e.lowOrder>>>16)+(t.lowOrder>>>16)+(r.lowOrder>>>16)+(n.lowOrder>>>16)+(a.lowOrder>>>16)+(i>>>16)))<<16|65535&i,i=(65535&e.highOrder)+(65535&t.highOrder)+(65535&r.highOrder)+(65535&n.highOrder)+(65535&a.highOrder)+(s>>>16),s=(e.highOrder>>>16)+(t.highOrder>>>16)+(r.highOrder>>>16)+(n.highOrder>>>16)+(a.highOrder>>>16)+(i>>>16),new L((65535&s)<<16|65535&i,o)}function A(e,t){var r,n,a,i,s,o,l,u,f,h,p=[],d=m,g=v,_=y,w=c,b=I,S=C,k=[1732584193,4023233417,2562383102,271733878,3285377520];for(h=15+(t+65>>>9<<4);e.length<=h;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[h]=t,f=e.length,l=0;l<f;l+=16){for(r=k[0],n=k[1],a=k[2],i=k[3],s=k[4],u=0;u<80;u+=1)p[u]=u<16?e[u+l]:w(p[u-3]^p[u-8]^p[u-14]^p[u-16],1),o=u<20?S(w(r,5),d(n,a,i),s,1518500249,p[u]):u<40?S(w(r,5),g(n,a,i),s,1859775393,p[u]):u<60?S(w(r,5),_(n,a,i),s,2400959708,p[u]):S(w(r,5),g(n,a,i),s,3395469782,p[u]),s=i,i=a,a=w(n,30),n=r,r=o;k[0]=b(r,k[0]),k[1]=b(n,k[1]),k[2]=b(a,k[2]),k[3]=b(i,k[3]),k[4]=b(s,k[4])}return k}function O(e,t,r){var n,a,i,s,o,l,u,c,f,h,p,d,v,A,O,M,B,G,U,W,q,Y,H,J,V,Q,z,K,X,Z,$,ee,te=[],re=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],ne=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428],ae=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];if(("SHA-224"===r||"SHA-256"===r)&&2&j)d=64,v=15+(t+65>>>9<<4),M=16,B=1,z=Number,G=I,U=R,W=C,q=F,Y=D,H=w,J=S,Q=y,V=m,p="SHA-224"===r?ne:ae;else{if("SHA-384"!==r&&"SHA-512"!==r||!(4&j))throw"Unexpected error in SHA-2 implementation";d=80,v=31+(t+128>>>10<<5),M=32,B=2,G=E,U=P,W=N,q=T,Y=x,H=b,J=k,Q=_,V=g,re=[new(z=L)(re[0],3609767458),new z(re[1],602891725),new z(re[2],3964484399),new z(re[3],2173295548),new z(re[4],4081628472),new z(re[5],3053834265),new z(re[6],2937671579),new z(re[7],3664609560),new z(re[8],2734883394),new z(re[9],1164996542),new z(re[10],1323610764),new z(re[11],3590304994),new z(re[12],4068182383),new z(re[13],991336113),new z(re[14],633803317),new z(re[15],3479774868),new z(re[16],2666613458),new z(re[17],944711139),new z(re[18],2341262773),new z(re[19],2007800933),new z(re[20],1495990901),new z(re[21],1856431235),new z(re[22],3175218132),new z(re[23],2198950837),new z(re[24],3999719339),new z(re[25],766784016),new z(re[26],2566594879),new z(re[27],3203337956),new z(re[28],1034457026),new z(re[29],2466948901),new z(re[30],3758326383),new z(re[31],168717936),new z(re[32],1188179964),new z(re[33],1546045734),new z(re[34],1522805485),new z(re[35],2643833823),new z(re[36],2343527390),new z(re[37],1014477480),new z(re[38],1206759142),new z(re[39],344077627),new z(re[40],1290863460),new z(re[41],3158454273),new z(re[42],3505952657),new z(re[43],106217008),new z(re[44],3606008344),new z(re[45],1432725776),new z(re[46],1467031594),new z(re[47],851169720),new z(re[48],3100823752),new z(re[49],1363258195),new z(re[50],3750685593),new z(re[51],3785050280),new z(re[52],3318307427),new z(re[53],3812723403),new z(re[54],2003034995),new z(re[55],3602036899),new z(re[56],1575990012),new z(re[57],1125592928),new z(re[58],2716904306),new z(re[59],442776044),new z(re[60],593698344),new z(re[61],3733110249),new z(re[62],2999351573),new z(re[63],3815920427),new z(3391569614,3928383900),new z(3515267271,566280711),new z(3940187606,3454069534),new z(4118630271,4000239992),new z(116418474,1914138554),new z(174292421,2731055270),new z(289380356,3203993006),new z(460393269,320620315),new z(685471733,587496836),new z(852142971,1086792851),new z(1017036298,365543100),new z(1126000580,2618297676),new z(1288033470,3409855158),new z(1501505948,4234509866),new z(1607167915,987167468),new z(1816402316,1246189591)],p="SHA-384"===r?[new z(3418070365,ne[0]),new z(1654270250,ne[1]),new z(2438529370,ne[2]),new z(355462360,ne[3]),new z(1731405415,ne[4]),new z(41048885895,ne[5]),new z(3675008525,ne[6]),new z(1203062813,ne[7])]:[new z(ae[0],4089235720),new z(ae[1],2227873595),new z(ae[2],4271175723),new z(ae[3],1595750129),new z(ae[4],2917565137),new z(ae[5],725511199),new z(ae[6],4215389547),new z(ae[7],327033209)]}for(;e.length<=v;)e.push(0);for(e[t>>>5]|=128<<24-t%32,e[v]=t,$=e.length,A=0;A<$;A+=M){for(n=p[0],a=p[1],i=p[2],s=p[3],o=p[4],l=p[5],u=p[6],c=p[7],O=0;O<d;O+=1)O<16?(Z=O*B+A,K=e.length<=Z?0:e[Z],X=e.length<=Z+1?0:e[Z+1],te[O]=new z(K,X)):te[O]=U(Y(te[O-2]),te[O-7],q(te[O-15]),te[O-16]),f=W(c,J(o),V(o,l,u),re[O],te[O]),h=G(H(n),Q(n,a,i)),c=u,u=l,l=o,o=G(s,f),s=i,i=a,a=n,n=G(f,h);p[0]=G(n,p[0]),p[1]=G(a,p[1]),p[2]=G(i,p[2]),p[3]=G(s,p[3]),p[4]=G(o,p[4]),p[5]=G(l,p[5]),p[6]=G(u,p[6]),p[7]=G(c,p[7])}if("SHA-224"===r&&2&j)ee=[p[0],p[1],p[2],p[3],p[4],p[5],p[6]];else if("SHA-256"===r&&2&j)ee=p;else if("SHA-384"===r&&4&j)ee=[p[0].highOrder,p[0].lowOrder,p[1].highOrder,p[1].lowOrder,p[2].highOrder,p[2].lowOrder,p[3].highOrder,p[3].lowOrder,p[4].highOrder,p[4].lowOrder,p[5].highOrder,p[5].lowOrder];else{if(!("SHA-512"===r&&4&j))throw"Unexpected error in SHA-2 implementation";ee=[p[0].highOrder,p[0].lowOrder,p[1].highOrder,p[1].lowOrder,p[2].highOrder,p[2].lowOrder,p[3].highOrder,p[3].lowOrder,p[4].highOrder,p[4].lowOrder,p[5].highOrder,p[5].lowOrder,p[6].highOrder,p[6].lowOrder,p[7].highOrder,p[7].lowOrder]}return ee}var j=7,L=function(){return function(e,t){this.highOrder=e,this.lowOrder=t}}();return function(){function e(e,t,s){this.strBinLen=0,this.strToHash=null,this.utfType="";var o=null;if(this.strToHash=[0],this.strBinLen=0,this.utfType=s||"UTF8","UTF8"!==this.utfType&&"UTF16BE"!==this.utfType&&"UTF16LE"!==this.utfType)throw"encoding must be UTF8, UTF16BE, or UTF16LE";if("HEX"===t){if(0!=e.length%2)throw"srcString of HEX type must be in byte increments";o=n(e),this.strBinLen=o.binLen,this.strToHash=o.value}else if("TEXT"===t)o=r(e,this.utfType),this.strBinLen=o.binLen,this.strToHash=o.value;else if("B64"===t)o=i(e),this.strBinLen=o.binLen,this.strToHash=o.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";o=a(e),this.strBinLen=o.binLen,this.strToHash=o.value}}return e.prototype.getHash=function(e,t,r,n){var a,i=null,c=this.strToHash.slice(),f=this.strBinLen;if(3===arguments.length?"number"!=typeof r&&(n=r,r=1):2===arguments.length&&(r=1),r!==parseInt(r,10)||1>r)throw"numRounds must a integer >= 1";switch(t){case"HEX":i=s;break;case"B64":i=o;break;case"BYTES":i=l;break;default:throw"format must be HEX, B64, or BYTES"}if("SHA-1"===e&&1&j)for(a=0;a<r;a+=1)c=A(c,f),f=160;else if("SHA-224"===e&&2&j)for(a=0;a<r;a+=1)c=O(c,f,e),f=224;else if("SHA-256"===e&&2&j)for(a=0;a<r;a+=1)c=O(c,f,e),f=256;else if("SHA-384"===e&&4&j)for(a=0;a<r;a+=1)c=O(c,f,e),f=384;else{if(!("SHA-512"===e&&4&j))throw"Chosen SHA variant is not supported";for(a=0;a<r;a+=1)c=O(c,f,e),f=512}return i(c,u(n))},e.prototype.getHMAC=function(e,t,c,f,h){var p,d,v,m,g,y,_,w,b,S=[],k=[],F=null;switch(f){case"HEX":p=s;break;case"B64":p=o;break;case"BYTES":p=l;break;default:throw"outputFormat must be HEX, B64, or BYTES"}if("SHA-1"===c&&1&j)v=64,b=160;else if("SHA-224"===c&&2&j)v=64,b=224;else if("SHA-256"===c&&2&j)v=64,b=256;else if("SHA-384"===c&&4&j)v=128,b=384;else{if(!("SHA-512"===c&&4&j))throw"Chosen SHA variant is not supported";v=128,b=512}if("HEX"===t)w=(F=n(e)).binLen,d=F.value;else if("TEXT"===t)w=(F=r(e,this.utfType)).binLen,d=F.value;else if("B64"===t)w=(F=i(e)).binLen,d=F.value;else{if("BYTES"!==t)throw"inputFormat must be HEX, TEXT, B64, or BYTES";w=(F=a(e)).binLen,d=F.value}if(m=8*v,_=v/4-1,v<w/8){if("SHA-1"===c&&1&j)d=A(d,w);else{if(!(6&j))throw"Unexpected error in HMAC implementation";d=O(d,w,c)}for(;d.length<=_;)d.push(0);d[_]&=4294967040}else if(v>w/8){for(;d.length<=_;)d.push(0);d[_]&=4294967040}for(g=0;g<=_;g+=1)S[g]=909522486^d[g],k[g]=1549556828^d[g];if("SHA-1"===c&&1&j)y=A(k.concat(A(S.concat(this.strToHash),m+this.strBinLen)),m+b);else{if(!(6&j))throw"Unexpected error in HMAC implementation";y=O(k.concat(O(S.concat(this.strToHash),m+this.strBinLen,c)),m+b,c)}return p(y,u(h))},e}()}.apply(null,n))||(e.exports=a)},1942:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(260),r(47),r(30)],void 0===(a=function(e,t,r,n,a){function i(e,t){switch(t.type){case"EmptyStatement":return"";case"VariableDeclarator":return function(e,t){var r=null===t.init?null:i(e,t.init),n=o(t.name,e.mangles);return""===r?n:n+" = "+r}(e,t);case"VariableDeclaration":return function(e,t){for(var r=[],n=0;n<t.declarations.length;n++)r.push(i(e,t.declarations[n]));return"var "+r.join(",")+"; "}(e,t);case"BlockStatement":return function(e,t){for(var r="{\n",n=0;n<t.body.length;n++)r+=i(e,t.body[n])+" \n";return r+"}\n"}(e,t);case"FunctionDeclaration":return function(e,t){var r="function "+l(t.id.name,e.globalMangles,{}),n=[],a={};a={};for(var s={},u=0,c=t.params;u<c.length;u++){var f=c[u],h=o(f.name,s);n.push(h),a[f.name]=1}return(r+="("+n.join(",")+") ")+i({functions:e.functions,globals:e.globals,symbols:e.symbols,context:e.context,globalMangles:e.globalMangles,localMangles:s,locals:a},t.body)}(e,t);case"ReturnStatement":return function(e,t){return null===t.argument?"return;":"return "+i(e,t.argument)+";\n"}(e,t);case"IfStatement":return function(e,t){return"if "+i(e,t.test)+" "+i(e,t.consequent)+(null!==t.alternate?"else "+i(e,t.alternate):"")}(e,t);case"ExpressionStatement":return function(e,t){return i(e,t.expression)+";"}(e,t);case"AssignmentExpression":return function(e,t){return i(e,t.left)+" "+t.operator+" "+i(e,t.right)}(e,t);case"UpdateExpression":return function(e,t){return!0===t.prefix?t.operator+i(e,t.argument):i(e,t.argument)+t.operator}(e,t);case"BreakStatement":return"break;";case"ContinueStatement":return"continue;";case"ForStatement":return function(e,t){var r="for(";return null!==t.init&&(r+=i(e,t.init)),r+=";",null!==t.test?r+=i(e,t.test):r+=" ;",null!==t.update?r+=i(e,t.update):r+=" ;",(r+=") ")+i(e,t.body)+"\n"}(e,t);case"ForInStatement":return function(e,t){return"for( "+i(e,t.left)+" in "+i(e,t.right)+") "+i(e,t.body)+"\n"}(e,t);case"Identifier":return function(e,t){var i=t.name.toLowerCase();if(void 0!==e.locals[i])return l(t.name,e.globalMangles,e.localMangles);var o=e.context.globalScope[i];if(void 0===o)return t.name;if(null!==o){if(o.value instanceof r){var c=u(o.value,e.functions,e.globals,e.symbols);return c}if(null==o){var c=s(e.symbols);return e.globals.push({name:c,type:"null",params:{value:null}}),c}if(o instanceof a){var c=s(e.symbols);return e.globals.push({name:c,type:"geometry",params:{value:o}}),c}if(n.isNumber(o)){var c=s(e.symbols);return e.globals.push({name:c,type:"number",params:{value:o}}),c}if(n.isDate(o)){var c=s(e.symbols);return e.globals.push({name:c,type:"date",params:{value:n.toDate(o).getTime()}}),c}if(n.isString(o)){var c=s(e.symbols);return e.globals.push({name:c,type:"string",params:{value:o}}),c}if(n.isFeatureSet(o));else if(n.isImmutableArray(o));else if(!n.isArray(o))throw new Error("Unsupported Type")}return t.name}(e,t);case"MemberExpression":return function(e,t){return"true"===t.computed?i(e,t.object)+"["+i(e,t.property)+"]":i(e,t.object)+"."+t.property.name}(e,t);case"Literal":return null===t.value||void 0===t.value?"null":JSON.stringify(t.value);case"ThisExpression":throw new Error("NOTSUPPORTED");case"CallExpression":return function(e,t){for(var r=i(e,t.callee)+"(",n=[],a=0,s=t.arguments;a<s.length;a++){var o=s[a];n.push(i(e,o))}return r+(n.join(",")+")")}(e,t);case"UnaryExpression":return function(e,t){return!0===t.prefix?t.operator+i(e,t.argument):i(e,t.argument)+t.operator}(e,t);case"BinaryExpression":return function(e,t){return"("+i(e,t.left)+" "+t.operator+" "+i(e,t.right)+")"}(e,t);case"LogicalExpression":return function(e,t){return i(e,t.left)+" "+t.operator+" "+i(e,t.right)}(e,t);case"ConditionalExpression":throw new Error("NOTSUPPORTED");case"ArrayExpression":return function(e,t){for(var r=[],n=0;n<t.elements.length;n++)r.push(i(e,t.elements[n]));return"["+r.join(",")+"]"}(e,t);case"ObjectExpression":return function(e,t){for(var r="{",n=0;n<t.properties.length;n++){var a=t.properties[n];r+=("Identifier"===a.key.type?JSON.stringify(a.key.name):i(e,a.key))+":"+i(e,a.value)}return r+"}"}(e,t);case"Property":return function(e,t){throw new Error("Not Supported")}();case"Array":throw new Error("NOTSUPPORTED");default:throw new Error("UNREOGNISED")}}function s(e){for(var t=!1,r="";!1===t;)r="$gi_"+c.toString(),c++,void 0===e.syms[r]&&(t=!0);return r}function o(e,t){var r="$$fc_"+c.toString();return c++,t[e]=r,r}function l(e,t,r){return void 0===r[e]?void 0===t[e]?e:t[e]:r[e]}function u(e,t,r,n){var a={functions:t,globals:r,symbols:n,context:e.context,locals:{},globalMangles:{},localMangles:{}},s=e.definition.id.name;if(void 0!==t.lkp[s])return t.lkp[s].mangledname;var l=o(s,a.globalMangles),u={name:s,mangledname:l,script:""};return u.script=i(a,e.definition),t.lkp[u.name]=u,t.stack.push(u),l}Object.defineProperty(t,"__esModule",{value:!0});var c=0;t.exportFunctionAsArcade=u}.apply(null,n))||(e.exports=a)},1943:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(165)],void 0===(a=function(e,t,r){Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateFunction=function(e,t){var r=n[e.toLowerCase()];if(null==r)throw new Error("Function Not Recognised");if(t.length<r.minParams||t.length>r.maxParams)throw new Error("Invalid Parameter count for call to "+e.toUpperCase());return r.evaluate(t)},t.isStandardized=function(e,t){var r=n[e.toLowerCase()];return null!=r&&t>=r.minParams&&t<=r.maxParams};var n={extract:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];if(null==r)return null;if(r instanceof Date)switch(t.toUpperCase()){case"SECOND":return r.getSeconds();case"MINUTE":return r.getMinutes();case"HOUR":return r.getHours();case"DAY":return r.getDate();case"MONTH":return r.getMonth()+1;case"YEAR":return r.getFullYear()}throw new Error("Invalid Parameter for call to EXTRACT")}},substring:{minParams:2,maxParams:3,evaluate:function(e){if(2===e.length){var t=e[0],r=e[1];return null==t||null==r?null:t.toString().substring(r-1)}if(3===e.length){t=e[0],r=e[1];var n=e[2];return null==t||null==r||null==n?null:n<=0?"":t.toString().substring(r-1,r+n-1)}}},position:{minParams:2,maxParams:2,evaluate:function(e){var t=e[0],r=e[1];return null==t||null==r?null:r.indexOf(t)+1}},trim:{minParams:2,maxParams:3,evaluate:function(e){var t=3===e.length,n=t?e[1]:" ",a=t?e[2]:e[1];if(null==n||null==a)return null;var i="("+r.escapeString(n)+")";switch(e[0]){case"BOTH":return a.replace(new RegExp("^"+i+"*|"+i+"*$","g"),"");case"LEADING":return a.replace(new RegExp("^"+i+"*","g"),"");case"TRAILING":return a.replace(new RegExp(i+"*$","g"),"")}throw new Error("Invalid Parameter for call to TRIM")}},abs:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.abs(e[0])}},ceiling:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.ceil(e[0])}},floor:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.floor(e[0])}},log:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])}},log10:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.log(e[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.sin(e[0])}},cos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.cos(e[0])}},tan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.tan(e[0])}},asin:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.asin(e[0])}},acos:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.acos(e[0])}},atan:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:Math.atan(e[0])}},sign:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0]>0?1:e[1]<0?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:Math.pow(e[0],e[1])}},mod:{minParams:2,maxParams:2,evaluate:function(e){return null==e[0]||null==e[1]?null:e[0]%e[1]}},round:{minParams:1,maxParams:2,evaluate:function(e){var t=e[0],r=2===e.length?Math.pow(10,e[1]):1;return null==t?null:Math.round(t*r)/r}},truncate:{minParams:1,maxParams:2,evaluate:function(e){return null==e[0]?null:1===e.length?parseInt(e[0].toFixed(0),10):parseFloat(e[0].toFixed(e[1]))}},char_length:{minParams:1,maxParams:1,evaluate:function(e){return"string"==typeof e[0]||e[0]instanceof String?e[0].length:0}},concat:{minParams:1,maxParams:1/0,evaluate:function(e){for(var t="",r=0;r<e.length;r++){if(null==e[r])return null;t+=e[r].toString()}return t}},lower:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(e){return null==e[0]?null:e[0].toString().toUpperCase()}}}}.apply(null,n))||(e.exports=a)},1944:function(e,t,r){var n,a;n=[r.dj.c(e.i),t,r(25),r(58),r(45),r(479),r(1875),r(51)],void 0===(a=function(e,t,r,n,a,i,s,o){return function(e){function t(t,r){var n=e.call(this,t,r)||this;return n._currentPage=null,n._iteratorStarted=!1,n._indexInCurrentPage=0,n._noMorePages=!1,n._script=null,n._featuresetMoniker="",n}return r(t,e),t.prototype.reset=function(){this._currentPage=null,this._iteratorStarted=!1,this._indexInCurrentPage=0,this._featuresetMoniker=""},t.prototype.next=function(){var e=this,t=new n;return!1===this._iteratorStarted?this.requestFirstPage().then(i.callback(function(){e.handleFeatureFromPage(t)},t),function(e){t.reject(e)}):this.handleFeatureFromPage(t),t.promise},t.prototype.handleFeatureFromPage=function(e){var t=this;if(null===this._currentPage&&e.resolve(null),this._indexInCurrentPage<this._currentPage.length){this._indexInCurrentPage++;var r=this._currentPage[this._indexInCurrentPage-1];if(null!==r)if(r instanceof a);else{var n=null;if(null!==r.geometry){var s=this._script.spatialReference;s.toJSON?s=s.toJSON():s.toJson&&(s=s.toJson()),r.geometry.spatialReference=s,n=o.fromJSON(r.geometry)}r=new a({geometry:n,attributes:r.attributes}),this._currentPage[this._indexInCurrentPage-1]=r}e.resolve(r)}else 0===this._currentPage.length?(this._noMorePages=!0,this._currentPage=null,this._indexInCurrentPage=0,e.resolve(null)):this.requestNextPage().then(i.callback(function(){t.handleFeatureFromPage(e)},e),function(t){e.reject(t)})},t.prototype.requestFirstPage=function(){var e=this,t=new n;return this._indexInCurrentPage=0,this._currentPage=[],this._parent.top(1e3).expressAsArcadeScript().then(i.callback(function(r){r.script+="\n return "+r.featuresetIdentifier+";\n",e._script=r;var n=e._parent.sourceGeoAnalyticsProvider();null===n?t.reject(new Error("No Big Data Provider")):n.executeFeatureSetPageRequest(e._script.script,e._script.globals,e._script.spatialReference,"").then(function(r){e._featuresetMoniker=r.moniker,e._currentPage=r.records,e._iteratorStarted=!0,t.resolve(!0)},function(e){t.reject(e)})},t),function(e){t.reject(e)}),t.promise},t.prototype.requestNextPage=function(){var e=this,t=new n;this._indexInCurrentPage=0,this._currentPage=[];var r=this._parent.sourceGeoAnalyticsProvider();return null===r?t.reject(new Error("No Big Data Provider")):r.executeFeatureSetPageRequest(this._script.script,this._script.globals,this._script.spatialReference,this._featuresetMoniker).then(function(r){e._currentPage=r.records,t.resolve(!0)},function(e){t.reject(e)}),t.promise},t.prototype.count=function(){var e=this,t=new n;return-1!==this._parent._totalCount?t.resolve(this._parent._totalCount):this._parent.count().then(i.callback(function(r){e._parent._totalCount=r,t.resolve(e._parent._totalCount)},t),i.errback(t)),t.promise},t}(s)}.apply(null,n))||(e.exports=a)},1945:function(e,t,r){var n,a;n=[r.dj.c(e.i),t],void 0===(a=function(e,t){function r(e){for(var t="",r=0;r<e;r++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t}var n=new RegExp("^[a-z0-9]{8}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{4}-[a-z0-9]{12}$","i");return function(){function e(t){if(this.value="",!t)throw new TypeError("Invalid argument; `value` has no value.");this.value=e.EMPTY,t&&t instanceof e?this.value=t.toString():t&&"[object String]"===Object.prototype.toString.call(t)&&e.isGuid(t)&&(this.value=t)}return e.prototype.equals=function(t){return e.isGuid(t)&&this.value===t},e.prototype.isEmpty=function(){return this.value===e.EMPTY},e.prototype.toString=function(){return this.value},e.prototype.toJSON=function(){return this.value},e.isGuid=function(t){return t&&(t instanceof e||n.test(t.toString()))},e.create=function(){return new e([r(2),r(1),r(1),r(1),r(3)].join("-"))},e.raw=function(){return[r(2),r(1),r(1),r(1),r(3)].join("-")},e.EMPTY="00000000-0000-0000-0000-000000000000",e}()}.apply(null,n))||(e.exports=a)}}]);