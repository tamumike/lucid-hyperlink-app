(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/graphics/sources/support/CSVSourceWorker":525,"dstore/Csv":1826})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{1826:function(e,t,i){var r,n;r=[i(12),i(235)],void 0===(n=function(e,t){var i=/^\s*"([\S\s]*)"\s*$/,r=/""/g,n=/"/g;function l(e,t){var i,r={},n=e.length;for(i=0;i<n;i++)r[e[i]]=t[i];return r}return t(null,{fieldNames:null,delimiter:",",newline:"\r\n",trim:!1,parse:function(t){var n,a,o,u,s,d,f,c,p=[],m=t.split(this.newline),y=this.fieldNames,g=0,h=[],v="",N="";e:for(d=0,o=m.length;d<o;d++)if(e.trim(m[d])){for(f=0,u=(n=m[d].split(this.delimiter)).length;f<u;f++){for(c=-1,v+=N+(a=n[f]),N="";(c=a.indexOf('"',c+1))>=0;)g++;if(g%2==0){if(g>0){if(!(s=i.exec(v))){console.warn("Csv: discarding row with invalid value: "+v),h=[],v="",g=0;continue e}h.push(s[1].replace(r,'"'))}else h.push(this.trim||!y?e.trim(v):v);v="",g=0}else N=this.delimiter}0===g?(y?p.push(l(y,h)):y=this.fieldNames=h,h=[]):N=this.newline}return p},toCsv:function(e){return this.stringify(this.data,e)},stringify:function(e,t){var i,r,l,a,o=(t=t||{}).alwaysQuote,u=this.fieldNames,s=this.delimiter,d=this.newline,f="";for(i=-1;i<e.length;i++)for(i>-1&&(f+=d),r=0;r<u.length;r++)null!==(l=i<0?u[r]:e[i][u[r]])&&void 0!==l||(l=""),"string"!=typeof l&&(l=l.toString()),a=o||l.indexOf('"')>=0||l.indexOf(s)>=0,f+=(r>0?s:"")+(a?'"'+l.replace(n,'""')+'"':l);return t.trailingNewline&&(f+=d),f}})}.apply(null,r))||(e.exports=n)},525:function(e,t,i){var r,n;r=[i.dj.c(e.i),t,i(158),i(476),i(90),i(1826),i(32),i(36),i(9),i(16),i(4),i(8),i(22),i(1716),i(59),i(28),i(261),i(253),i(1676),i(1705),i(97)],void 0===(n=function(e,t,i,r,n,l,a,o,u,s,d,f,c,p,m,y,g,h,v,N,F){Object.defineProperty(t,"__esModule",{value:!0});var b=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeLong"];t.csvLatitudeFieldNames=["lat","latitude","y","ycenter","latitude83","latdecdeg","point-y"],t.csvLongitudeFieldNames=["lon","lng","long","longitude","x","xcenter","longitude83","longdecdeg","point-x"],t.csvDetectedDelimiters=[","," ",";","|","\t"];var w=/^((jan(uary)?)|(feb(ruary)?)|(mar(ch)?)|(apr(il)?)|(may)|(jun(e)?)|(jul(y)?)|(aug(ust)?)|(sep(tember)?)|(oct(ober)?)|(nov(ember)?)|(dec(ember)?)|(am)|(pm)|(gmt)|(utc))$/i,_=[0,0],x=function(){return function(e,t){this.x=e,this.y=t}}(),I=function(){var e=n._parseInfo(),t=new RegExp("^"+e.regexp+"$"),i=new RegExp("["+e.group+"\\s\\xa0]","g"),r=e.factor;return function(n){var l=t.exec(n);if(e.factor=r,!l)return NaN;var a=l[1];if(!l[1]){if(!l[2])return NaN;a=l[2],e.factor*=-1}return+(a=a.replace(i,"").replace(e.decimal,"."))*e.factor}}(),D=function(){function e(){this._queryEngine=null}return e.prototype.load=function(e){var t=this;return f.all([this._fetch(e.url),this._checkProjection(e)]).then(function(i){var r=i[0],n=t._parse(r,e.parsing);return t._queryEngine=t._createQueryEngine(r,n),n.layerDefinition.extent=t._queryEngine.fullExtent,n})},e.prototype.applyEdits=function(e){return f.reject(new u("csv-source:editing-not-supported","applyEdits() is not supported on CSVLayer"))},e.prototype.queryFeatures=function(e){return void 0===e&&(e={}),this._queryEngine.executeQuery(F.fromJSON(e))},e.prototype.queryFeatureCount=function(e){return void 0===e&&(e={}),this._queryEngine.executeQueryForCount(F.fromJSON(e))},e.prototype.queryObjectIds=function(e){return void 0===e&&(e={}),this._queryEngine.executeQueryForIds(F.fromJSON(e))},e.prototype.queryExtent=function(e){return void 0===e&&(e={}),this._queryEngine.executeQueryForExtent(F.fromJSON(e))},e.prototype._fetch=function(e){if(!e)return f.reject(new u("csv-source:invalid-source","url not defined"));var t=c.urlToObject(e);return o(t.path,{query:t.query,responseType:"text"}).then(function(e){return e.data})},e.prototype._parse=function(e,t){void 0===t&&(t={});for(var i={columnDelimiter:t.columnDelimiter,layerDefinition:null,locationInfo:{latitudeFieldName:t.latitudeField,longitudeFieldName:t.longitudeField}};e&&"\n"===e[0];)e=e.slice(1);"\n"!==e[e.length-1]&&(e+="\n");var r=this._readFirstLine(e);if(!r)throw new u("csv","CSV is empty",{csv:e});if(!t.columnDelimiter){var n=this._inferDelimiter(r);if(!n)throw new u("csv-source:invalid-delimiter","Unable to detect the delimiter from CSV");i.columnDelimiter=n}var l=r.split(i.columnDelimiter),a=i.layerDefinition={name:"csv",geometryType:"esriGeometryPoint",objectIdField:null,fields:[],extent:{xmin:Number.POSITIVE_INFINITY,ymin:Number.POSITIVE_INFINITY,xmax:Number.NEGATIVE_INFINITY,ymax:Number.NEGATIVE_INFINITY,spatialReference:t.spatialReference||{wkid:102100}}};if(!t.latitudeField||!t.longitudeField){var o=this._inferLocationInfo(l);if(!t.longitudeField&&!o.longitudeFieldName||!t.latitudeField&&!o.latitudeFieldName)throw new u("csv","Unable to identify latitudeField and/or longitudeField from CSV");i.locationInfo={longitudeFieldName:t.longitudeField||o.longitudeFieldName,latitudeFieldName:t.latitudeField||o.latitudeFieldName}}var s=this._inferFields(e,i.columnDelimiter,l,i.locationInfo);if(t.fields&&t.fields.length){for(var f=new Map,c=0,p=t.fields;c<p.length;c++){var m=p[c];f.set(m.name.toLowerCase(),m)}for(var y=0,g=s;y<g.length;y++){m=g[y];var h=f.get(m.name.toLowerCase());if(h){var v=m.name;d.mixin(m,h),m.name=v}}}return a.fields=s,a.fields.some(function(e){return"esriFieldTypeOID"===e.type&&(a.objectIdField=e.name,!0)})||(a.objectIdField="__OBJECTID",a.fields.unshift({name:"__OBJECTID",alias:"__OBJECTID",type:"esriFieldTypeOID",editable:!1,nullable:!1})),i},e.prototype._inferLocationInfo=function(e){var i=null,r=null;return e.forEach(function(e){var n=e.toLowerCase();-1===t.csvLatitudeFieldNames.indexOf(n)||r||(r=e),-1===t.csvLongitudeFieldNames.indexOf(n)||i||(i=e)}),{longitudeFieldName:i,latitudeFieldName:r}},e.prototype._inferFields=function(e,t,i,r){for(var n=[],l=this._sampleLines(e).map(function(e){return e.split(t).map(function(e){return e.trim()})}),a=this,o=0;o<i.length;o++)!function(e){var t=i[e];if(t===r.longitudeFieldName||t===r.latitudeFieldName)n.push({name:t,type:"esriFieldTypeDouble",alias:t});else{var o=l.map(function(t){return t[e]}),u=a._inferFieldType(o),s={name:t.replace(/[\s\'’‘\.\-\/\(\)]+/g,"_"),type:null,alias:t};switch(u){case"integer":s.type="esriFieldTypeInteger";break;case"double":s.type="esriFieldTypeDouble";break;case"date":s.type="esriFieldTypeDate",s.length=36;break;default:s.type="esriFieldTypeString",s.length=255}n.push(s)}}(o);return n},e.prototype._inferFieldType=function(e){var t=this;if(!e.length)return"string";var i=/[^+-.,0-9]/;return e.map(function(e){var r=!1;if(""===e||i.test(e))r=!0;else{var n=I(e);if(!isNaN(n))return/[.,]/.test(e)?"double":n>214783647||n<-214783648?"double":"integer";if(-1===e.indexOf("E"))r=!0;else{if(n=Number(e),!isNaN(n))return"double";if(-1===e.indexOf(","))r=!0;else{if(e=e.replace(",","."),n=Number(e),!isNaN(n))return"double";r=!0}}}if(r){if(/^[-]?\d*[.,]?\d*$/.test(e))return"string";var l=new Date(e);return t._isValidDate(l,e)?"date":"string"}return"string"}).reduce(function(e,t){return e===t?t:"string"===e||"string"===t?"string":"double"===e||"double"===t?"double":void 0})},e.prototype._isValidDate=function(e,t){if(!e||"[object Date]"!==Object.prototype.toString.call(e)||isNaN(e.getTime()))return!1;var i=!0;if(s("chrome")&&/\d+\W*$/.test(t)){var r=t.match(/[a-zA-Z]{2,}/);if(r){for(var n=!1,l=0;!n&&l<=r.length;)n=!w.test(r[l]),l++;i=!n}}return i},e.prototype._readFirstLine=function(e){return e.substring(0,e.indexOf("\n")).trim()},e.prototype._sampleLines=function(e,t){void 0===t&&(t=10);for(var i=!1,r=[],n=e.indexOf("\n")+1;!i&&r.length<t;){var l=e.indexOf("\n",n);if(-1!==l){var a;(a=-1===l&&n<e.length-1?e.substring(n).trim():e.substring(n,l).trim())&&r.push(a),n=l+1}else i=!0}return r},e.prototype._inferDelimiter=function(e){var i=0,r="";return t.csvDetectedDelimiters.forEach(function(t){var n=e.split(t).length;n>i&&(i=n,r=t)}),""===r?null:r},e.prototype._createQueryEngine=function(e,t){for(var i,n=t.locationInfo,o=n.latitudeFieldName,u=n.longitudeFieldName,s=t.layerDefinition,d=s.objectIdField,f=s.fields,c=s.extent,F=[],w=[],D=new r.Set,T=new r.Set,E=[],O=0,S=f;O<S.length;O++){var j=S[O],C=j.name,L=j.type;"esriFieldTypeDate"===L?D.add(C):b.indexOf(L)>-1&&T.add(C),C!==d&&E.push(C)}var V=new l;V.delimiter=t.columnDelimiter,V.fieldNames=E,V.newline="\n";var q=V.parse(e),R=0;q.shift();for(var k=0,J=q;k<J.length;k++){var P=J[k],M=this._parseCoordinateValue(P[o]),Q=this._parseCoordinateValue(P[u]);if(null!=Q&&null!=M&&!isNaN(M)&&!isNaN(Q)){for(var G in P[o]=M,P[u]=Q,P)if(G!==o&&G!==u)if(D.has(G)){var W=new Date(P[G]);P[G]=this._isValidDate(W,P[G])?W.getTime():null}else if(T.has(G)){var Y=I(P[G]);isNaN(Y)?P[G]=null:P[G]=Y}P[d]=R,R++,F.push(new x(Q,M)),w.push(P)}}if(!m.equals({wkid:4326},c.spatialReference))if(m.isWebMercator(c.spatialReference))for(var $=0,A=F;$<A.length;$++){var B=A[$];i=y.lngLatToXY(B.x,B.y,_),B.x=i[0],B.y=i[1]}else F=p.projectMany(F,a.SpatialReference.WGS84,c.spatialReference,null,!0);for(var Z=new v.default({geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1}),U=new N.default({fields:t.layerDefinition.fields,geometryType:"esriGeometryPoint",hasM:!1,hasZ:!1,objectIdField:d,spatialReference:c.spatialReference||{wkid:4326},cacheSpatialQueries:!0,spatialIndex:Z}),z=[],X=0;X<F.length;X++){var H=F[X],K=H.x,ee=H.y,te=w[X];te[d]=X+1,z.push(new g.default(new h.default([],[K,ee]),te,null,te[d]))}return Z.addMany(z),U},e.prototype._parseCoordinateValue=function(e){if(null==e||""===e)return null;var t=I(e);return(isNaN(t)||Math.abs(t)>181)&&(t=parseFloat(e)),t},e.prototype._checkProjection=function(e){if(!e||!e.parsing||!e.parsing.spatialReference)return f.resolve();var t=e.parsing&&e.parsing.spatialReference;return!t||y.canProject(a.SpatialReference.WGS84,t)?f.resolve():p.isSupported()?p.load():f.reject(new u("csv-layer","Projection not supported"))},e}();t.default=D}.apply(null,r))||(e.exports=n)}}]);